C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE API_LCD_DISPLAY
OBJECT MODULE PLACED IN .\Api_Lcd_Display.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\C_Source\S4_ApiUser\Api_Lcd_Display.c LARGE BROWSE INCDIR(..\C_Source\S0
                    -_System;..\C_Source\S1_HardDrv;..\C_Source\S2_MyLib;..\C_Source\S3_ApiPlat;..\C_Source\S4_ApiUser;..\C_Source\S5_ApiProt
                    -ocol;..\C_Source\S6_MyIncludes;..\C_Source\S1_HardDrv\V9811A_EMU;..\C_Source\S1_HardDrv\V9811A_MCU;..\C_Source\S1_HardDr
                    -v\E2P_24CXXX) DEBUG OBJECTEXTEND PRINT(.\Api_Lcd_Display.lst) OBJECT(.\Api_Lcd_Display.obj)

line level    source

   1          /*
   2          *****************Copyright (c)*************************************
   3          **      Hangzhou Xili Watthour Meter Manufacture Co., Ltd. 
   4          **--------------file info--------------------------------------------
   5          **name                  : Api_Lcd_Display.c
   6          **Author                : maji
   7          **date                  : 2016-04-21 
   8          **description   : Òº¾§ÏÔÊ¾Ó¦ÓÃ²ãÏà¹Øº¯Êý³ÌÐòCÎÄ¼þ
   9          **note                  : V9811A £¬MERTER FOR DL03C
  10          **--------------------Version History -------------------------------------
  11          ** NO. Date         Ver      By         Description 
  12          **==============================================================
  13          ** 1   2016-04-26   v01.00   sosomj     1. frist version                             
  14          **
  15          **==============================================================
  16          */
  17          
  18          
  19          #include <MyIncludes_H.h>
  20          
  21          
  22          /*******************************************************************************
  23          * È«¾Ö±äÁ¿¶¨ÒåÇø
  24          *******************************************************************************/
  25          DIS_PARAM_DATA   gs_dis_param;   // µçÁ¿ÏÔÊ¾Ïà¹Ø²ÎÊý  //
  26          DIS_CTL_VAR  gs_dis_ctl_var;
  27          DIS_PIXEL_VAR  gs_dis_pixel_var;
  28          LCDDISTAB   gs_LCDDISTAB_var;
  29          INT8U dis_data_type = 0;//µç±íÉÏÅÅÏÔÊ¾µçÁ¿»¹ÊÇÊ±¼ä»¹ÊÇÈÕÆÚµÄ±êÖ¾
  30          INT8U dis_data_sec = 0;//³ý¹¦ÂÊÍâÏÔÊ¾³ÖÐøÊ±¼ä
  31          INT8U dis_num_char = 0; //0:µ±Ç°µçÁ¿£¬          1:µ±Ç°ÐèÁ¿£¬            2:µ±Ç°ÀÛ¼Æ×î´óÐèÁ¿£¬
  32                                                          //3:Ç°Ò»ÌìµçÁ¿£¬4:Ç°Ò»ÌìÐèÁ¿£¬5:Ç°Ò»ÌìÀÛ¼Æ×î´óÐèÁ¿
  33          
  34          
  35          
  36          
  37          /*******************************************************************************
  38          * ³£Á¿±íÇø
  39          *******************************************************************************/
  40          const DIS_PARAM_DATA   code default_dis_param_tab= {
  41              5,  //uint8  auto_sec;    // ×Ô¶¯Ñ­»·ÏÔÊ¾³ÖÐøÊ±¼ä  //
  42              15, //uint8  key_sec;     // °´¼üÏÔÊ¾³ÖÐøÊ±¼ä  //
  43              360,//uint8  bg_sec;     // ÏÂµçÏÔÊ¾Î¬³ÖÊ±¼ä Ä¬ÈÏ6Ð¡Ê± µ¥Î»min//
  44              0x51,//uint8  ec_form;     // µçÁ¿¸ñÊ½  //
  45              4,//uint8  auto_item[21];    //0ÎªÏÔÊ¾¸öÊý£¬1~19ÎªÏÔÊ¾ÏîÄ¿£¬×î´ó¿ÉÒÔÏÔÊ¾31¸öÏîÄ¿  //
  46              1,2,3,4,0xFF,0xFF,            //uint8  auto_item[1~10];     //µçÑ¹ÆÁ£¬µçÁ÷ÆÁ£¬¹¦ÂÊÆÁ£¬ÆµÂÊÆÁ
  47              0x00,//INT16U  u16_csck;    //16Î»ÀÛ¼ÓºÍÐ£ÑéÖµ//
  48          };
  49          
  50          
  51          //  ³£Á¿×Ö·û±í¶¨Òå x  // D C B A - E G F 
  52          const INT8U code  NumSegD1_D6[DS_Chr_All_NUM] = 
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 2   

  53          {       DS_Chr_0,DS_Chr_1,DS_Chr_2,
  54                  DS_Chr_3,DS_Chr_4,DS_Chr_5,
  55                  DS_Chr_6,DS_Chr_7,DS_Chr_8,
  56                  DS_Chr_9,
  57                  DS_Chr_A,DS_Chr_b,DS_Chr_C,
  58                  DS_Chr_d,DS_Chr_E,DS_Chr_F
  59          };
  60          
  61          const INT8U code  NumSegD7_D8[DS_Chr_All_NUM] = 
  62          {       DS_OBIS_Chr_0,DS_OBIS_Chr_1,DS_OBIS_Chr_2,
  63                  DS_OBIS_Chr_3,DS_OBIS_Chr_4,DS_OBIS_Chr_5,
  64                  DS_OBIS_Chr_6,DS_OBIS_Chr_7,DS_OBIS_Chr_8,
  65                  DS_OBIS_Chr_9,
  66                  DS_OBIS_Chr_A,DS_OBIS_Chr_b,DS_OBIS_Chr_C,
  67                  DS_OBIS_Chr_d,DS_OBIS_Chr_E,DS_OBIS_Chr_F
  68          };
  69          
  70          
  71          
  72          
  73          //-------------------------------------------------------------------------------//
  74          //  Function:     Òº¾§ÏÔÊ¾ÏîÄ¿µÄÔªËØ±í       --ÔÚROMÇø
  75          //-------------------------------------------------------------------------------//
  76          
  77          const LCDDISTAB code LcdDisTab[] =
  78           {  
  79                  //DisID ,ObisNum ,      Addr ,  DisInfo,        chartype,       obis_digit              
  80                  ////////////////////////////ALL  DISPLAY////////////////////////////////////////////////////////
  81                  0,  0x8888,     0X0000,                                                                         0 ,                                     0,      OBIS_DIGIT_TYPE0,       // ALL DISPLAY  //
  82                  1,  0x327F,     (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].dw_u_val.B08[2],(MEM_RAM<<8)+2, CHAR_V,OBIS_
             -DIGIT_TYPE1,        //µçÑ¹
  83                  2,      0x317F, (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].dw_i_val.B08[0],(MEM_RAM<<8)+2, CHAR_A,OBIS_D
             -IGIT_TYPE2,        //µçÁ÷
  84                  3,  0x170F,     (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].dw_p_val.B08[0],(MEM_RAM<<8)+2,        CHAR_KW,OBIS
             -_DIGIT_TYPE2,        //ÓÐ¹¦¹¦ÂÊ      
  85                  4,  0x1470,     (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].w_freq_val[0],(MEM_RAM<<8)+2,  CHAR_HZ,OBIS_D
             -IGIT_TYPE2,        //ÆµÂÊ  
  86                  5,  0x1370,     (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].dw_pf_val[0],(MEM_RAM<<8)+2,   CHAR_PF,OBIS_DI
             -GIT_TYPE3,        // ¹¦ÂÊÒòÊý     
  87          
  88                  ////////////////////////////ACTIVE ENERGY  DISPLAY///////////////////////////////////////////////////////
             -/
  89                  // 0x01,  0x180F,        (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0],               (MEM_RAM<
             -<8)+6,        CHAR_AEC,OBIS_DIGIT_TYPE1,      // L0 ACTIVE ENERGY TOTAL 
  90          } ;
  91                                                   
  92          
  93          /*****************************************************************************
  94          ** Function name    :api_init_md_data_ram
  95          **
  96          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÏîÄ¿       
  97          **
  98          ** Parameters         :NONE          
  99          **
 100          ** Returned value   :NONE
 101          **
 102          **----------------------------------------------------------------------------
 103          ** V01.01  MJ  2016-04-23
 104          ******************************************************************************/
 105          void api_init_display(void)
 106          {
 107   1          mem_read(&gs_dis_param.auto_sec, ADR_BLOCK21_DIS_PARAM_E2P, LEN_BLOCK21_DIS_PARAM_E2P, MEM_E2P1);    // 
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 3   

             -    
 108   1          gs_dis_ctl_var.mode = DIS_MODE_RESET;
 109   1          gs_dis_ctl_var.item = DIS_RESET;
 110   1          gs_dis_ctl_var.ptr[0] =1;  //´í¹ýÌõÊýÊý×é //
 111   1          gs_dis_ctl_var.keep_sec[0] = 0;
 112   1          gs_dis_ctl_var.keep_sec[1] = 0;
 113   1          gs_dis_ctl_var.keep_sec[2] = 0;             //  ±³¹âÉÏµçµãÁÁ15S//
 114   1          gs_dis_ctl_var.keep_sec[3] = RESEAT_DIS_KEEP_3S; //  ÉÏµçÈ«ÆÁÏÔÊ¾Ê±¼ä
 115   1      }
 116          
 117          
 118          /*****************************************************************************
 119          ** Function name    :api_init_md_data_ram
 120          **
 121          ** Description         :³õÊ¼»¯µ±Ç°ÐèÁ¿¼ÆËãRAMÇøÊý¾Ý£¬³ÌÐò¸´Î»³õÊ¼»¯µ÷ÓÃ        
 122          **
 123          ** Parameters         :NONE          
 124          **
 125          ** Returned value   :NONE
 126          **
 127          **----------------------------------------------------------------------------
 128          ** V01.01  MJ  2016-04-23
 129          ******************************************************************************/
 130          void api_handl_dis_key(void)
 131          {
 132   1      
 133   1          if((gs_dis_ctl_var.mode == DIS_MODE_NOMAL)||(gs_dis_ctl_var.mode == DIS_MODE_RESET))
 134   1          {
 135   2              gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
 136   2              mem_read(&gs_dis_param.auto_item[0], ADR_DIS_PARAM_AUTO_TAB, 32, MEM_E2P1);      // 
 137   2              //gs_dis_ctl_var.ptr[0] =0xff;
 138   2          }
 139   1      
 140   1          gs_dis_ctl_var.keep_sec[1] = gs_dis_param.key_sec; // °´¼ü³ÖÐøÊ±¼ä
 141   1          gs_dis_ctl_var.item = api_get_next_dis_item();
 142   1      
 143   1      }
 144          
 145          /*****************************************************************************
 146          ** Function name    :api_init_md_data_ram
 147          **
 148          ** Description         :³õÊ¼»¯µ±Ç°ÐèÁ¿¼ÆËãRAMÇøÊý¾Ý£¬³ÌÐò¸´Î»³õÊ¼»¯µ÷ÓÃ        
 149          **
 150          ** Parameters         :NONE          
 151          **
 152          ** Returned value   :NONE
 153          **
 154          **----------------------------------------------------------------------------
 155          ** V01.01  MJ  2016-04-23
 156          ******************************************************************************/
 157          void api_handl_dis_sleep(void)
 158          {
 159   1          gs_dis_ctl_var.item = DIS_DEFAULT_ITEM;    
 160   1          gs_dis_ctl_var.mode = DIS_MODE_NOMAL ;
 161   1          mem_read(&gs_dis_param.auto_sec, ADR_BLOCK21_DIS_PARAM_E2P, LEN_BLOCK21_DIS_PARAM_E2P, MEM_E2P1);    // 
             -  
 162   1          api_updated_LCDDisplayPixel_per_second();
 163   1      }
 164          
 165          
 166          
 167          /*****************************************************************************
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 4   

 168          ** Function name    :api_updata_LCDDisplay_per_second
 169          **
 170          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÄÚÈÝ      
 171          **
 172          ** Parameters         :NONE          
 173          **
 174          ** Returned value   :NONE
 175          **
 176          **----------------------------------------------------------------------------
 177          ** V01.01  MJ  2016-04-23
 178          ******************************************************************************/
 179          void api_updated_LCDDisplayPixel_per_second(void)
 180          {               
 181   1          Lib_Set_String(&gs_dis_pixel_var.dis_buff[0],0,DS_UNIT);
 182   1              Lib_Set_String(&gs_dis_pixel_var.dis_obis_buff[0],0,DS_OBISNum);
 183   1              Lib_Set_String(&gs_dis_pixel_var.dis_data_buff[0] ,0,DS_DATANum);
 184   1              Lib_Set_String(&gs_dis_pixel_var.dis_char_buff[0] ,0,DS_CHARNum);
 185   1              
 186   1          // Ôö¼ÓÓ²¼þÐ£±íÏÔÊ¾¹¦ÄÜ //
 187   1          if((gs_dis_ctl_var.item>=DIS_ADJ_CH1_0) &&(gs_dis_ctl_var.item<=DIS_DATA_CLR))
 188   1          {
 189   2              api_LCDDisplay_adj_item(gs_dis_ctl_var.item);
 190   2              //      Link_Get_Dis_Data_Num_buff();
 191   2              //      Link_Get_Dis_Char_buff();            
 192   2          //    if(gs_sys_globaL_var.work_mode != SLEEP_MODE)Link_Get_Dis_RealChar_buff();
 193   2              Link_Get_Dis_Drv_buff();                
 194   2              Write_LCD(&gs_dis_pixel_var.dis_buff[0]);         //½«Êý¾ÝÐ´ÈëÒº¾§Çý¶¯//
 195   2              return;
 196   2          }
 197   1          if(gs_dis_ctl_var.item==DIS_DATA_BROADCAST) 
 198   1          {
 199   2              api_LCDDisplay_adj_item(gs_dis_ctl_var.item);
 200   2                      Link_Get_Dis_Data_Num_buff();
 201   2                      Link_Get_Dis_Char_buff();            
 202   2              if(gs_sys_globaL_var.work_mode != SLEEP_MODE)Link_Get_Dis_RealChar_buff();
 203   2              Link_Get_Dis_Drv_buff();                
 204   2              Write_LCD(&gs_dis_pixel_var.dis_buff[0]);         //½«Êý¾ÝÐ´ÈëÒº¾§Çý¶¯//
 205   2              return;
 206   2          }
 207   1          if(gs_dis_ctl_var.item>DIS_MAX_ITEM)
 208   1          {
 209   2              gs_dis_ctl_var.item = DIS_DEFAULT_ITEM;    // ÏµÍ³ÏÔÊ¾ÏîÄ¿Òì³£ºóµÄÄ¬ÈÏÎªÏÔÊ¾ÏµÍ³´íÎóÆÁ  //
 210   2          }
 211   1      
 212   1          if(gs_dis_ctl_var.item == DIS_RESET)
 213   1          {
 214   2              Lib_Set_String(&gs_dis_pixel_var.dis_buff[0],0xff,DS_UNIT);
 215   2          }
 216   1          else
 217   1          {
 218   2                      Link_Get_DisTab_Var(gs_dis_ctl_var.item) ;              // »ñÈ¡ÏÔÊ¾ÏîÄ¿ÐÅÏ¢  //
 219   2                      Link_Get_Dis_Data_Num_buff();
 220   2              //      Link_Get_Dis_OBIS_Num_buff();                   //ÏÂÅÅÓÃÀ´ÏÔÊ¾ÆäËûÊý¾Ý //
 221   2                      Link_Get_Dis_Char_buff();            
 222   2                      if(gs_sys_globaL_var.work_mode != SLEEP_MODE)  Link_Get_Dis_RealChar_buff();
 223   2                      Link_Get_Dis_Drv_buff();                 
 224   2          }
 225   1              if(EOI_delay_1s > 0)
 226   1              {
 227   2                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_EOI;
 228   2                      gs_dis_pixel_var.dis_buff[9] |= BIT0;
 229   2                      EOI_delay_1s --;
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 5   

 230   2              }
 231   1              switch(Bar_No)
 232   1              {
 233   2                      case 1:
 234   2                              gs_dis_pixel_var.dis_buff[10] |= BIT7;
 235   2                              break;
 236   2                      case 2:
 237   2                              gs_dis_pixel_var.dis_buff[10] |= BIT7+BIT6;
 238   2                              break;
 239   2                      case 3:
 240   2                              gs_dis_pixel_var.dis_buff[10] |= BIT7+BIT6+BIT5;
 241   2                              break;
 242   2                      default:
 243   2                              break;
 244   2              }
 245   1          Write_LCD(&gs_dis_pixel_var.dis_buff[0]);         //½«Êý¾ÝÐ´ÈëÒº¾§Çý¶¯
 246   1      }
 247          
 248          
 249          /*****************************************************************************
 250          ** Function name    :api_updata_LCDDisplay_per_second
 251          **
 252          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÄÚÈÝ      
 253          **
 254          ** Parameters         :NONE          
 255          **
 256          ** Returned value   :NONE
 257          **
 258          **----------------------------------------------------------------------------
 259          ** V01.01  MJ  2016-04-23
 260          ******************************************************************************/
 261          void api_updated_LED_per_second(void)
 262          {
 263   1         // ·´ÏòÖ¸Ê¾  ÈÎÒâÒ»Ïà·´ÏòÔòµÆÁÁ//      
 264   1         if(gs_emu_run_var.net_flg&REV_TT_ACPOWER)// ÓÐ¹¦ºÏÏà¹¦ÂÊ·´Ïò
 265   1         {
 266   2              //LED_L2_REV_ON();
 267   2         }
 268   1         else 
 269   1         {
 270   2              //LED_L2_REV_OFF();
 271   2         }
 272   1      }
 273          
 274          
 275          /*****************************************************************************
 276          ** Function name    :api_init_md_data_ram
 277          **
 278          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÏîÄ¿       
 279          **
 280          ** Parameters         :NONE          
 281          **
 282          ** Returned value   :NONE
 283          **
 284          **----------------------------------------------------------------------------
 285          ** V01.01  MJ  2016-04-23
 286          ******************************************************************************/
 287          void api_updated_LCDDisplayItem_per_second(void)
 288          {
 289   1          switch (gs_dis_ctl_var.mode )
 290   1          {
 291   2              case DIS_MODE_RESET:                     
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 6   

 292   2                  gs_dis_ctl_var.keep_sec[3]--;
 293   2                  if(gs_dis_ctl_var.keep_sec[3]==0)  
 294   2                  {
 295   3                      gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
 296   3                      gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec;
 297   3                      gs_dis_ctl_var.ptr[0] = 0;
 298   3                      gs_dis_ctl_var.item = gs_dis_param.auto_item[gs_dis_ctl_var.ptr[0]+1];  //  0Î»ÖÃÎªÏÔÊ¾ÏîÄ
             -¿¸öÊý£¬1Î»ÖÃ¿ªÊ¼ÎªÏîÄ¿ //                
 299   3                                      dis_num_char = 0;//ÏÔÊ¾µ±Ç°µçÁ¿
 300   3                              }
 301   2              break;
 302   2      
 303   2              case DIS_MODE_NOMAL:
 304   2                              if(button_flag  == 1)
 305   2                              {
 306   3                                      //button_flag &= (~BIT1);
 307   3                                      button_flag = 0;
 308   3                                      if(dis_num_char < 3)
 309   3                                      {
 310   4                                              dis_num_char = 2;
 311   4                                      }
 312   3                                      if(dis_num_char == 5)
 313   3                                      {
 314   4                                              dis_num_char = 3;
 315   4                                      }
 316   3                                      else
 317   3                                      {
 318   4                                              dis_num_char ++;
 319   4                                      }
 320   3      
 321   3                                      gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec; //ÂÖÏÔ³ÖÐøÊ±¼ä//
 322   3                                      gs_dis_ctl_var.item = api_get_next_dis_item();
 323   3                              }
 324   2                              else if(MAGN_flag == 1)
 325   2                              {
 326   3                                      MAGN_flag = 0;
 327   3                                      if(dis_num_char < 3)
 328   3                                      {
 329   4                                              dis_num_char = 2;
 330   4                                      }
 331   3                                      if(dis_num_char == 5)
 332   3                                      {
 333   4                                              dis_num_char = 3;
 334   4                                      }
 335   3                                      else
 336   3                                      {
 337   4                                              dis_num_char ++;
 338   4                                      }
 339   3      
 340   3                                      gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec; //ÂÖÏÔ³ÖÐøÊ±¼ä//
 341   3                                      gs_dis_ctl_var.item = api_get_next_dis_item();
 342   3                              }
 343   2                              else
 344   2                              {
 345   3                                      if( gs_dis_ctl_var.keep_sec[0] > gs_dis_param.auto_sec)
 346   3                                      {
 347   4                                              gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec; //ÂÖÏÔ³ÖÐøÊ±¼ä//
 348   4                                      }
 349   3                                      else
 350   3                                      {
 351   4                                              gs_dis_ctl_var.keep_sec[0]--;
 352   4                                              if( gs_dis_ctl_var.keep_sec[0] == 0)
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 7   

 353   4                                              {
 354   5                                                      gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec; //ÂÖÏÔ³ÖÐøÊ±¼ä//
 355   5                                                      gs_dis_ctl_var.item = api_get_next_dis_item();
 356   5      
 357   5                                                      if(dis_num_char >= 2)
 358   5                                                      {
 359   6                                                              dis_num_char = 0;
 360   6                                                      }
 361   5                                                      else
 362   5                                                      {
 363   6                                                              dis_num_char++;//ÂÖÏÔ
 364   6                                                      }
 365   5                                              }
 366   4                                      }
 367   3                              }
 368   2              break;
 369   2      
 370   2              default:
 371   2                  gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
 372   2              break;
 373   2      
 374   2          }   
 375   1      }
 376                     
 377          /*****************************************************************************
 378          ** Function name    :api_get_next_dis_item
 379          **
 380          ** Description         :·µ»ØÏÂÒ»¸öÏÔÊ¾ÏîÄ¿     
 381          **
 382          ** Parameters         :NONE          
 383          **
 384          ** Returned value   :NONE
 385          **
 386          **----------------------------------------------------------------------------
 387          ** V01.01  MJ  2016-04-23
 388          ******************************************************************************/
 389          INT8U api_get_next_dis_item(void)
 390          {
 391   1       //INT8U vaild_len;
 392   1       INT8U item;
 393   1      
 394   1          item = DIS_DEFAULT_ITEM;
 395   1          if((gs_dis_ctl_var.mode  ==DIS_MODE_NOMAL))
 396   1          {
 397   2              gs_dis_ctl_var.ptr[0]++;
 398   2              if((gs_dis_ctl_var.ptr[0]>=(gs_dis_param.auto_item[0]))||(gs_dis_ctl_var.ptr[0]>DIS_MAX_ITEM))  //
             -ÏîÄ¿Îª0~6,¹²7Ïî //
 399   2              {
 400   3                  gs_dis_ctl_var.ptr[0]=0;
 401   3              }
 402   2      
 403   2              item = gs_dis_param.auto_item[gs_dis_ctl_var.ptr[0]+1];  //  0Î»ÖÃÎªÏÔÊ¾ÏîÄ¿¸öÊý£¬1Î»ÖÃ¿ªÊ¼ÎªÏîÄ¿ 
             -//
 404   2              if(item>DIS_MAX_ITEM)   
 405   2              {
 406   3                  item =     DIS_DEFAULT_ITEM;
 407   3              }
 408   2          }
 409   1          return (item);
 410   1      }
 411          
 412          //*****************************************************************
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 8   

 413          //  Function:       INT8U Link_Get_DisIndex(u8_dis_itm)        
 414          //  Description:    »ñÈ¡ÏÔÊ¾ÏîÄ¿ÐÅÏ¢                                        
 415          //  Input:                                                                            
 416          //  Output:         no                              
 417          //  Return:         no                              
 418          //  Others:         
 419          //***************************************************************/
 420          INT8U Link_Get_DisTab_Var(INT8U u8_dis_itm)
 421          {
 422   1       INT8U i;
 423   1       INT8U u8_result=FALSE;
 424   1      
 425   1              if(u8_dis_itm>DIS_MAX_ITEM)
 426   1              {
 427   2                      u8_dis_itm = DIS_DEFAULT_ITEM;    // ÏµÍ³ÏÔÊ¾ÏîÄ¿Òì³£ºóµÄÄ¬ÈÏÎªÏÔÊ¾ÏµÍ³´íÎóÆÁ  //
 428   2              }
 429   1      
 430   1      
 431   1              for( i = 0 ; i <=DIS_MAX_ITEM ; i++ )
 432   1              {
 433   2                      if( u8_dis_itm== LcdDisTab[i].DisID)
 434   2                      {
 435   3                              gs_LCDDISTAB_var.DisID = u8_dis_itm;
 436   3                              gs_LCDDISTAB_var.ObisNum= LcdDisTab[i].ObisNum;
 437   3                              gs_LCDDISTAB_var.Addr =LcdDisTab[i].Addr;
 438   3                              gs_LCDDISTAB_var.DisInfo = LcdDisTab[i].DisInfo;
 439   3                              gs_LCDDISTAB_var.chartype = LcdDisTab[i].chartype;
 440   3                              gs_LCDDISTAB_var.obis_digit= LcdDisTab[i].obis_digit;
 441   3                              u8_result = TRUE;
 442   3                              return (u8_result);
 443   3                      }
 444   2              }
 445   1      
 446   1              if(u8_result == FALSE )
 447   1              {
 448   2                      gs_LCDDISTAB_var.DisID = DIS_DEFAULT_ITEM;  // Ä¬ÈÏÏÔÊ¾µ±Ç°ÓÐ¹¦×Ü 
 449   2                      gs_LCDDISTAB_var.ObisNum = LcdDisTab[0x01].ObisNum;
 450   2                      gs_LCDDISTAB_var.Addr =LcdDisTab[0x01].Addr;
 451   2                      gs_LCDDISTAB_var.DisInfo = LcdDisTab[0x01].DisInfo;
 452   2                      gs_LCDDISTAB_var.chartype = LcdDisTab[0x01].chartype;           
 453   2              }
 454   1              return (u8_result);
 455   1                              
 456   1      }
 457          
 458          
 459          //*****************************************************************
 460          //  Function:      void Link_Get_Dis_OBIS_Num_buff(void)      
 461          //  Description:    »ñÈ¡OBISÇøµÄÏÔÊ¾ÄÚÈÝ£¬ 2¸ö8×ÖÇø                                       
 462          //  Input:                                                                            
 463          //  Output:         no                              
 464          //  Return:         no                              
 465          //  Others:         dis_obis_buff[0] ¶ÔÓ¦OBISÇøÏÔÊ¾µÄ×î×ó±ß1Î»(¸ßÎ»)
 466          //***************************************************************/
 467          void Link_Get_Dis_OBIS_Num_buff(void)
 468          { 
 469   1              INT8U   u8_len,u8_mem_type,lib_len;
 470   1              ST_U32_U08      u32_tmp,buffer;
 471   1              
 472   1              u8_len = (INT8U)gs_LCDDISTAB_var.DisInfo;
 473   1              
 474   1              if(u8_len>2) u8_len= 2;
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 9   

 475   1              u8_mem_type =  (INT8U)(gs_LCDDISTAB_var.DisInfo>>8);
 476   1              //¼ì²âµ½À­Õ¢ºó £¬OBISÇø¹Ì¶¨ÏÔÊ¾oFF yang 2017-12-27// 
 477   1              if(gs_relay_manage_var.u8_STA== CMD_RELAY_ON)
 478   1              {
 479   2                      gs_dis_pixel_var.dis_obis_buff[0] = 0x36 ;      //o
 480   2                      gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[0x0F]; //F
 481   2                      gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D8[0x0F];//F
 482   2                      return;
 483   2              }
 484   1              // Êý¾Ý»ñÈ¡´¦Àí  //
 485   1              switch (gs_LCDDISTAB_var.chartype)
 486   1              {
 487   2                      case CHAR_V://Êý¾ÝÇ°ÒÆ1Î»
 488   2                                              mem_read(&u32_tmp.B08[2],gs_LCDDISTAB_var.Addr, 2, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
 489   2                                              Lib_word_bcd2(&buffer.B08[0],u32_tmp.W16[1]);              //  16½øÖÆ×ª10½øÖÆ// 
 490   2                              break;
 491   2                              
 492   2                      case CHAR_HZ:
 493   2                                      mem_read(&u32_tmp.B08[2],gs_LCDDISTAB_var.Addr, 2, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
 494   2                                      Lib_word_bcd2(&buffer.B08[0],u32_tmp.W16[1]);              //  16½øÖÆ×ª10½øÖÆ// 
 495   2      //                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P9; 
 496   2                              break;
 497   2                              
 498   2                      case CHAR_PF:
 499   2                                              mem_read(&u32_tmp.B08[2],gs_LCDDISTAB_var.Addr, 2, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
 500   2                                              Lib_word_bcd2(&buffer.B08[0],u32_tmp.W16[1]);              //  16½øÖÆ×ª10½øÖÆ// 
 501   2                                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P8; 
 502   2                              break;
 503   2      
 504   2                      case CHAR_A: //xxx.xxx A
 505   2                                              mem_read(&u32_tmp.B08[0],gs_LCDDISTAB_var.Addr, 4, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
 506   2                                              Lib_long_bcd4(&buffer.B08[0],u32_tmp.u32);                      //      16½øÖÆ×ª10½øÖÆ// 
 507   2                                              lib_len=Lib_ENOB_Get(&buffer.B08[0],4,1);
 508   2                                              if(lib_len<=4)
 509   2                                              {
 510   3                                                      buffer.u32 =((buffer.u32&0x0000FFFF)<<16);
 511   3                                                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P8; 
 512   3                                              }
 513   2                                              else if(lib_len==5)
 514   2                                              {
 515   3                                                      buffer.u32 =((buffer.u32&0x000FFFFF)<<12);
 516   3      //                                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P9; 
 517   3                                              }
 518   2                                              else if(lib_len==6)
 519   2                                              {
 520   3                                                      buffer.u32 =((buffer.u32&0x00FFFFFF)<<8);
 521   3                                              }
 522   2                                              else if(lib_len==7)
 523   2                                              {
 524   3                                                      buffer.u32 =((buffer.u32&0x0FFFFFFF)<<4);
 525   3                                              }
 526   2                                              else 
 527   2                                              {
 528   3                                                      buffer.u32 =(buffer.u32&0xFFFFFFFF);
 529   3                                              }
 530   2                              break;                  
 531   2                      case CHAR_KW:// xx.xxxx kW
 532   2                                              mem_read(&u32_tmp.B08[0],gs_LCDDISTAB_var.Addr, 4, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
 533   2                                              Lib_long_bcd4(&buffer.B08[0],u32_tmp.u32);                      //      16½øÖÆ×ª10½øÖÆ// 
 534   2                                              lib_len=Lib_ENOB_Get(&buffer.B08[0],4,1);
 535   2                                              if(lib_len<=5)
 536   2                                              {
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 10  

 537   3                                                      buffer.u32 =((buffer.u32&0x000FFFFF)<<12);
 538   3                                                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P8; 
 539   3                                              }
 540   2                                              else if(lib_len==6)
 541   2                                              {
 542   3                                                      buffer.u32 =((buffer.u32&0x00FFFFFF)<<8);
 543   3      //                                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P9; 
 544   3                                              }
 545   2                                              else if(lib_len==7)
 546   2                                              {
 547   3                                                      buffer.u32 =((buffer.u32&0x0FFFFFFF)<<4);
 548   3                                              }
 549   2                                              else 
 550   2                                              {
 551   3                                                      buffer.u32 =(buffer.u32&0xFFFFFFFF);
 552   3                                              }
 553   2                              break;                  
 554   2      
 555   2                                              
 556   2                      default:
 557   2                              mem_read(&buffer.B08[0],gs_LCDDISTAB_var.Addr, u8_len, u8_mem_type);            //»ñÈ¡µ±Ç°Êý¾Ý //
 558   2                              break;
 559   2              }
 560   1              // ²âÊÔ/// 0XE6
 561   1              //      buffer.B08[3] = 0XE6;
 562   1              //      buffer.B08[2] = 0x07;
 563   1              //      buffer.B08[1] = 0x42;
 564   1              //      buffer.B08[0] = 0x48;
 565   1              //////////////
 566   1              
 567   1                      switch(u8_len)
 568   1                      {
 569   2                              case 2:
 570   2                                      gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[(buffer.B08[0]&0xF0)>>4] ;  
 571   2                                      gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[(buffer.B08[0]&0x0F)]; 
 572   2                                      gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D8[(buffer.B08[1]&0xF0)>>4] ;  
 573   2                                      break;
 574   2                              case 1:
 575   2                                      gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[(buffer.B08[1]&0xF0)>>4] ;  
 576   2                                      gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D8[(buffer.B08[1]&0x0F)]; 
 577   2                                      break;
 578   2                              default:          // ³¤¶ÈÎª0 ÏÔÊ¾¿Õ
 579   2                                         break;
 580   2                      }
 581   1                      
 582   1      
 583   1      }               
 584                          
 585          
 586          
 587          //*****************************************************************
 588          //  Function:      void Link_Get_Dis_OBIS_Num_buff(void)      
 589          //  Description:    »ñÈ¡DATAÇøµÄÏÔÊ¾ÄÚÈÝ£¬ 8¸ö8×ÖÇø                                       
 590          //  Input:                                                                            
 591          //  Output:         no                              
 592          //  Return:         no                              
 593          //  Others:         dis_data_buff[0] ¶ÔÓ¦NUMÇøÏÔÊ¾µÄ×î×ó±ß1Î»(¸ßÎ»)
 594          //***************************************************************/
 595          void Link_Get_Dis_Data_Num_buff(void)
 596          {
 597   1              ST_U32_U08   buffer;
 598   1              INT8U  temp[6];
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 11  

 599   1              NEW_MMD_DATA_UNIT t;
 600   1              RTC_TYPE rtc_data_tmp;
 601   1              ////ÉÏÅÅ¹Ì¶¨ÏÔÊ¾µ±Ç°×ÜµçÁ¿ yana 2017-12-15////  2018-11-20¸ÄÎªÉÏÅÅÏÔÊ¾¿É±äcxy
 602   1      
 603   1              if(dis_data_type == CHAR_TIME && dis_data_sec != 0)
 604   1              {       //ÏÔÊ¾Ê±¼ä
 605   2                      Get_RTCTime(&rtc_data_tmp);
 606   2      
 607   2                      gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[rtc_data_tmp.Hour>>4];
 608   2                      gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[rtc_data_tmp.Hour&0x0F];
 609   2                      gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[rtc_data_tmp.Minute>>4];
 610   2                      gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[rtc_data_tmp.Minute&0x0F];
 611   2                      gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[rtc_data_tmp.Second>>4];
 612   2                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[rtc_data_tmp.Second&0x0F];
 613   2                      dis_data_sec --;
 614   2                      if(dis_data_sec == 0){dis_data_type = 0;}
 615   2              }
 616   1              else
 617   1              {       
 618   2                      if(dis_num_char == 0)
 619   2                      {
 620   3                              //ÏÔÊ¾µ±Ç°µçÁ¿ kwh
 621   3                              mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RAM)
             -;          //»ñÈ¡µ±Ç°Êý¾Ý //
 622   3                              //mem_read(&temp[0], ADR_BLOCK00_EC_L0_E2P, 6, MEM_E2P1);
 623   3                              api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 624   3                              //debug////
 625   3                              //buffer.B08[1]=0x12;
 626   3                              //buffer.B08[2]=0x34;
 627   3                              //buffer.B08[3]=0x56;
 628   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4] ;  
 629   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0x0F)];
 630   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4] ;  
 631   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0x0F)]; 
 632   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4] ;  
 633   3                              if(gs_dis_param.ec_form!=0x50)
 634   3                              {
 635   4                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0x0F)]; 
 636   4                              }
 637   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 638   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 639   3                              gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[0]; 
 640   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[1] ;
 641   3                      }
 642   2                      if(dis_num_char == 1)
 643   2                      {
 644   3                              //ÏÔÊ¾µ±Ç°ÐèÁ¿kw
 645   3                              //mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RA
             -M);          //»ñÈ¡µ±Ç°Êý¾Ý //
 646   3      //                      mem_read(&t, ADR_BLOCK_4MMD_L0_E2P, 4, MEM_E2P1);
 647   3                              mem_read(&t, &st_mmd_unit_array[0].buf[0],4,MEM_RAM);                               
*** WARNING C182 IN LINE 647 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: pointer to different objects
*** WARNING C214 IN LINE 647 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: 'Argument': conversion: pointer to non-pointer
 648   3                              Lib_long_bcd4(&buffer.B08[0],t.val.val_hex32);
 649   3      //                      mem_read(&buffer.B08[0], ADR_BLOCK_4MMD_L0_E2P, 4, MEM_E2P1);
 650   3      //                      api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 651   3                              //debug////
 652   3                              //buffer.B08[1]=0x12;
 653   3                              //buffer.B08[2]=0x34;
 654   3                              //buffer.B08[3]=0x56;
 655   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[0]&0x0F)] ;  
 656   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4];
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 12  

 657   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[1]&0x0F)] ;  
 658   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4]; 
 659   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[2]&0x0F)] ;  
 660   3      //                      if(gs_dis_param.ec_form!=0x50)
 661   3      //                      {
 662   3                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4]; 
 663   3      //                      }
 664   3      
 665   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 666   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 667   3                              gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[0]; 
 668   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[2] ;
 669   3                      }
 670   2                      if(dis_num_char == 2)
 671   2                      {
 672   3                              //ÏÔÊ¾µ±Ç°ÀÛ¼ÆÐèÁ¿kw
 673   3      //                      mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RA
             -M);          //»ñÈ¡µ±Ç°Êý¾Ý //
 674   3      //                      mem_read(&t, ADR_BLOCK_4MMD_sum_L0_E2P, 4, MEM_E2P1);
 675   3                              mem_read(&t, &sum_st_mmd_unit_array[0].buf[0],4,MEM_RAM);
*** WARNING C182 IN LINE 675 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: pointer to different objects
*** WARNING C214 IN LINE 675 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: 'Argument': conversion: pointer to non-pointer
 676   3                              Lib_long_bcd4(&buffer.B08[0],t.val.val_hex32);
 677   3      //                      api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 678   3                              //debug////
 679   3                              //buffer.B08[1]=0x12;
 680   3                              //buffer.B08[2]=0x34;
 681   3                              //buffer.B08[3]=0x56;
 682   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[0]&0x0F)] ;  
 683   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4];
 684   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[1]&0x0F)] ;  
 685   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4]; 
 686   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[2]&0x0F)] ;  
 687   3      //                      if(gs_dis_param.ec_form!=0x50)
 688   3      //                      {
 689   3                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4]; 
 690   3      //                      }
 691   3      
 692   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 693   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 694   3                              gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[0]; 
 695   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[4] ;
 696   3                      }
 697   2                      if(dis_num_char == 3)
 698   2                      {
 699   3                              //ÏÔÊ¾Ç°Ò»ÌìµçÁ¿kwh
 700   3      //                      mem_read(&temp[0], ADR_BLOCK_4Energy_L0_E2P+LEN_BLOCK_4Energy_E2P/4, LEN_BLOCK_4Energy_E2P/4, MEM_E2P
             -1);          //»ñÈ¡µ±Ç°Êý¾Ý //
 701   3                              mem_read(&temp[0], &energy_data_array[1].buf[0], LEN_BLOCK_4Energy_E2P/4,MEM_RAM);
*** WARNING C214 IN LINE 701 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: 'Argument': conversion: pointer to non-pointer
 702   3                              api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 703   3                              //debug////
 704   3                              //buffer.B08[1]=0x12;
 705   3                              //buffer.B08[2]=0x34;
 706   3                              //buffer.B08[3]=0x56;
 707   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4] ;  
 708   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0x0F)];
 709   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4] ;  
 710   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0x0F)]; 
 711   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4] ;  
 712   3                              if(gs_dis_param.ec_form!=0x50)
 713   3                              {
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 13  

 714   4                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0x0F)]; 
 715   4                              }
 716   3      
 717   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 718   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 719   3                              gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[2]; 
 720   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[1] ;
 721   3                      }
 722   2                      if(dis_num_char == 4)
 723   2                      {
 724   3                              //ÏÔÊ¾Ç°Ò»ÌìÐèÁ¿kw
 725   3      //                      mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RA
             -M);          //»ñÈ¡µ±Ç°Êý¾Ý //
 726   3      //                      mem_read(&t, ADR_BLOCK_4MMD_L0_E2P+LEN_NEW_MMD_UNIT, 4, MEM_E2P1);
 727   3                              mem_read(&t, &st_mmd_unit_array[0].buf[0]+LEN_NEW_MMD_UNIT,4,MEM_RAM);
*** WARNING C182 IN LINE 727 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: pointer to different objects
*** WARNING C214 IN LINE 727 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: 'Argument': conversion: pointer to non-pointer
 728   3                              Lib_long_bcd4(&buffer.B08[0],t.val.val_hex32);
 729   3      //                      api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 730   3                              //debug////
 731   3                              //buffer.B08[1]=0x12;
 732   3                              //buffer.B08[2]=0x34;
 733   3                              //buffer.B08[3]=0x56;
 734   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[0]&0x0F)] ;  
 735   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4];
 736   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[1]&0x0F)] ;  
 737   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4]; 
 738   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[2]&0x0F)] ;  
 739   3      //                      if(gs_dis_param.ec_form!=0x50)
 740   3      //                      {
 741   3                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4]; 
 742   3      //                      }
 743   3      
 744   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 745   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 746   3                              gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[2]; 
 747   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[2] ;
 748   3                      }
 749   2                      if(dis_num_char == 5)
 750   2                      {
 751   3                              //ÏÔÊ¾Ç°Ò»ÌìÀÛ¼ÆÐèÁ¿kw
 752   3      //                      mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RA
             -M);          //»ñÈ¡µ±Ç°Êý¾Ý //
 753   3                              mem_read(&t, ADR_BLOCK_4MMD_sum_L0_E2P+LEN_SUM_MMD_UNIT, 4, MEM_E2P1);
*** WARNING C182 IN LINE 753 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: pointer to different objects
 754   3                              mem_read(&t, &sum_st_mmd_unit_array[0].buf[0]+LEN_SUM_MMD_UNIT,4,MEM_RAM);
*** WARNING C182 IN LINE 754 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: pointer to different objects
*** WARNING C214 IN LINE 754 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: 'Argument': conversion: pointer to non-pointer
 755   3                              Lib_long_bcd4(&buffer.B08[0],t.val.val_hex32);
 756   3      //                      api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 757   3                              //debug////
 758   3                              //buffer.B08[1]=0x12;
 759   3                              //buffer.B08[2]=0x34;
 760   3                              //buffer.B08[3]=0x56;
 761   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[0]&0x0F)] ;  
 762   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4];
 763   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[1]&0x0F)] ;  
 764   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4]; 
 765   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[2]&0x0F)] ;  
 766   3      //                      if(gs_dis_param.ec_form!=0x50)
 767   3      //                      {
 768   3                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4]; 
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 14  

 769   3      //                      }
 770   3      
 771   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 772   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 773   3                              gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[2]; 
 774   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[4] ;
 775   3                      }
 776   2              }
 777   1      }
 778          //*****************************************************************
 779          //  Function:       void Link_Get_Dis_Char_buff(void) 
 780          //  Description:    »ñÈ¡ÏÔÊ¾µÄÅäºÏ×Ö·ûÐÅÏ¢                                      
 781          //  Input:                                                                            
 782          //  Output:         no                              
 783          //  Return:         no                              
 784          //  Others:         
 785          //***************************************************************/
 786          void Link_Get_Dis_Char_buff(void)
 787          {
 788   1      //      RTC_TYPE rtc_data_tmp;
 789   1      //      Get_RTCTime(&rtc_data_tmp);//»ñÈ¡Ê±¼äÏÔÊ¾·ÑÂÊ
 790   1      //      if(rtc_data_tmp.Hour)
 791   1              //2019-01-25 cxy ÏÂµç²»ÏÔÊ¾·ÑÂÊºÅ
 792   1              if(gs_sys_globaL_var.work_mode != SLEEP_MODE)
 793   1              {
 794   2                      switch (gs_current_triff_var.triff_No)//ÏÔÊ¾·ÑÂÊ
 795   2                      {
 796   3                              case 1:
 797   3                                      gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_S1;
 798   3                                      break;
 799   3                              case 2:
 800   3                                      gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_S2;
 801   3                                      break;
 802   3                              case 3:
 803   3                                      gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_S3;
 804   3                                      break;
 805   3                              case 4:
 806   3                                      gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_S4;
 807   3                                      break;
 808   3                      }
 809   2              }
 810   1              if(dis_data_type == CHAR_TIME)
 811   1              {
 812   2                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P1P2;
 813   2                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P4P5;
 814   2              }
 815   1              else
 816   1              {       
 817   2                      if(dis_num_char == 0 || dis_num_char == 3)
 818   2                      {
 819   3                              if(gs_dis_param.ec_form!=0x50)
 820   3                              {
 821   4                                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P6;  //
 822   4                              }
 823   3                              gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_kWh;  //kWh
 824   3                      }
 825   2                      else
 826   2                      {
 827   3      //                      if(gs_dis_param.ec_form!=0x50)
 828   3      //                      {
 829   3      //                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P6;  //
 830   3      //                      }
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 15  

 831   3                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P3;
 832   3                              gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_kW;  //kW
 833   3                              gs_dis_pixel_var.dis_char_buff[2] |= CHAR_DATA_MD;
 834   3                      }
 835   2              }
 836   1              if(gs_relay_manage_var.u8_STA== CMD_RELAY_ON)
 837   1              {
 838   2                      return;
 839   2              }
 840   1              if(gs_dis_ctl_var.item== DIS_DATA_CLR)
 841   1              {
 842   2                      return;
 843   2              }
 844   1      
 845   1              // DATA ÇøµÄÐ¡ÊýµãºÍµ¥Î»×Ö·û»ñÈ¡ //
 846   1      //      switch(gs_LCDDISTAB_var.chartype)
 847   1              switch(gs_LCDDISTAB_var.chartype = 10)
*** WARNING C276 IN LINE 847 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: constant in condition expression
 848   1              {
 849   2                      case CHAR_V:    // µçÑ¹ÏÔÊ¾ xxx V //
 850   2                              gs_dis_pixel_var.dis_char_buff[2] |= CHAR_DATA_V; 
 851   2                              break;
 852   2                      case CHAR_A:    // µçÁ÷ÏÔÊ¾ xx.x A//
 853   2                              gs_dis_pixel_var.dis_char_buff[2] |= CHAR_DATA_A; 
 854   2                              break;
 855   2                      case CHAR_KW:    // ¹¦ÂÊÏÔÊ¾ xx.x kw//
 856   2      //                  gs_dis_pixel_var.dis_char_buff[2] |= (CHAR_DATA_k+CHAR_DATA_W);  //kW
 857   2                              break;
 858   2                      case CHAR_HZ:   // ÆµÂÊÏÔÊ¾ xx.x HZ//
 859   2                          gs_dis_pixel_var.dis_char_buff[2] |= CHAR_DATA_Hz;  //Hz
 860   2                              break;
 861   2                      default:
 862   2                              break;
 863   2              }       
 864   1      
 865   1              //////////////////////////////////////////////////////////////////////////////////////////////
 866   1      
 867   1              if(IsModeTest == TRUE)  gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_TEST ;
 868   1              ///////////////////////////////////////////////////////////////////////////////////////////////         
 869   1      }
 870          
 871          //*****************************************************************
 872          //  Function:       INT8U Link_Get_DisIndex(u8_dis_itm)        
 873          //  Description:    »ñÈ¡ÏÔÊ¾ÏîÄ¿ÐÅÏ¢                                        
 874          //  Input:                                                                            
 875          //  Output:         no                              
 876          //  Return:         no                              
 877          //  Others:         
 878          //***************************************************************/
 879          void Link_Get_Dis_RealChar_buff(void)
 880          {
 881   1      
 882   1               if(gs_measure_status_judge_var.u8_status & VBAT_LOW)           gs_dis_pixel_var.dis_char_buff[2] |=CHAR_
             -DATA_S9;        //µç³ØÇ·Ñ¹
 883   1               if(gs_emu_run_var.net_flg&REV_TT_ACPOWER)
 884   1              {
 885   2                      gs_dis_pixel_var.dis_char_buff[1] |=CHAR_DATA_Received;//·´ÏòÌáÊ¾
 886   2              }
 887   1               else
 888   1              {
 889   2                       gs_dis_pixel_var.dis_char_buff[1] |=CHAR_DATA_Delivered;// Ä¬ÈÏÕýÏòÏÔÊ¾
 890   2              }
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 16  

 891   1      }
 892          
 893          
 894          //*****************************************************************
 895          //  Function:      void Link_Get_Dis_Drv_buff(void)   
 896          //  Description:    »ñÈ¡ÏÔÊ¾»º³åbuffµÄÊý¾Ý                                    
 897          //  Input:                                                                            
 898          //  Output:         no                              
 899          //  Return:         no                              
 900          //  Others:         
 901          //***************************************************************/
 902          void Link_Get_Dis_Drv_buff(void)
 903          {
 904   1              gs_dis_pixel_var.dis_buff[0] |= (gs_dis_pixel_var.dis_data_buff[0] &0x7F);
 905   1              gs_dis_pixel_var.dis_buff[1] |= (gs_dis_pixel_var.dis_data_buff[1] &0x7F);
 906   1              gs_dis_pixel_var.dis_buff[2] |= (gs_dis_pixel_var.dis_data_buff[2] &0x7F);
 907   1              gs_dis_pixel_var.dis_buff[3] |= (gs_dis_pixel_var.dis_data_buff[3] &0x7F);
 908   1              gs_dis_pixel_var.dis_buff[4] |= (gs_dis_pixel_var.dis_data_buff[4] &0x7F);
 909   1              gs_dis_pixel_var.dis_buff[5] |= (gs_dis_pixel_var.dis_data_buff[5] &0x7F);
 910   1      
 911   1              gs_dis_pixel_var.dis_buff[6] |= (gs_dis_pixel_var.dis_obis_buff[0] &0xEF);
 912   1              gs_dis_pixel_var.dis_buff[7] |= (gs_dis_pixel_var.dis_obis_buff[1] &0xEF);
 913   1      //      gs_dis_pixel_var.dis_buff[8] |= (gs_dis_pixel_var.dis_obis_buff[2] &0xEF);
 914   1      
 915   1              
 916   1               //  dis_var.dis_char_buff[0:2] µÄ×ª»»//
 917   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P1P2)   {gs_dis_pixel_var.dis_buff[1] |= BIT7;gs_dis_pixel_
             -var.dis_buff[2] |= BIT7;}
 918   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P3)     gs_dis_pixel_var.dis_buff[3] |= BIT7;
 919   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P4P5)   {gs_dis_pixel_var.dis_buff[4] |= BIT7;gs_dis_pixe
             -l_var.dis_buff[8] |= BIT7;}
 920   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P6)     gs_dis_pixel_var.dis_buff[5] |= BIT7;
 921   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P7)     gs_dis_pixel_var.dis_buff[6] |= BIT4;
 922   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P8)     gs_dis_pixel_var.dis_buff[7] |= BIT4;
 923   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_EOI)     gs_dis_pixel_var.dis_buff[9] |= BIT0;
 924   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_TEST)     gs_dis_pixel_var.dis_buff[10] |= BIT0;
 925   1      
 926   1              
 927   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_kWh)    {gs_dis_pixel_var.dis_buff[9] |= BIT6;gs_dis_pixe
             -l_var.dis_buff[9] |= BIT2;}
 928   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_kW)     gs_dis_pixel_var.dis_buff[9] |= BIT6;
 929   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_S1)     gs_dis_pixel_var.dis_buff[8] |= BIT6;
 930   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_S2)     gs_dis_pixel_var.dis_buff[8] |= BIT7;
 931   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_S3)     gs_dis_pixel_var.dis_buff[8] |= BIT4;
 932   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_S4)     gs_dis_pixel_var.dis_buff[8] |= BIT5;
 933   1      
 934   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_Received)       gs_dis_pixel_var.dis_buff[11] |= BIT6;
 935   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_Delivered)      gs_dis_pixel_var.dis_buff[11] |= BIT5;
 936   1      
 937   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_V)              gs_dis_pixel_var.dis_buff[9] |= BIT4;
 938   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_A)              gs_dis_pixel_var.dis_buff[9] |= BIT5;
 939   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_Hz)             gs_dis_pixel_var.dis_buff[9] |= BIT1;
 940   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_MD)             gs_dis_pixel_var.dis_buff[8] |= BIT0;
 941   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_S9)             gs_dis_pixel_var.dis_buff[10] |= BIT1;
 942   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_S12)            gs_dis_pixel_var.dis_buff[10] |= BIT7;
 943   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_S13)            gs_dis_pixel_var.dis_buff[10] |= BIT6;
 944   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_S14)            gs_dis_pixel_var.dis_buff[10] |= BIT5;
 945   1              
 946   1              
 947   1      }
 948          
 949          
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 17  

 950          /*****************************************************************************
 951          ** Function name    :api_clr_current_energy_data
 952          **
 953          ** Description         : ÐèÁ¿µçÁ¿Êý¾Ý×ª»»
 954          **
 955          ** Parameters         :  type Êý¾ÝÀàÐÍ     0Ä¬ÈÏÈ«ÕûÊý 
 956          **
 957          ** Returned value   :NONE
 958          **
 959          **----------------------------------------------------------------------------
 960          ** V01.01  MJ  2016-04-23
 961          ******************************************************************************/
 962          void api_get_energy_LCD(uint8*  temp, uint8 type, uint8*  result)
 963          {
 964   1       ST_U32_U08   u32_result, BCD_temp;
 965   1       US_EC_DATA_UNIT ec_tmp;
 966   1         
 967   1          // if(type!=0x50)     type= 0x51;
 968   1          //µçÁ¿¸ñÊ½Êý¾Ý¸³Öµ //
 969   1          Lib_Copy_Str_TwoArry(&ec_tmp.buf[0], temp, LEN_EC_UNIT);
 970   1              
 971   1          u32_result.u32 =0;
 972   1      
 973   1              if(type==0x80)
 974   1          {
 975   2              if(ec_tmp.val.integ_hex32>=100000000)   ec_tmp.val.integ_hex32 -=100000000;
 976   2              Lib_long_bcd4(&u32_result.B08[0],ec_tmp.val.integ_hex32);       
 977   2          }
 978   1          
 979   1          if(type==0x62)
 980   1          {
 981   2              // ÕûÊý²¿·Ö´¦Àí //
 982   2              if(ec_tmp.val.integ_hex32>=1000000)   ec_tmp.val.integ_hex32 -=1000000;
 983   2              Lib_long_bcd4(&BCD_temp.B08[0],ec_tmp.val.integ_hex32);
 984   2              u32_result.B08[0]= BCD_temp.B08[1];
 985   2              u32_result.B08[1]= BCD_temp.B08[2];
 986   2              u32_result.B08[2]= BCD_temp.B08[3];
 987   2      
 988   2               // Ð¡Êý²¿·Ö´¦Àí //
 989   2               ec_tmp.val.decim_hex16  /= METER_CONST_10WH;
 990   2               u32_result.B08[3] = Lib_byte_bcd((INT8U)ec_tmp.val.decim_hex16);
 991   2      
 992   2          }
 993   1          if(type==0x60)
 994   1          {
 995   2              if(ec_tmp.val.integ_hex32>=1000000)   ec_tmp.val.integ_hex32 -=1000000;
 996   2              Lib_long_bcd4(&u32_result.B08[0],ec_tmp.val.integ_hex32);       
 997   2          }
 998   1          
 999   1          if(type==0x61)
1000   1          {
1001   2              // ÕûÊý²¿·Ö´¦Àí //
1002   2              if(ec_tmp.val.integ_hex32>=1000000)   ec_tmp.val.integ_hex32 -=1000000;
1003   2              Lib_long_bcd4(&BCD_temp.B08[0],ec_tmp.val.integ_hex32);
1004   2              u32_result.B08[0]= BCD_temp.B08[1];
1005   2              u32_result.B08[1]= BCD_temp.B08[2];
1006   2              u32_result.B08[2]= BCD_temp.B08[3];
1007   2      
1008   2               // Ð¡Êý²¿·Ö´¦Àí //
1009   2               ec_tmp.val.decim_hex16  /= METER_CONST_10WH;
1010   2               u32_result.B08[3] = Lib_byte_bcd((INT8U)ec_tmp.val.decim_hex16);
1011   2      
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 18  

1012   2          }
1013   1          if(type==0x51)
1014   1          {
1015   2                      // ÕûÊý²¿·Ö´¦Àí //
1016   2                      if(ec_tmp.val.integ_hex32>=100000)   ec_tmp.val.integ_hex32 -=100000;
1017   2                      Lib_long_bcd4(&BCD_temp.B08[0],ec_tmp.val.integ_hex32);
1018   2                      u32_result.B08[0]= 0x00;
1019   2                      u32_result.B08[1]= (((BCD_temp.B08[1]&0x0F)<<4)+((BCD_temp.B08[2]&0xF0)>>4));
1020   2                      u32_result.B08[2]= (((BCD_temp.B08[2]&0x0F)<<4)+((BCD_temp.B08[3]&0xF0)>>4));
1021   2                      u32_result.B08[3]|= ((BCD_temp.B08[3]&0x0F)<<4);
1022   2      
1023   2                      // Ð¡Êý²¿·Ö´¦Àí //
1024   2                      ec_tmp.val.decim_hex16  /= METER_CONST_10WH;
1025   2                      u32_result.B08[3]|=(((Lib_byte_bcd((INT8U)ec_tmp.val.decim_hex16))&0xF0)>>4);
1026   2          }
1027   1          if(type==0x50)
1028   1          {
1029   2                      // ÕûÊý²¿·Ö´¦Àí //
1030   2                      if(ec_tmp.val.integ_hex32>=100000)   ec_tmp.val.integ_hex32 -=100000;
1031   2                      Lib_long_bcd4(&BCD_temp.B08[0],ec_tmp.val.integ_hex32);
1032   2                      u32_result.B08[0]= 0x00;
1033   2                      u32_result.B08[1]= (((BCD_temp.B08[1]&0x0F)<<4)+((BCD_temp.B08[2]&0xF0)>>4));
1034   2                      u32_result.B08[2]= (((BCD_temp.B08[2]&0x0F)<<4)+((BCD_temp.B08[3]&0xF0)>>4));
1035   2                      u32_result.B08[3]|= ((BCD_temp.B08[3]&0x0F)<<4);
1036   2          }
1037   1          //Êý¾ÝÊä³ö //
1038   1          Lib_Copy_Str_TwoArry(result, &u32_result.B08[0], 4);
1039   1      
1040   1      }
1041          
1042          
1043          /*****************************************************************************
1044          ** Function name    :api_init_md_data_ram
1045          **
1046          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÏîÄ¿       
1047          **
1048          ** Parameters         :NONE          
1049          **
1050          ** Returned value   :NONE
1051          **
1052          **----------------------------------------------------------------------------
1053          ** V01.01  MJ  2016-04-23
1054          ******************************************************************************/
1055          void api_chg_LCDDisplay_adj_item(uint8 u8_item)
1056          {
1057   1          if((u8_item>=DIS_ADJ_CH1_0) &&(u8_item<=DIS_DATA_BROADCAST))
1058   1          {
1059   2              //¸ü¸ÄÐ£×¼ÏÔÊ¾ÏîÄ¿//
1060   2              gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
1061   2                      if(u8_item==DIS_DATA_BROADCAST)
1062   2                      {
1063   3                      gs_dis_ctl_var.keep_sec[0] = 10;    //Ç¿ÖÆÏÔÊ¾10Ãë //
1064   3                      }
1065   2                      else
1066   2                      {
1067   3                      gs_dis_ctl_var.keep_sec[0] = 5;    //Ç¿ÖÆÏÔÊ¾5Ãë //
1068   3                      }
1069   2                      //gs_dis_ctl_var.keep_sec[0] = 2;
1070   2              gs_dis_ctl_var.ptr[0] = 0;
1071   2              gs_dis_ctl_var.item = u8_item;    
1072   2          }
1073   1          else
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 19  

1074   1          {
1075   2              //Òì³£Çé¿öÏÂÏÔÊ¾×Ô¶¯Ñ­ÏÔÏîÄ¿ //
1076   2              gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
1077   2              gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec;
1078   2              gs_dis_ctl_var.ptr[0] = 0;
1079   2              gs_dis_ctl_var.item = gs_dis_param.auto_item[gs_dis_ctl_var.ptr[0]+1];  //  0Î»ÖÃÎªÏÔÊ¾ÏîÄ¿¸öÊý£¬1
             -Î»ÖÃ¿ªÊ¼ÎªÏîÄ¿ //  
1080   2          }
1081   1      
1082   1          api_updated_LCDDisplayPixel_per_second();
1083   1      }
1084          
1085          /*****************************************************************************
1086          ** Function name    :api_init_md_data_ram
1087          **
1088          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÏîÄ¿       
1089          **
1090          ** Parameters         :NONE          
1091          **
1092          ** Returned value   :NONE
1093          **
1094          **----------------------------------------------------------------------------
1095          ** V01.01  MJ  2016-04-23
1096          ******************************************************************************/
1097          void api_LCDDisplay_adj_item(uint8 u8_item)
1098          {
1099   1              INT8U adr[6];
1100   1          if((u8_item<DIS_ADJ_CH1_0) &&(u8_item>DIS_DATA_BROADCAST))
1101   1          {
1102   2              return;
1103   2          }
1104   1      
1105   1          Lib_Set_String(&gs_dis_pixel_var.dis_data_buff[0],0,DS_DATANum);    
1106   1          Lib_Set_String(&gs_dis_pixel_var.dis_obis_buff[0],0,DS_OBISNum);
1107   1          Lib_Set_String(&gs_dis_pixel_var.dis_char_buff[0] ,0,DS_CHARNum);
1108   1      
1109   1          // Êý¾Ý»ñÈ¡´¦Àí  //A F E D B G C MD  //
1110   1          switch (u8_item)
1111   1          {
1112   2              case DIS_ADJ_CH1_0:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1113   2              case DIS_ADJ_CH1_1:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1114   2              case DIS_ADJ_CH1_2:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1115   2              case DIS_ADJ_CH1_3:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1116   2                  gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[0X0C]       ;      //LCD-D1  C  //
1117   2                  gs_dis_pixel_var.dis_data_buff[1] = 0x76    ;               //LCD-D2  H  //
1118   2                  gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[0X01]       ;     //LCD-D3  1  //
1119   2                  gs_dis_pixel_var.dis_data_buff[3] = 0X20    ;                 //LCD-D4  -//
1120   2                  gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(u8_item&0X0F)]     ;  //LCD-D5  0~3  //
1121   2              break;
1122   2      
1123   2              case DIS_ADJ_CH2_0:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1124   2              case DIS_ADJ_CH2_1:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1125   2              case DIS_ADJ_CH2_2:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1126   2              case DIS_ADJ_CH2_3:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1127   2                  gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[0X0C]       ;      //LCD-D1  C  //
1128   2                  gs_dis_pixel_var.dis_data_buff[1] = 0x76    ;                                //LCD-D2  H  //
1129   2                  gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[0X02]       ;     //LCD-D3  2  //
1130   2                  gs_dis_pixel_var.dis_data_buff[3] = 0X20    ;                                 //LCD-D4  -//
1131   2                  gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(u8_item&0X0F)-4]   ;     //LCD-D5  0~3  //
1132   2              break;
1133   2      
1134   2              case DIS_DATA_CLR:      //ÇåÁãÏÔÊ¾ //
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/09/2019 13:53:49 PAGE 20  

1135   2      //            gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[0X0C]     ;      //LCD-D1  C  //
1136   2      //            gs_dis_pixel_var.dis_obis_buff[1] = 0xA1  ;              //LCD-D2  L  //
1137   2      //            gs_dis_pixel_var.dis_obis_buff[2] = 0x60  ;              //LCD-D3  r  //
1138   2                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[0X0C]   ;      //LCD-D1  C  //
1139   2                              gs_dis_pixel_var.dis_data_buff[1] = 0x58;                                //LCD-D2  L  //
1140   2                  gs_dis_pixel_var.dis_data_buff[2] = 0x60;     //LCD-D3  r  //
1141   2              break;
1142   2                      
1143   2      //        case DIS_DATA_BROADCAST:      //¹ã²¥ÃüÁîÏÔÊ¾Í¨Ñ¶µØÖ· //
1144   2      //                      mem_read(&adr[0], ADR_METER_PARAM1_RF_COMM_ID, 6, MEM_E2P1);//¶ÁÈ¡RFÍ¨Ñ¶µØÖ·
1145   2      //            gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(adr[1]&0x0F)];  
1146   2      //            gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(adr[2]&0xF0)>>4];
1147   2      //            gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(adr[2]&0x0F)];
1148   2      //            gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(adr[3]&0xF0)>>4];
1149   2      //            gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(adr[3]&0x0F)];
1150   2      //            gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(adr[4]&0xF0)>>4];
1151   2      //            gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[(adr[4]&0x0F)];
1152   2      //            gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[(adr[5]&0xF0)>>4];
1153   2      //            gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D8[(adr[5]&0x0F)];
1154   2      //        break;
1155   2              default:        
1156   2                  sys_err();
1157   2              break;
1158   2          }
1159   1       
1160   1      }
*** WARNING C280 IN LINE 1099 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: 'adr': unreferenced local variable
1161          
1162          
1163          /***************************************************************
1164          *    END
1165          ****************************************************************/
1166          
1167          
1168          
1169          
1170          
1171          
1172          
1173          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4816    ----
   CONSTANT SIZE    =    102    ----
   XDATA SIZE       =     62      65
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  12 WARNING(S),  0 ERROR(S)
