C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE API_LCD_DISPLAY
OBJECT MODULE PLACED IN .\Api_Lcd_Display.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\C_Source\S4_ApiUser\Api_Lcd_Display.c LARGE BROWSE INCDIR(..\C_Source\S0
                    -_System;..\C_Source\S1_HardDrv;..\C_Source\S2_MyLib;..\C_Source\S3_ApiPlat;..\C_Source\S4_ApiUser;..\C_Source\S5_ApiProt
                    -ocol;..\C_Source\S6_MyIncludes;..\C_Source\S1_HardDrv\V9811A_EMU;..\C_Source\S1_HardDrv\V9811A_MCU;..\C_Source\S1_HardDr
                    -v\E2P_24CXXX) DEBUG OBJECTEXTEND PRINT(.\Api_Lcd_Display.lst) OBJECT(.\Api_Lcd_Display.obj)

line level    source

   1          /*
   2          *****************Copyright (c)*************************************
   3          **      Hangzhou Xili Watthour Meter Manufacture Co., Ltd. 
   4          **--------------file info--------------------------------------------
   5          **name                  : Api_Lcd_Display.c
   6          **Author                : maji
   7          **date                  : 2016-04-21 
   8          **description   : Òº¾§ÏÔÊ¾Ó¦ÓÃ²ãÏà¹Øº¯Êý³ÌÐòCÎÄ¼þ
   9          **note                  : V9811A £¬MERTER FOR DL03C
  10          **--------------------Version History -------------------------------------
  11          ** NO. Date         Ver      By         Description 
  12          **==============================================================
  13          ** 1   2016-04-26   v01.00   sosomj     1. frist version                             
  14          **
  15          **==============================================================
  16          */
  17          
  18          
  19          #include <MyIncludes_H.h>
  20          
  21          
  22          /*******************************************************************************
  23          * È«¾Ö±äÁ¿¶¨ÒåÇø
  24          *******************************************************************************/
  25          DIS_PARAM_DATA   gs_dis_param;   // µçÁ¿ÏÔÊ¾Ïà¹Ø²ÎÊý  //
  26          DIS_CTL_VAR  gs_dis_ctl_var;
  27          DIS_PIXEL_VAR  gs_dis_pixel_var;
  28          LCDDISTAB   gs_LCDDISTAB_var;
  29          INT8U dis_data_type = 0;//µç±íÉÏÅÅÏÔÊ¾µçÁ¿»¹ÊÇÊ±¼ä»¹ÊÇÈÕÆÚµÄ±êÖ¾
  30          INT8U dis_data_sec = 0;//³ý¹¦ÂÊÍâÏÔÊ¾³ÖÐøÊ±¼ä
  31          INT8U dis_num_char = 0; //0:µ±Ç°µçÁ¿£¬          1:µ±Ç°ÐèÁ¿£¬            2:µ±Ç°ÀÛ¼Æ×î´óÐèÁ¿£¬
  32                                                          //3:Ç°Ò»ÌìµçÁ¿£¬4:Ç°Ò»ÌìÐèÁ¿£¬5:Ç°Ò»ÌìÀÛ¼Æ×î´óÐèÁ¿
  33          
  34          
  35          
  36          
  37          /*******************************************************************************
  38          * ³£Á¿±íÇø
  39          *******************************************************************************/
  40          const DIS_PARAM_DATA   code default_dis_param_tab= {
  41              5,  //uint8  auto_sec;    // ×Ô¶¯Ñ­»·ÏÔÊ¾³ÖÐøÊ±¼ä  //
  42              15, //uint8  key_sec;     // °´¼üÏÔÊ¾³ÖÐøÊ±¼ä  //
  43              360,//uint8  bg_sec;     // ÏÂµçÏÔÊ¾Î¬³ÖÊ±¼ä Ä¬ÈÏ6Ð¡Ê± µ¥Î»min//
  44              0x51,//uint8  ec_form;     // µçÁ¿¸ñÊ½  //
  45              4,//uint8  auto_item[21];    //0ÎªÏÔÊ¾¸öÊý£¬1~19ÎªÏÔÊ¾ÏîÄ¿£¬×î´ó¿ÉÒÔÏÔÊ¾31¸öÏîÄ¿  //
  46              1,2,3,4,0xFF,0xFF,            //uint8  auto_item[1~10];     //µçÑ¹ÆÁ£¬µçÁ÷ÆÁ£¬¹¦ÂÊÆÁ£¬ÆµÂÊÆÁ
  47              0x00,//INT16U  u16_csck;    //16Î»ÀÛ¼ÓºÍÐ£ÑéÖµ//
  48          };
  49          
  50          
  51          //  ³£Á¿×Ö·û±í¶¨Òå x  // D C B A - E G F 
  52          const INT8U code  NumSegD1_D6[DS_Chr_All_NUM] = 
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 2   

  53          {       DS_Chr_0,DS_Chr_1,DS_Chr_2,
  54                  DS_Chr_3,DS_Chr_4,DS_Chr_5,
  55                  DS_Chr_6,DS_Chr_7,DS_Chr_8,
  56                  DS_Chr_9,
  57                  DS_Chr_A,DS_Chr_b,DS_Chr_C,
  58                  DS_Chr_d,DS_Chr_E,DS_Chr_F
  59          };
  60          
  61          const INT8U code  NumSegD7_D8[DS_Chr_All_NUM] = 
  62          {       DS_OBIS_Chr_0,DS_OBIS_Chr_1,DS_OBIS_Chr_2,
  63                  DS_OBIS_Chr_3,DS_OBIS_Chr_4,DS_OBIS_Chr_5,
  64                  DS_OBIS_Chr_6,DS_OBIS_Chr_7,DS_OBIS_Chr_8,
  65                  DS_OBIS_Chr_9,
  66                  DS_OBIS_Chr_A,DS_OBIS_Chr_b,DS_OBIS_Chr_C,
  67                  DS_OBIS_Chr_d,DS_OBIS_Chr_E,DS_OBIS_Chr_F
  68          };
  69          
  70          
  71          
  72          
  73          //-------------------------------------------------------------------------------//
  74          //  Function:     Òº¾§ÏÔÊ¾ÏîÄ¿µÄÔªËØ±í       --ÔÚROMÇø
  75          //-------------------------------------------------------------------------------//
  76          
  77          const LCDDISTAB code LcdDisTab[] =
  78           {  
  79                  //DisID ,ObisNum ,      Addr ,  DisInfo,        chartype,       obis_digit              
  80                  ////////////////////////////ALL  DISPLAY////////////////////////////////////////////////////////
  81                  0,  0x8888,     0X0000,                                                                         0 ,                                     0,      OBIS_DIGIT_TYPE0,       // ALL DISPLAY  //
  82                  1,  0x327F,     (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].dw_u_val.B08[2],(MEM_RAM<<8)+2, CHAR_V,OBIS_
             -DIGIT_TYPE1,        //µçÑ¹
  83                  2,      0x317F, (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].dw_i_val.B08[0],(MEM_RAM<<8)+2, CHAR_A,OBIS_D
             -IGIT_TYPE2,        //µçÁ÷
  84                  3,  0x170F,     (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].dw_p_val.B08[0],(MEM_RAM<<8)+2,        CHAR_KW,OBIS
             -_DIGIT_TYPE2,        //ÓÐ¹¦¹¦ÂÊ      
  85                  4,  0x1470,     (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].w_freq_val[0],(MEM_RAM<<8)+2,  CHAR_HZ,OBIS_D
             -IGIT_TYPE2,        //ÆµÂÊ  
  86                  5,  0x1370,     (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].dw_pf_val[0],(MEM_RAM<<8)+2,   CHAR_PF,OBIS_DI
             -GIT_TYPE3,        // ¹¦ÂÊÒòÊý     
  87          
  88                  ////////////////////////////ACTIVE ENERGY  DISPLAY///////////////////////////////////////////////////////
             -/
  89                  // 0x01,  0x180F,        (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0],               (MEM_RAM<
             -<8)+6,        CHAR_AEC,OBIS_DIGIT_TYPE1,      // L0 ACTIVE ENERGY TOTAL 
  90          } ;
  91                                                   
  92          
  93          /*****************************************************************************
  94          ** Function name    :api_init_md_data_ram
  95          **
  96          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÏîÄ¿       
  97          **
  98          ** Parameters         :NONE          
  99          **
 100          ** Returned value   :NONE
 101          **
 102          **----------------------------------------------------------------------------
 103          ** V01.01  MJ  2016-04-23
 104          ******************************************************************************/
 105          void api_init_display(void)
 106          {
 107   1          mem_read(&gs_dis_param.auto_sec, ADR_BLOCK21_DIS_PARAM_E2P, LEN_BLOCK21_DIS_PARAM_E2P, MEM_E2P1);    // 
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 3   

             -    
 108   1          gs_dis_ctl_var.mode = DIS_MODE_RESET;
 109   1          gs_dis_ctl_var.item = DIS_RESET;
 110   1          gs_dis_ctl_var.ptr[0] =1;  //´í¹ýÌõÊýÊý×é //
 111   1          gs_dis_ctl_var.keep_sec[0] = 0;
 112   1          gs_dis_ctl_var.keep_sec[1] = 0;
 113   1          gs_dis_ctl_var.keep_sec[2] = 0;             //  ±³¹âÉÏµçµãÁÁ15S//
 114   1          gs_dis_ctl_var.keep_sec[3] = RESEAT_DIS_KEEP_3S; //  ÉÏµçÈ«ÆÁÏÔÊ¾Ê±¼ä
 115   1      }
 116          
 117          
 118          /*****************************************************************************
 119          ** Function name    :api_init_md_data_ram
 120          **
 121          ** Description         :³õÊ¼»¯µ±Ç°ÐèÁ¿¼ÆËãRAMÇøÊý¾Ý£¬³ÌÐò¸´Î»³õÊ¼»¯µ÷ÓÃ        
 122          **
 123          ** Parameters         :NONE          
 124          **
 125          ** Returned value   :NONE
 126          **
 127          **----------------------------------------------------------------------------
 128          ** V01.01  MJ  2016-04-23
 129          ******************************************************************************/
 130          void api_handl_dis_key(void)
 131          {
 132   1      
 133   1          if((gs_dis_ctl_var.mode == DIS_MODE_NOMAL)||(gs_dis_ctl_var.mode == DIS_MODE_RESET))
 134   1          {
 135   2              gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
 136   2              mem_read(&gs_dis_param.auto_item[0], ADR_DIS_PARAM_AUTO_TAB, 32, MEM_E2P1);      // 
 137   2              //gs_dis_ctl_var.ptr[0] =0xff;
 138   2          }
 139   1      
 140   1          gs_dis_ctl_var.keep_sec[1] = gs_dis_param.key_sec; // °´¼ü³ÖÐøÊ±¼ä
 141   1          gs_dis_ctl_var.item = api_get_next_dis_item();
 142   1      
 143   1      }
 144          
 145          /*****************************************************************************
 146          ** Function name    :api_init_md_data_ram
 147          **
 148          ** Description         :³õÊ¼»¯µ±Ç°ÐèÁ¿¼ÆËãRAMÇøÊý¾Ý£¬³ÌÐò¸´Î»³õÊ¼»¯µ÷ÓÃ        
 149          **
 150          ** Parameters         :NONE          
 151          **
 152          ** Returned value   :NONE
 153          **
 154          **----------------------------------------------------------------------------
 155          ** V01.01  MJ  2016-04-23
 156          ******************************************************************************/
 157          void api_handl_dis_sleep(void)
 158          {
 159   1          gs_dis_ctl_var.item = DIS_DEFAULT_ITEM;    
 160   1          gs_dis_ctl_var.mode = DIS_MODE_NOMAL ;
 161   1          mem_read(&gs_dis_param.auto_sec, ADR_BLOCK21_DIS_PARAM_E2P, LEN_BLOCK21_DIS_PARAM_E2P, MEM_E2P1);    // 
             -  
 162   1          api_updated_LCDDisplayPixel_per_second();
 163   1      }
 164          
 165          
 166          
 167          /*****************************************************************************
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 4   

 168          ** Function name    :api_updata_LCDDisplay_per_second
 169          **
 170          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÄÚÈÝ      
 171          **
 172          ** Parameters         :NONE          
 173          **
 174          ** Returned value   :NONE
 175          **
 176          **----------------------------------------------------------------------------
 177          ** V01.01  MJ  2016-04-23
 178          ******************************************************************************/
 179          void api_updated_LCDDisplayPixel_per_second(void)
 180          {               
 181   1          Lib_Set_String(&gs_dis_pixel_var.dis_buff[0],0,DS_UNIT);
 182   1              Lib_Set_String(&gs_dis_pixel_var.dis_obis_buff[0],0,DS_OBISNum);
 183   1              Lib_Set_String(&gs_dis_pixel_var.dis_data_buff[0] ,0,DS_DATANum);
 184   1              Lib_Set_String(&gs_dis_pixel_var.dis_char_buff[0] ,0,DS_CHARNum);
 185   1              
 186   1          // Ôö¼ÓÓ²¼þÐ£±íÏÔÊ¾¹¦ÄÜ //
 187   1          if((gs_dis_ctl_var.item>=DIS_ADJ_CH1_0) &&(gs_dis_ctl_var.item<=DIS_DATA_CLR))
 188   1          {
 189   2              api_LCDDisplay_adj_item(gs_dis_ctl_var.item);
 190   2              //      Link_Get_Dis_Data_Num_buff();
 191   2              //      Link_Get_Dis_Char_buff();            
 192   2          //    if(gs_sys_globaL_var.work_mode != SLEEP_MODE)Link_Get_Dis_RealChar_buff();
 193   2              Link_Get_Dis_Drv_buff();                
 194   2              Write_LCD(&gs_dis_pixel_var.dis_buff[0]);         //½«Êý¾ÝÐ´ÈëÒº¾§Çý¶¯//
 195   2              return;
 196   2          }
 197   1          if(gs_dis_ctl_var.item==DIS_DATA_BROADCAST) 
 198   1          {
 199   2              api_LCDDisplay_adj_item(gs_dis_ctl_var.item);
 200   2                      Link_Get_Dis_Data_Num_buff();
 201   2                      Link_Get_Dis_Char_buff();            
 202   2              if(gs_sys_globaL_var.work_mode != SLEEP_MODE)Link_Get_Dis_RealChar_buff();
 203   2              Link_Get_Dis_Drv_buff();                
 204   2              Write_LCD(&gs_dis_pixel_var.dis_buff[0]);         //½«Êý¾ÝÐ´ÈëÒº¾§Çý¶¯//
 205   2              return;
 206   2          }
 207   1          if(gs_dis_ctl_var.item>DIS_MAX_ITEM)
 208   1          {
 209   2              gs_dis_ctl_var.item = DIS_DEFAULT_ITEM;    // ÏµÍ³ÏÔÊ¾ÏîÄ¿Òì³£ºóµÄÄ¬ÈÏÎªÏÔÊ¾ÏµÍ³´íÎóÆÁ  //
 210   2          }
 211   1      
 212   1          if(gs_dis_ctl_var.item == DIS_RESET)
 213   1          {
 214   2              Lib_Set_String(&gs_dis_pixel_var.dis_buff[0],0xff,DS_UNIT);
 215   2          }
 216   1          else
 217   1          {
 218   2                      Link_Get_DisTab_Var(gs_dis_ctl_var.item) ;              // »ñÈ¡ÏÔÊ¾ÏîÄ¿ÐÅÏ¢  //
 219   2                      Link_Get_Dis_Data_Num_buff();
 220   2              //      Link_Get_Dis_OBIS_Num_buff();                   //ÏÂÅÅÓÃÀ´ÏÔÊ¾ÆäËûÊý¾Ý //
 221   2                      Link_Get_Dis_Char_buff();            
 222   2                      if(gs_sys_globaL_var.work_mode != SLEEP_MODE)  Link_Get_Dis_RealChar_buff();
 223   2                      Link_Get_Dis_Drv_buff();                 
 224   2          }
 225   1              if(EOI_delay_1s > 0)
 226   1              {
 227   2                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_EOI;
 228   2                      gs_dis_pixel_var.dis_buff[9] |= BIT0;
 229   2                      EOI_delay_1s --;
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 5   

 230   2              }
 231   1              switch(Bar_No)
 232   1              {
 233   2                      case 0:
 234   2                              gs_dis_pixel_var.dis_buff[10] &= ~(BIT7+BIT6+BIT5);
 235   2                              break;
 236   2                      case 1:
 237   2                              gs_dis_pixel_var.dis_buff[10] |= BIT7;
 238   2                              break;
 239   2                      case 2:
 240   2                              gs_dis_pixel_var.dis_buff[10] |= BIT7+BIT6;
 241   2                              break;
 242   2                      case 3:
 243   2                              gs_dis_pixel_var.dis_buff[10] |= BIT7+BIT6+BIT5;
 244   2                              break;
 245   2                      default:
 246   2                              break;
 247   2              }
 248   1          Write_LCD(&gs_dis_pixel_var.dis_buff[0]);         //½«Êý¾ÝÐ´ÈëÒº¾§Çý¶¯
 249   1      }
 250          
 251          
 252          /*****************************************************************************
 253          ** Function name    :api_updata_LCDDisplay_per_second
 254          **
 255          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÄÚÈÝ      
 256          **
 257          ** Parameters         :NONE          
 258          **
 259          ** Returned value   :NONE
 260          **
 261          **----------------------------------------------------------------------------
 262          ** V01.01  MJ  2016-04-23
 263          ******************************************************************************/
 264          void api_updated_LED_per_second(void)
 265          {
 266   1         // ·´ÏòÖ¸Ê¾  ÈÎÒâÒ»Ïà·´ÏòÔòµÆÁÁ//      
 267   1         if(gs_emu_run_var.net_flg&REV_TT_ACPOWER)// ÓÐ¹¦ºÏÏà¹¦ÂÊ·´Ïò
 268   1         {
 269   2              //LED_L2_REV_ON();
 270   2         }
 271   1         else 
 272   1         {
 273   2              //LED_L2_REV_OFF();
 274   2         }
 275   1      }
 276          
 277          
 278          /*****************************************************************************
 279          ** Function name    :api_init_md_data_ram
 280          **
 281          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÏîÄ¿       
 282          **
 283          ** Parameters         :NONE          
 284          **
 285          ** Returned value   :NONE
 286          **
 287          **----------------------------------------------------------------------------
 288          ** V01.01  MJ  2016-04-23
 289          ******************************************************************************/
 290          void api_updated_LCDDisplayItem_per_second(void)
 291          {
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 6   

 292   1          switch (gs_dis_ctl_var.mode )
 293   1          {
 294   2              case DIS_MODE_RESET:                     
 295   2                  gs_dis_ctl_var.keep_sec[3]--;
 296   2                  if(gs_dis_ctl_var.keep_sec[3]==0)  
 297   2                  {
 298   3                      gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
 299   3                      gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec;
 300   3                      gs_dis_ctl_var.ptr[0] = 0;
 301   3                      gs_dis_ctl_var.item = gs_dis_param.auto_item[gs_dis_ctl_var.ptr[0]+1];  //  0Î»ÖÃÎªÏÔÊ¾ÏîÄ
             -¿¸öÊý£¬1Î»ÖÃ¿ªÊ¼ÎªÏîÄ¿ //                
 302   3                                      dis_num_char = 0;//ÏÔÊ¾µ±Ç°µçÁ¿
 303   3                              }
 304   2              break;
 305   2      
 306   2              case DIS_MODE_NOMAL:
 307   2                              if(button_flag  == 1)
 308   2                              {
 309   3                                      //button_flag &= (~BIT1);
 310   3                                      button_flag = 0;
 311   3                                      if(dis_num_char < 3)
 312   3                                      {
 313   4                                              dis_num_char = 2;
 314   4                                      }
 315   3                                      if(dis_num_char == 5)
 316   3                                      {
 317   4                                              dis_num_char = 3;
 318   4                                      }
 319   3                                      else
 320   3                                      {
 321   4                                              dis_num_char ++;
 322   4                                      }
 323   3      
 324   3                                      gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec; //ÂÖÏÔ³ÖÐøÊ±¼ä//
 325   3                                      gs_dis_ctl_var.item = api_get_next_dis_item();
 326   3                              }
 327   2                              else if(MAGN_flag == 1)
 328   2                              {
 329   3                                      MAGN_flag = 0;
 330   3                                      if(dis_num_char < 3)
 331   3                                      {
 332   4                                              dis_num_char = 2;
 333   4                                      }
 334   3                                      if(dis_num_char == 5)
 335   3                                      {
 336   4                                              dis_num_char = 3;
 337   4                                      }
 338   3                                      else
 339   3                                      {
 340   4                                              dis_num_char ++;
 341   4                                      }
 342   3      
 343   3                                      gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec; //ÂÖÏÔ³ÖÐøÊ±¼ä//
 344   3                                      gs_dis_ctl_var.item = api_get_next_dis_item();
 345   3                              }
 346   2                              else
 347   2                              {
 348   3                                      if( gs_dis_ctl_var.keep_sec[0] > gs_dis_param.auto_sec)
 349   3                                      {
 350   4                                              gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec; //ÂÖÏÔ³ÖÐøÊ±¼ä//
 351   4                                      }
 352   3                                      else
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 7   

 353   3                                      {
 354   4                                              gs_dis_ctl_var.keep_sec[0]--;
 355   4                                              if( gs_dis_ctl_var.keep_sec[0] == 0)
 356   4                                              {
 357   5                                                      gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec; //ÂÖÏÔ³ÖÐøÊ±¼ä//
 358   5                                                      gs_dis_ctl_var.item = api_get_next_dis_item();
 359   5      
 360   5                                                      if(dis_num_char >= 2)
 361   5                                                      {
 362   6                                                              dis_num_char = 0;
 363   6                                                      }
 364   5                                                      else
 365   5                                                      {
 366   6                                                              dis_num_char++;//ÂÖÏÔ
 367   6                                                      }
 368   5                                              }
 369   4                                      }
 370   3                              }
 371   2              break;
 372   2      
 373   2              default:
 374   2                  gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
 375   2              break;
 376   2      
 377   2          }   
 378   1      }
 379                     
 380          /*****************************************************************************
 381          ** Function name    :api_get_next_dis_item
 382          **
 383          ** Description         :·µ»ØÏÂÒ»¸öÏÔÊ¾ÏîÄ¿     
 384          **
 385          ** Parameters         :NONE          
 386          **
 387          ** Returned value   :NONE
 388          **
 389          **----------------------------------------------------------------------------
 390          ** V01.01  MJ  2016-04-23
 391          ******************************************************************************/
 392          INT8U api_get_next_dis_item(void)
 393          {
 394   1       //INT8U vaild_len;
 395   1       INT8U item;
 396   1      
 397   1          item = DIS_DEFAULT_ITEM;
 398   1          if((gs_dis_ctl_var.mode  ==DIS_MODE_NOMAL))
 399   1          {
 400   2              gs_dis_ctl_var.ptr[0]++;
 401   2              if((gs_dis_ctl_var.ptr[0]>=(gs_dis_param.auto_item[0]))||(gs_dis_ctl_var.ptr[0]>DIS_MAX_ITEM))  //
             -ÏîÄ¿Îª0~6,¹²7Ïî //
 402   2              {
 403   3                  gs_dis_ctl_var.ptr[0]=0;
 404   3              }
 405   2      
 406   2              item = gs_dis_param.auto_item[gs_dis_ctl_var.ptr[0]+1];  //  0Î»ÖÃÎªÏÔÊ¾ÏîÄ¿¸öÊý£¬1Î»ÖÃ¿ªÊ¼ÎªÏîÄ¿ 
             -//
 407   2              if(item>DIS_MAX_ITEM)   
 408   2              {
 409   3                  item =     DIS_DEFAULT_ITEM;
 410   3              }
 411   2          }
 412   1          return (item);
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 8   

 413   1      }
 414          
 415          //*****************************************************************
 416          //  Function:       INT8U Link_Get_DisIndex(u8_dis_itm)        
 417          //  Description:    »ñÈ¡ÏÔÊ¾ÏîÄ¿ÐÅÏ¢                                        
 418          //  Input:                                                                            
 419          //  Output:         no                              
 420          //  Return:         no                              
 421          //  Others:         
 422          //***************************************************************/
 423          INT8U Link_Get_DisTab_Var(INT8U u8_dis_itm)
 424          {
 425   1       INT8U i;
 426   1       INT8U u8_result=FALSE;
 427   1      
 428   1              if(u8_dis_itm>DIS_MAX_ITEM)
 429   1              {
 430   2                      u8_dis_itm = DIS_DEFAULT_ITEM;    // ÏµÍ³ÏÔÊ¾ÏîÄ¿Òì³£ºóµÄÄ¬ÈÏÎªÏÔÊ¾ÏµÍ³´íÎóÆÁ  //
 431   2              }
 432   1      
 433   1      
 434   1              for( i = 0 ; i <=DIS_MAX_ITEM ; i++ )
 435   1              {
 436   2                      if( u8_dis_itm== LcdDisTab[i].DisID)
 437   2                      {
 438   3                              gs_LCDDISTAB_var.DisID = u8_dis_itm;
 439   3                              gs_LCDDISTAB_var.ObisNum= LcdDisTab[i].ObisNum;
 440   3                              gs_LCDDISTAB_var.Addr =LcdDisTab[i].Addr;
 441   3                              gs_LCDDISTAB_var.DisInfo = LcdDisTab[i].DisInfo;
 442   3                              gs_LCDDISTAB_var.chartype = LcdDisTab[i].chartype;
 443   3                              gs_LCDDISTAB_var.obis_digit= LcdDisTab[i].obis_digit;
 444   3                              u8_result = TRUE;
 445   3                              return (u8_result);
 446   3                      }
 447   2              }
 448   1      
 449   1              if(u8_result == FALSE )
 450   1              {
 451   2                      gs_LCDDISTAB_var.DisID = DIS_DEFAULT_ITEM;  // Ä¬ÈÏÏÔÊ¾µ±Ç°ÓÐ¹¦×Ü 
 452   2                      gs_LCDDISTAB_var.ObisNum = LcdDisTab[0x01].ObisNum;
 453   2                      gs_LCDDISTAB_var.Addr =LcdDisTab[0x01].Addr;
 454   2                      gs_LCDDISTAB_var.DisInfo = LcdDisTab[0x01].DisInfo;
 455   2                      gs_LCDDISTAB_var.chartype = LcdDisTab[0x01].chartype;           
 456   2              }
 457   1              return (u8_result);
 458   1                              
 459   1      }
 460          
 461          
 462          //*****************************************************************
 463          //  Function:      void Link_Get_Dis_OBIS_Num_buff(void)      
 464          //  Description:    »ñÈ¡OBISÇøµÄÏÔÊ¾ÄÚÈÝ£¬ 2¸ö8×ÖÇø                                       
 465          //  Input:                                                                            
 466          //  Output:         no                              
 467          //  Return:         no                              
 468          //  Others:         dis_obis_buff[0] ¶ÔÓ¦OBISÇøÏÔÊ¾µÄ×î×ó±ß1Î»(¸ßÎ»)
 469          //***************************************************************/
 470          void Link_Get_Dis_OBIS_Num_buff(void)
 471          { 
 472   1              INT8U   u8_len,u8_mem_type,lib_len;
 473   1              ST_U32_U08      u32_tmp,buffer;
 474   1              
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 9   

 475   1              u8_len = (INT8U)gs_LCDDISTAB_var.DisInfo;
 476   1              
 477   1              if(u8_len>2) u8_len= 2;
 478   1              u8_mem_type =  (INT8U)(gs_LCDDISTAB_var.DisInfo>>8);
 479   1              //¼ì²âµ½À­Õ¢ºó £¬OBISÇø¹Ì¶¨ÏÔÊ¾oFF yang 2017-12-27// 
 480   1              if(gs_relay_manage_var.u8_STA== CMD_RELAY_ON)
 481   1              {
 482   2                      gs_dis_pixel_var.dis_obis_buff[0] = 0x36 ;      //o
 483   2                      gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[0x0F]; //F
 484   2                      gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D8[0x0F];//F
 485   2                      return;
 486   2              }
 487   1              // Êý¾Ý»ñÈ¡´¦Àí  //
 488   1              switch (gs_LCDDISTAB_var.chartype)
 489   1              {
 490   2                      case CHAR_V://Êý¾ÝÇ°ÒÆ1Î»
 491   2                                              mem_read(&u32_tmp.B08[2],gs_LCDDISTAB_var.Addr, 2, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
 492   2                                              Lib_word_bcd2(&buffer.B08[0],u32_tmp.W16[1]);              //  16½øÖÆ×ª10½øÖÆ// 
 493   2                              break;
 494   2                              
 495   2                      case CHAR_HZ:
 496   2                                      mem_read(&u32_tmp.B08[2],gs_LCDDISTAB_var.Addr, 2, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
 497   2                                      Lib_word_bcd2(&buffer.B08[0],u32_tmp.W16[1]);              //  16½øÖÆ×ª10½øÖÆ// 
 498   2      //                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P9; 
 499   2                              break;
 500   2                              
 501   2                      case CHAR_PF:
 502   2                                              mem_read(&u32_tmp.B08[2],gs_LCDDISTAB_var.Addr, 2, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
 503   2                                              Lib_word_bcd2(&buffer.B08[0],u32_tmp.W16[1]);              //  16½øÖÆ×ª10½øÖÆ// 
 504   2                                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P8; 
 505   2                              break;
 506   2      
 507   2                      case CHAR_A: //xxx.xxx A
 508   2                                              mem_read(&u32_tmp.B08[0],gs_LCDDISTAB_var.Addr, 4, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
 509   2                                              Lib_long_bcd4(&buffer.B08[0],u32_tmp.u32);                      //      16½øÖÆ×ª10½øÖÆ// 
 510   2                                              lib_len=Lib_ENOB_Get(&buffer.B08[0],4,1);
 511   2                                              if(lib_len<=4)
 512   2                                              {
 513   3                                                      buffer.u32 =((buffer.u32&0x0000FFFF)<<16);
 514   3                                                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P8; 
 515   3                                              }
 516   2                                              else if(lib_len==5)
 517   2                                              {
 518   3                                                      buffer.u32 =((buffer.u32&0x000FFFFF)<<12);
 519   3      //                                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P9; 
 520   3                                              }
 521   2                                              else if(lib_len==6)
 522   2                                              {
 523   3                                                      buffer.u32 =((buffer.u32&0x00FFFFFF)<<8);
 524   3                                              }
 525   2                                              else if(lib_len==7)
 526   2                                              {
 527   3                                                      buffer.u32 =((buffer.u32&0x0FFFFFFF)<<4);
 528   3                                              }
 529   2                                              else 
 530   2                                              {
 531   3                                                      buffer.u32 =(buffer.u32&0xFFFFFFFF);
 532   3                                              }
 533   2                              break;                  
 534   2                      case CHAR_KW:// xx.xxxx kW
 535   2                                              mem_read(&u32_tmp.B08[0],gs_LCDDISTAB_var.Addr, 4, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
 536   2                                              Lib_long_bcd4(&buffer.B08[0],u32_tmp.u32);                      //      16½øÖÆ×ª10½øÖÆ// 
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 10  

 537   2                                              lib_len=Lib_ENOB_Get(&buffer.B08[0],4,1);
 538   2                                              if(lib_len<=5)
 539   2                                              {
 540   3                                                      buffer.u32 =((buffer.u32&0x000FFFFF)<<12);
 541   3                                                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P8; 
 542   3                                              }
 543   2                                              else if(lib_len==6)
 544   2                                              {
 545   3                                                      buffer.u32 =((buffer.u32&0x00FFFFFF)<<8);
 546   3      //                                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P9; 
 547   3                                              }
 548   2                                              else if(lib_len==7)
 549   2                                              {
 550   3                                                      buffer.u32 =((buffer.u32&0x0FFFFFFF)<<4);
 551   3                                              }
 552   2                                              else 
 553   2                                              {
 554   3                                                      buffer.u32 =(buffer.u32&0xFFFFFFFF);
 555   3                                              }
 556   2                              break;                  
 557   2      
 558   2                                              
 559   2                      default:
 560   2                              mem_read(&buffer.B08[0],gs_LCDDISTAB_var.Addr, u8_len, u8_mem_type);            //»ñÈ¡µ±Ç°Êý¾Ý //
 561   2                              break;
 562   2              }
 563   1              // ²âÊÔ/// 0XE6
 564   1              //      buffer.B08[3] = 0XE6;
 565   1              //      buffer.B08[2] = 0x07;
 566   1              //      buffer.B08[1] = 0x42;
 567   1              //      buffer.B08[0] = 0x48;
 568   1              //////////////
 569   1              
 570   1                      switch(u8_len)
 571   1                      {
 572   2                              case 2:
 573   2                                      gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[(buffer.B08[0]&0xF0)>>4] ;  
 574   2                                      gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[(buffer.B08[0]&0x0F)]; 
 575   2                                      gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D8[(buffer.B08[1]&0xF0)>>4] ;  
 576   2                                      break;
 577   2                              case 1:
 578   2                                      gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[(buffer.B08[1]&0xF0)>>4] ;  
 579   2                                      gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D8[(buffer.B08[1]&0x0F)]; 
 580   2                                      break;
 581   2                              default:          // ³¤¶ÈÎª0 ÏÔÊ¾¿Õ
 582   2                                         break;
 583   2                      }
 584   1                      
 585   1      
 586   1      }               
 587                          
 588          
 589          
 590          //*****************************************************************
 591          //  Function:      void Link_Get_Dis_OBIS_Num_buff(void)      
 592          //  Description:    »ñÈ¡DATAÇøµÄÏÔÊ¾ÄÚÈÝ£¬ 8¸ö8×ÖÇø                                       
 593          //  Input:                                                                            
 594          //  Output:         no                              
 595          //  Return:         no                              
 596          //  Others:         dis_data_buff[0] ¶ÔÓ¦NUMÇøÏÔÊ¾µÄ×î×ó±ß1Î»(¸ßÎ»)
 597          //***************************************************************/
 598          void Link_Get_Dis_Data_Num_buff(void)
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 11  

 599          {
 600   1              ST_U32_U08   buffer;
 601   1              INT8U  temp[6];
 602   1              NEW_MMD_DATA_UNIT t;
 603   1              RTC_TYPE rtc_data_tmp;
 604   1              ////ÉÏÅÅ¹Ì¶¨ÏÔÊ¾µ±Ç°×ÜµçÁ¿ yana 2017-12-15////  2018-11-20¸ÄÎªÉÏÅÅÏÔÊ¾¿É±äcxy
 605   1      
 606   1              if(dis_data_type == CHAR_TIME && dis_data_sec != 0)
 607   1              {       //ÏÔÊ¾Ê±¼ä
 608   2                      Get_RTCTime(&rtc_data_tmp);
 609   2      
 610   2                      gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[rtc_data_tmp.Hour>>4];
 611   2                      gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[rtc_data_tmp.Hour&0x0F];
 612   2                      gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[rtc_data_tmp.Minute>>4];
 613   2                      gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[rtc_data_tmp.Minute&0x0F];
 614   2                      gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[rtc_data_tmp.Second>>4];
 615   2                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[rtc_data_tmp.Second&0x0F];
 616   2                      dis_data_sec --;
 617   2                      if(dis_data_sec == 0){dis_data_type = 0;}
 618   2              }
 619   1              else
 620   1              {       
 621   2                      if(dis_num_char == 0)
 622   2                      {
 623   3                              //ÏÔÊ¾µ±Ç°µçÁ¿ kwh
 624   3                              mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RAM)
             -;          //»ñÈ¡µ±Ç°Êý¾Ý //
 625   3                              //mem_read(&temp[0], ADR_BLOCK00_EC_L0_E2P, 6, MEM_E2P1);
 626   3                              api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 627   3                              //debug////
 628   3                              //buffer.B08[1]=0x12;
 629   3                              //buffer.B08[2]=0x34;
 630   3                              //buffer.B08[3]=0x56;
 631   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4] ;  
 632   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0x0F)];
 633   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4] ;  
 634   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0x0F)]; 
 635   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4] ;  
 636   3                              if(gs_dis_param.ec_form!=0x50)
 637   3                              {
 638   4                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0x0F)]; 
 639   4                              }
 640   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 641   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 642   3                              gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[0]; 
 643   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[1] ;
 644   3                      }
 645   2                      if(dis_num_char == 1)
 646   2                      {
 647   3                              //ÏÔÊ¾µ±Ç°ÐèÁ¿kw
 648   3                              //mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RA
             -M);          //»ñÈ¡µ±Ç°Êý¾Ý //
 649   3      //                      mem_read(&t, ADR_BLOCK_4MMD_L0_E2P, 4, MEM_E2P1);
 650   3                              mem_read(&t, &st_mmd_unit_array[0].buf[0],4,MEM_RAM);                               
*** WARNING C182 IN LINE 650 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: pointer to different objects
*** WARNING C214 IN LINE 650 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: 'Argument': conversion: pointer to non-pointer
 651   3                              Lib_long_bcd4(&buffer.B08[0],t.val.val_hex32);
 652   3      //                      mem_read(&buffer.B08[0], ADR_BLOCK_4MMD_L0_E2P, 4, MEM_E2P1);
 653   3      //                      api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 654   3                              //debug////
 655   3                              //buffer.B08[1]=0x12;
 656   3                              //buffer.B08[2]=0x34;
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 12  

 657   3                              //buffer.B08[3]=0x56;
 658   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[0]&0x0F)] ;  
 659   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4];
 660   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[1]&0x0F)] ;  
 661   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4]; 
 662   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[2]&0x0F)] ;  
 663   3      //                      if(gs_dis_param.ec_form!=0x50)
 664   3      //                      {
 665   3                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4]; 
 666   3      //                      }
 667   3      
 668   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 669   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 670   3                              gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[0]; 
 671   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[2] ;
 672   3                      }
 673   2                      if(dis_num_char == 2)
 674   2                      {
 675   3                              //ÏÔÊ¾µ±Ç°ÀÛ¼ÆÐèÁ¿kw
 676   3      //                      mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RA
             -M);          //»ñÈ¡µ±Ç°Êý¾Ý //
 677   3      //                      mem_read(&t, ADR_BLOCK_4MMD_sum_L0_E2P, 4, MEM_E2P1);
 678   3                              mem_read(&t, &sum_st_mmd_unit_array[0].buf[0],4,MEM_RAM);
*** WARNING C182 IN LINE 678 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: pointer to different objects
*** WARNING C214 IN LINE 678 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: 'Argument': conversion: pointer to non-pointer
 679   3                              Lib_long_bcd4(&buffer.B08[0],t.val.val_hex32);
 680   3      //                      api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 681   3                              //debug////
 682   3                              //buffer.B08[1]=0x12;
 683   3                              //buffer.B08[2]=0x34;
 684   3                              //buffer.B08[3]=0x56;
 685   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[0]&0x0F)] ;  
 686   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4];
 687   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[1]&0x0F)] ;  
 688   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4]; 
 689   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[2]&0x0F)] ;  
 690   3      //                      if(gs_dis_param.ec_form!=0x50)
 691   3      //                      {
 692   3                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4]; 
 693   3      //                      }
 694   3      
 695   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 696   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 697   3                              gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[0]; 
 698   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[4] ;
 699   3                      }
 700   2                      if(dis_num_char == 3)
 701   2                      {
 702   3                              //ÏÔÊ¾Ç°Ò»ÌìµçÁ¿kwh
 703   3      //                      mem_read(&temp[0], ADR_BLOCK_4Energy_L0_E2P+LEN_BLOCK_4Energy_E2P/4, LEN_BLOCK_4Energy_E2P/4, MEM_E2P
             -1);          //»ñÈ¡µ±Ç°Êý¾Ý //
 704   3                              mem_read(&temp[0], &energy_data_array[1].buf[0], LEN_BLOCK_4Energy_E2P/4,MEM_RAM);
*** WARNING C214 IN LINE 704 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: 'Argument': conversion: pointer to non-pointer
 705   3                              api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 706   3                              //debug////
 707   3                              //buffer.B08[1]=0x12;
 708   3                              //buffer.B08[2]=0x34;
 709   3                              //buffer.B08[3]=0x56;
 710   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4] ;  
 711   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0x0F)];
 712   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4] ;  
 713   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0x0F)]; 
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 13  

 714   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4] ;  
 715   3                              if(gs_dis_param.ec_form!=0x50)
 716   3                              {
 717   4                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0x0F)]; 
 718   4                              }
 719   3      
 720   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 721   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 722   3                              gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[2]; 
 723   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[1] ;
 724   3                      }
 725   2                      if(dis_num_char == 4)
 726   2                      {
 727   3                              //ÏÔÊ¾Ç°Ò»ÌìÐèÁ¿kw
 728   3      //                      mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RA
             -M);          //»ñÈ¡µ±Ç°Êý¾Ý //
 729   3      //                      mem_read(&t, ADR_BLOCK_4MMD_L0_E2P+LEN_NEW_MMD_UNIT, 4, MEM_E2P1);
 730   3                              mem_read(&t, &st_mmd_unit_array[0].buf[0]+LEN_NEW_MMD_UNIT,4,MEM_RAM);
*** WARNING C182 IN LINE 730 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: pointer to different objects
*** WARNING C214 IN LINE 730 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: 'Argument': conversion: pointer to non-pointer
 731   3                              Lib_long_bcd4(&buffer.B08[0],t.val.val_hex32);
 732   3      //                      api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 733   3                              //debug////
 734   3                              //buffer.B08[1]=0x12;
 735   3                              //buffer.B08[2]=0x34;
 736   3                              //buffer.B08[3]=0x56;
 737   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[0]&0x0F)] ;  
 738   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4];
 739   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[1]&0x0F)] ;  
 740   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4]; 
 741   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[2]&0x0F)] ;  
 742   3      //                      if(gs_dis_param.ec_form!=0x50)
 743   3      //                      {
 744   3                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4]; 
 745   3      //                      }
 746   3      
 747   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 748   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 749   3                              gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[2]; 
 750   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[2] ;
 751   3                      }
 752   2                      if(dis_num_char == 5)
 753   2                      {
 754   3                              //ÏÔÊ¾Ç°Ò»ÌìÀÛ¼ÆÐèÁ¿kw
 755   3      //                      mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RA
             -M);          //»ñÈ¡µ±Ç°Êý¾Ý //
 756   3                              mem_read(&t, ADR_BLOCK_4MMD_sum_L0_E2P+LEN_SUM_MMD_UNIT, 4, MEM_E2P1);
*** WARNING C182 IN LINE 756 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: pointer to different objects
 757   3                              mem_read(&t, &sum_st_mmd_unit_array[0].buf[0]+LEN_SUM_MMD_UNIT,4,MEM_RAM);
*** WARNING C182 IN LINE 757 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: pointer to different objects
*** WARNING C214 IN LINE 757 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: 'Argument': conversion: pointer to non-pointer
 758   3                              Lib_long_bcd4(&buffer.B08[0],t.val.val_hex32);
 759   3      //                      api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 760   3                              //debug////
 761   3                              //buffer.B08[1]=0x12;
 762   3                              //buffer.B08[2]=0x34;
 763   3                              //buffer.B08[3]=0x56;
 764   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[0]&0x0F)] ;  
 765   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4];
 766   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[1]&0x0F)] ;  
 767   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4]; 
 768   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[2]&0x0F)] ;  
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 14  

 769   3      //                      if(gs_dis_param.ec_form!=0x50)
 770   3      //                      {
 771   3                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4]; 
 772   3      //                      }
 773   3      
 774   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 775   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 776   3                              gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[2]; 
 777   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[4] ;
 778   3                      }
 779   2              }
 780   1      }
 781          //*****************************************************************
 782          //  Function:       void Link_Get_Dis_Char_buff(void) 
 783          //  Description:    »ñÈ¡ÏÔÊ¾µÄÅäºÏ×Ö·ûÐÅÏ¢                                      
 784          //  Input:                                                                            
 785          //  Output:         no                              
 786          //  Return:         no                              
 787          //  Others:         
 788          //***************************************************************/
 789          void Link_Get_Dis_Char_buff(void)
 790          {
 791   1      //      RTC_TYPE rtc_data_tmp;
 792   1      //      Get_RTCTime(&rtc_data_tmp);//»ñÈ¡Ê±¼äÏÔÊ¾·ÑÂÊ
 793   1      //      if(rtc_data_tmp.Hour)
 794   1              //2019-01-25 cxy ÏÂµç²»ÏÔÊ¾·ÑÂÊºÅ
 795   1              if(gs_sys_globaL_var.work_mode != SLEEP_MODE)
 796   1              {
 797   2                      switch (gs_current_triff_var.triff_No)//ÏÔÊ¾·ÑÂÊ
 798   2                      {
 799   3                              case 1:
 800   3                                      gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_S1;
 801   3                                      break;
 802   3                              case 2:
 803   3                                      gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_S2;
 804   3                                      break;
 805   3                              case 3:
 806   3                                      gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_S3;
 807   3                                      break;
 808   3                              case 4:
 809   3                                      gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_S4;
 810   3                                      break;
 811   3                      }
 812   2              }
 813   1              if(dis_data_type == CHAR_TIME)
 814   1              {
 815   2                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P1P2;
 816   2                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P4P5;
 817   2              }
 818   1              else
 819   1              {       
 820   2                      if(dis_num_char == 0 || dis_num_char == 3)
 821   2                      {
 822   3                              if(gs_dis_param.ec_form!=0x50)
 823   3                              {
 824   4                                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P6;  //
 825   4                              }
 826   3                              gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_kWh;  //kWh
 827   3                      }
 828   2                      else
 829   2                      {
 830   3      //                      if(gs_dis_param.ec_form!=0x50)
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 15  

 831   3      //                      {
 832   3      //                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P6;  //
 833   3      //                      }
 834   3                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P3;
 835   3                              gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_kW;  //kW
 836   3                              gs_dis_pixel_var.dis_char_buff[2] |= CHAR_DATA_MD;
 837   3                      }
 838   2              }
 839   1              if(gs_relay_manage_var.u8_STA== CMD_RELAY_ON)
 840   1              {
 841   2                      return;
 842   2              }
 843   1              if(gs_dis_ctl_var.item== DIS_DATA_CLR)
 844   1              {
 845   2                      return;
 846   2              }
 847   1      
 848   1              // DATA ÇøµÄÐ¡ÊýµãºÍµ¥Î»×Ö·û»ñÈ¡ //
 849   1      //      switch(gs_LCDDISTAB_var.chartype)
 850   1              switch(gs_LCDDISTAB_var.chartype = 10)
*** WARNING C276 IN LINE 850 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: constant in condition expression
 851   1              {
 852   2                      case CHAR_V:    // µçÑ¹ÏÔÊ¾ xxx V //
 853   2                              gs_dis_pixel_var.dis_char_buff[2] |= CHAR_DATA_V; 
 854   2                              break;
 855   2                      case CHAR_A:    // µçÁ÷ÏÔÊ¾ xx.x A//
 856   2                              gs_dis_pixel_var.dis_char_buff[2] |= CHAR_DATA_A; 
 857   2                              break;
 858   2                      case CHAR_KW:    // ¹¦ÂÊÏÔÊ¾ xx.x kw//
 859   2      //                  gs_dis_pixel_var.dis_char_buff[2] |= (CHAR_DATA_k+CHAR_DATA_W);  //kW
 860   2                              break;
 861   2                      case CHAR_HZ:   // ÆµÂÊÏÔÊ¾ xx.x HZ//
 862   2                          gs_dis_pixel_var.dis_char_buff[2] |= CHAR_DATA_Hz;  //Hz
 863   2                              break;
 864   2                      default:
 865   2                              break;
 866   2              }       
 867   1      
 868   1              //////////////////////////////////////////////////////////////////////////////////////////////
 869   1      
 870   1              if(IsModeTest == TRUE)  gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_TEST ;
 871   1              ///////////////////////////////////////////////////////////////////////////////////////////////         
 872   1      }
 873          
 874          //*****************************************************************
 875          //  Function:       INT8U Link_Get_DisIndex(u8_dis_itm)        
 876          //  Description:    »ñÈ¡ÏÔÊ¾ÏîÄ¿ÐÅÏ¢                                        
 877          //  Input:                                                                            
 878          //  Output:         no                              
 879          //  Return:         no                              
 880          //  Others:         
 881          //***************************************************************/
 882          void Link_Get_Dis_RealChar_buff(void)
 883          {
 884   1      
 885   1               if(gs_measure_status_judge_var.u8_status & VBAT_LOW)           gs_dis_pixel_var.dis_char_buff[2] |=CHAR_
             -DATA_S9;        //µç³ØÇ·Ñ¹
 886   1               if(gs_emu_run_var.net_flg&REV_TT_ACPOWER)
 887   1              {
 888   2                      gs_dis_pixel_var.dis_char_buff[1] |=CHAR_DATA_Received;//·´ÏòÌáÊ¾
 889   2              }
 890   1               else
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 16  

 891   1              {
 892   2                       gs_dis_pixel_var.dis_char_buff[1] |=CHAR_DATA_Delivered;// Ä¬ÈÏÕýÏòÏÔÊ¾
 893   2              }
 894   1      }
 895          
 896          
 897          //*****************************************************************
 898          //  Function:      void Link_Get_Dis_Drv_buff(void)   
 899          //  Description:    »ñÈ¡ÏÔÊ¾»º³åbuffµÄÊý¾Ý                                    
 900          //  Input:                                                                            
 901          //  Output:         no                              
 902          //  Return:         no                              
 903          //  Others:         
 904          //***************************************************************/
 905          void Link_Get_Dis_Drv_buff(void)
 906          {
 907   1              gs_dis_pixel_var.dis_buff[0] |= (gs_dis_pixel_var.dis_data_buff[0] &0x7F);
 908   1              gs_dis_pixel_var.dis_buff[1] |= (gs_dis_pixel_var.dis_data_buff[1] &0x7F);
 909   1              gs_dis_pixel_var.dis_buff[2] |= (gs_dis_pixel_var.dis_data_buff[2] &0x7F);
 910   1              gs_dis_pixel_var.dis_buff[3] |= (gs_dis_pixel_var.dis_data_buff[3] &0x7F);
 911   1              gs_dis_pixel_var.dis_buff[4] |= (gs_dis_pixel_var.dis_data_buff[4] &0x7F);
 912   1              gs_dis_pixel_var.dis_buff[5] |= (gs_dis_pixel_var.dis_data_buff[5] &0x7F);
 913   1      
 914   1              gs_dis_pixel_var.dis_buff[6] |= (gs_dis_pixel_var.dis_obis_buff[0] &0xEF);
 915   1              gs_dis_pixel_var.dis_buff[7] |= (gs_dis_pixel_var.dis_obis_buff[1] &0xEF);
 916   1      //      gs_dis_pixel_var.dis_buff[8] |= (gs_dis_pixel_var.dis_obis_buff[2] &0xEF);
 917   1      
 918   1              
 919   1               //  dis_var.dis_char_buff[0:2] µÄ×ª»»//
 920   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P1P2)   {gs_dis_pixel_var.dis_buff[1] |= BIT7;gs_dis_pixel_
             -var.dis_buff[2] |= BIT7;}
 921   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P3)     gs_dis_pixel_var.dis_buff[3] |= BIT7;
 922   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P4P5)   {gs_dis_pixel_var.dis_buff[4] |= BIT7;gs_dis_pixe
             -l_var.dis_buff[8] |= BIT7;}
 923   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P6)     gs_dis_pixel_var.dis_buff[5] |= BIT7;
 924   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P7)     gs_dis_pixel_var.dis_buff[6] |= BIT4;
 925   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P8)     gs_dis_pixel_var.dis_buff[7] |= BIT4;
 926   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_EOI)     gs_dis_pixel_var.dis_buff[9] |= BIT0;
 927   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_TEST)     gs_dis_pixel_var.dis_buff[10] |= BIT0;
 928   1      
 929   1              
 930   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_kWh)    {gs_dis_pixel_var.dis_buff[9] |= BIT6;gs_dis_pixe
             -l_var.dis_buff[9] |= BIT2;}
 931   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_kW)     gs_dis_pixel_var.dis_buff[9] |= BIT6;
 932   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_S1)     gs_dis_pixel_var.dis_buff[8] |= BIT6;
 933   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_S2)     gs_dis_pixel_var.dis_buff[8] |= BIT7;
 934   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_S3)     gs_dis_pixel_var.dis_buff[8] |= BIT4;
 935   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_S4)     gs_dis_pixel_var.dis_buff[8] |= BIT5;
 936   1      
 937   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_Received)       gs_dis_pixel_var.dis_buff[11] |= BIT6;
 938   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_Delivered)      gs_dis_pixel_var.dis_buff[11] |= BIT5;
 939   1      
 940   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_V)              gs_dis_pixel_var.dis_buff[9] |= BIT4;
 941   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_A)              gs_dis_pixel_var.dis_buff[9] |= BIT5;
 942   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_Hz)             gs_dis_pixel_var.dis_buff[9] |= BIT1;
 943   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_MD)             gs_dis_pixel_var.dis_buff[8] |= BIT0;
 944   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_S9)             gs_dis_pixel_var.dis_buff[10] |= BIT1;
 945   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_S12)            gs_dis_pixel_var.dis_buff[10] |= BIT7;
 946   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_S13)            gs_dis_pixel_var.dis_buff[10] |= BIT6;
 947   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_S14)            gs_dis_pixel_var.dis_buff[10] |= BIT5;
 948   1              
 949   1              
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 17  

 950   1      }
 951          
 952          
 953          /*****************************************************************************
 954          ** Function name    :api_clr_current_energy_data
 955          **
 956          ** Description         : ÐèÁ¿µçÁ¿Êý¾Ý×ª»»
 957          **
 958          ** Parameters         :  type Êý¾ÝÀàÐÍ     0Ä¬ÈÏÈ«ÕûÊý 
 959          **
 960          ** Returned value   :NONE
 961          **
 962          **----------------------------------------------------------------------------
 963          ** V01.01  MJ  2016-04-23
 964          ******************************************************************************/
 965          void api_get_energy_LCD(uint8*  temp, uint8 type, uint8*  result)
 966          {
 967   1       ST_U32_U08   u32_result, BCD_temp;
 968   1       US_EC_DATA_UNIT ec_tmp;
 969   1         
 970   1          // if(type!=0x50)     type= 0x51;
 971   1          //µçÁ¿¸ñÊ½Êý¾Ý¸³Öµ //
 972   1          Lib_Copy_Str_TwoArry(&ec_tmp.buf[0], temp, LEN_EC_UNIT);
 973   1              
 974   1          u32_result.u32 =0;
 975   1      
 976   1              if(type==0x80)
 977   1          {
 978   2              if(ec_tmp.val.integ_hex32>=100000000)   ec_tmp.val.integ_hex32 -=100000000;
 979   2              Lib_long_bcd4(&u32_result.B08[0],ec_tmp.val.integ_hex32);       
 980   2          }
 981   1          
 982   1          if(type==0x62)
 983   1          {
 984   2              // ÕûÊý²¿·Ö´¦Àí //
 985   2              if(ec_tmp.val.integ_hex32>=1000000)   ec_tmp.val.integ_hex32 -=1000000;
 986   2              Lib_long_bcd4(&BCD_temp.B08[0],ec_tmp.val.integ_hex32);
 987   2              u32_result.B08[0]= BCD_temp.B08[1];
 988   2              u32_result.B08[1]= BCD_temp.B08[2];
 989   2              u32_result.B08[2]= BCD_temp.B08[3];
 990   2      
 991   2               // Ð¡Êý²¿·Ö´¦Àí //
 992   2               ec_tmp.val.decim_hex16  /= METER_CONST_10WH;
 993   2               u32_result.B08[3] = Lib_byte_bcd((INT8U)ec_tmp.val.decim_hex16);
 994   2      
 995   2          }
 996   1          if(type==0x60)
 997   1          {
 998   2              if(ec_tmp.val.integ_hex32>=1000000)   ec_tmp.val.integ_hex32 -=1000000;
 999   2              Lib_long_bcd4(&u32_result.B08[0],ec_tmp.val.integ_hex32);       
1000   2          }
1001   1          
1002   1          if(type==0x61)
1003   1          {
1004   2              // ÕûÊý²¿·Ö´¦Àí //
1005   2              if(ec_tmp.val.integ_hex32>=1000000)   ec_tmp.val.integ_hex32 -=1000000;
1006   2              Lib_long_bcd4(&BCD_temp.B08[0],ec_tmp.val.integ_hex32);
1007   2              u32_result.B08[0]= BCD_temp.B08[1];
1008   2              u32_result.B08[1]= BCD_temp.B08[2];
1009   2              u32_result.B08[2]= BCD_temp.B08[3];
1010   2      
1011   2               // Ð¡Êý²¿·Ö´¦Àí //
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 18  

1012   2               ec_tmp.val.decim_hex16  /= METER_CONST_10WH;
1013   2               u32_result.B08[3] = Lib_byte_bcd((INT8U)ec_tmp.val.decim_hex16);
1014   2      
1015   2          }
1016   1          if(type==0x51)
1017   1          {
1018   2                      // ÕûÊý²¿·Ö´¦Àí //
1019   2                      if(ec_tmp.val.integ_hex32>=100000)   ec_tmp.val.integ_hex32 -=100000;
1020   2                      Lib_long_bcd4(&BCD_temp.B08[0],ec_tmp.val.integ_hex32);
1021   2                      u32_result.B08[0]= 0x00;
1022   2                      u32_result.B08[1]= (((BCD_temp.B08[1]&0x0F)<<4)+((BCD_temp.B08[2]&0xF0)>>4));
1023   2                      u32_result.B08[2]= (((BCD_temp.B08[2]&0x0F)<<4)+((BCD_temp.B08[3]&0xF0)>>4));
1024   2                      u32_result.B08[3]|= ((BCD_temp.B08[3]&0x0F)<<4);
1025   2      
1026   2                      // Ð¡Êý²¿·Ö´¦Àí //
1027   2                      ec_tmp.val.decim_hex16  /= METER_CONST_10WH;
1028   2                      u32_result.B08[3]|=(((Lib_byte_bcd((INT8U)ec_tmp.val.decim_hex16))&0xF0)>>4);
1029   2          }
1030   1          if(type==0x50)
1031   1          {
1032   2                      // ÕûÊý²¿·Ö´¦Àí //
1033   2                      if(ec_tmp.val.integ_hex32>=100000)   ec_tmp.val.integ_hex32 -=100000;
1034   2                      Lib_long_bcd4(&BCD_temp.B08[0],ec_tmp.val.integ_hex32);
1035   2                      u32_result.B08[0]= 0x00;
1036   2                      u32_result.B08[1]= (((BCD_temp.B08[1]&0x0F)<<4)+((BCD_temp.B08[2]&0xF0)>>4));
1037   2                      u32_result.B08[2]= (((BCD_temp.B08[2]&0x0F)<<4)+((BCD_temp.B08[3]&0xF0)>>4));
1038   2                      u32_result.B08[3]|= ((BCD_temp.B08[3]&0x0F)<<4);
1039   2          }
1040   1          //Êý¾ÝÊä³ö //
1041   1          Lib_Copy_Str_TwoArry(result, &u32_result.B08[0], 4);
1042   1      
1043   1      }
1044          
1045          
1046          /*****************************************************************************
1047          ** Function name    :api_init_md_data_ram
1048          **
1049          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÏîÄ¿       
1050          **
1051          ** Parameters         :NONE          
1052          **
1053          ** Returned value   :NONE
1054          **
1055          **----------------------------------------------------------------------------
1056          ** V01.01  MJ  2016-04-23
1057          ******************************************************************************/
1058          void api_chg_LCDDisplay_adj_item(uint8 u8_item)
1059          {
1060   1          if((u8_item>=DIS_ADJ_CH1_0) &&(u8_item<=DIS_DATA_BROADCAST))
1061   1          {
1062   2              //¸ü¸ÄÐ£×¼ÏÔÊ¾ÏîÄ¿//
1063   2              gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
1064   2                      if(u8_item==DIS_DATA_BROADCAST)
1065   2                      {
1066   3                      gs_dis_ctl_var.keep_sec[0] = 10;    //Ç¿ÖÆÏÔÊ¾10Ãë //
1067   3                      }
1068   2                      else
1069   2                      {
1070   3                      gs_dis_ctl_var.keep_sec[0] = 5;    //Ç¿ÖÆÏÔÊ¾5Ãë //
1071   3                      }
1072   2                      //gs_dis_ctl_var.keep_sec[0] = 2;
1073   2              gs_dis_ctl_var.ptr[0] = 0;
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 19  

1074   2              gs_dis_ctl_var.item = u8_item;    
1075   2          }
1076   1          else
1077   1          {
1078   2              //Òì³£Çé¿öÏÂÏÔÊ¾×Ô¶¯Ñ­ÏÔÏîÄ¿ //
1079   2              gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
1080   2              gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec;
1081   2              gs_dis_ctl_var.ptr[0] = 0;
1082   2              gs_dis_ctl_var.item = gs_dis_param.auto_item[gs_dis_ctl_var.ptr[0]+1];  //  0Î»ÖÃÎªÏÔÊ¾ÏîÄ¿¸öÊý£¬1
             -Î»ÖÃ¿ªÊ¼ÎªÏîÄ¿ //  
1083   2          }
1084   1      
1085   1          api_updated_LCDDisplayPixel_per_second();
1086   1      }
1087          
1088          /*****************************************************************************
1089          ** Function name    :api_init_md_data_ram
1090          **
1091          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÏîÄ¿       
1092          **
1093          ** Parameters         :NONE          
1094          **
1095          ** Returned value   :NONE
1096          **
1097          **----------------------------------------------------------------------------
1098          ** V01.01  MJ  2016-04-23
1099          ******************************************************************************/
1100          void api_LCDDisplay_adj_item(uint8 u8_item)
1101          {
1102   1              INT8U adr[6];
1103   1          if((u8_item<DIS_ADJ_CH1_0) &&(u8_item>DIS_DATA_BROADCAST))
1104   1          {
1105   2              return;
1106   2          }
1107   1      
1108   1          Lib_Set_String(&gs_dis_pixel_var.dis_data_buff[0],0,DS_DATANum);    
1109   1          Lib_Set_String(&gs_dis_pixel_var.dis_obis_buff[0],0,DS_OBISNum);
1110   1          Lib_Set_String(&gs_dis_pixel_var.dis_char_buff[0] ,0,DS_CHARNum);
1111   1      
1112   1          // Êý¾Ý»ñÈ¡´¦Àí  //A F E D B G C MD  //
1113   1          switch (u8_item)
1114   1          {
1115   2              case DIS_ADJ_CH1_0:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1116   2              case DIS_ADJ_CH1_1:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1117   2              case DIS_ADJ_CH1_2:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1118   2              case DIS_ADJ_CH1_3:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1119   2                  gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[0X0C]       ;      //LCD-D1  C  //
1120   2                  gs_dis_pixel_var.dis_data_buff[1] = 0x76    ;               //LCD-D2  H  //
1121   2                  gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[0X01]       ;     //LCD-D3  1  //
1122   2                  gs_dis_pixel_var.dis_data_buff[3] = 0X20    ;                 //LCD-D4  -//
1123   2                  gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(u8_item&0X0F)]     ;  //LCD-D5  0~3  //
1124   2              break;
1125   2      
1126   2              case DIS_ADJ_CH2_0:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1127   2              case DIS_ADJ_CH2_1:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1128   2              case DIS_ADJ_CH2_2:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1129   2              case DIS_ADJ_CH2_3:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1130   2                  gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[0X0C]       ;      //LCD-D1  C  //
1131   2                  gs_dis_pixel_var.dis_data_buff[1] = 0x76    ;                                //LCD-D2  H  //
1132   2                  gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[0X02]       ;     //LCD-D3  2  //
1133   2                  gs_dis_pixel_var.dis_data_buff[3] = 0X20    ;                                 //LCD-D4  -//
1134   2                  gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(u8_item&0X0F)-4]   ;     //LCD-D5  0~3  //
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       04/10/2019 09:17:47 PAGE 20  

1135   2              break;
1136   2      
1137   2              case DIS_DATA_CLR:      //ÇåÁãÏÔÊ¾ //
1138   2      //            gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[0X0C]     ;      //LCD-D1  C  //
1139   2      //            gs_dis_pixel_var.dis_obis_buff[1] = 0xA1  ;              //LCD-D2  L  //
1140   2      //            gs_dis_pixel_var.dis_obis_buff[2] = 0x60  ;              //LCD-D3  r  //
1141   2                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[0X0C]   ;      //LCD-D1  C  //
1142   2                              gs_dis_pixel_var.dis_data_buff[1] = 0x58;                                //LCD-D2  L  //
1143   2                  gs_dis_pixel_var.dis_data_buff[2] = 0x60;     //LCD-D3  r  //
1144   2              break;
1145   2                      
1146   2      //        case DIS_DATA_BROADCAST:      //¹ã²¥ÃüÁîÏÔÊ¾Í¨Ñ¶µØÖ· //
1147   2      //                      mem_read(&adr[0], ADR_METER_PARAM1_RF_COMM_ID, 6, MEM_E2P1);//¶ÁÈ¡RFÍ¨Ñ¶µØÖ·
1148   2      //            gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(adr[1]&0x0F)];  
1149   2      //            gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(adr[2]&0xF0)>>4];
1150   2      //            gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(adr[2]&0x0F)];
1151   2      //            gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(adr[3]&0xF0)>>4];
1152   2      //            gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(adr[3]&0x0F)];
1153   2      //            gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(adr[4]&0xF0)>>4];
1154   2      //            gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D8[(adr[4]&0x0F)];
1155   2      //            gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D8[(adr[5]&0xF0)>>4];
1156   2      //            gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D8[(adr[5]&0x0F)];
1157   2      //        break;
1158   2              default:        
1159   2                  sys_err();
1160   2              break;
1161   2          }
1162   1       
1163   1      }
*** WARNING C280 IN LINE 1102 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: 'adr': unreferenced local variable
1164          
1165          
1166          /***************************************************************
1167          *    END
1168          ****************************************************************/
1169          
1170          
1171          
1172          
1173          
1174          
1175          
1176          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4827    ----
   CONSTANT SIZE    =    102    ----
   XDATA SIZE       =     62      65
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  12 WARNING(S),  0 ERROR(S)
