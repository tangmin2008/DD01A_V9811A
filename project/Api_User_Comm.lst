C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE API_USER_COMM
OBJECT MODULE PLACED IN .\Api_User_Comm.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\C_Source\S4_ApiUser\Api_User_Comm.c LARGE BROWSE INCDIR(..\C_Source\S0_S
                    -ystem;..\C_Source\S1_HardDrv;..\C_Source\S2_MyLib;..\C_Source\S3_ApiPlat;..\C_Source\S4_ApiUser;..\C_Source\S5_ApiProtoc
                    -ol;..\C_Source\S6_MyIncludes;..\C_Source\S1_HardDrv\V9811A_EMU;..\C_Source\S1_HardDrv\V9811A_MCU;..\C_Source\S1_HardDrv\
                    -E2P_24CXXX) DEBUG OBJECTEXTEND PRINT(.\Api_User_Comm.lst) OBJECT(.\Api_User_Comm.obj)

line level    source

   1          /*
   2          *****************Copyright (c)*************************************
   3          **      Hangzhou Xili Watthour Meter Manufacture Co., Ltd. 
   4          **--------------file info--------------------------------------------
   5          **name                  : Api_User_Comm.c
   6          **Author                : maji
   7          **date                  : 2016-04-21 
   8          **description   : Í¨Ñ¶´¦ÀíÓ¦ÓÃ²ãÏà¹Øº¯Êý³ÌÐòCÎÄ¼þ
   9          **note                  : V9811A £¬MERTER FOR DL03C
  10          **--------------------Version History -------------------------------------
  11          ** NO. Date         Ver      By         Description 
  12          **==============================================================
  13          ** 1   2016-04-26   v01.00   sosomj     1. frist version                             
  14          **
  15          **==============================================================
  16          */
  17          
  18          
  19          
  20          #include <MyIncludes_H.h>
  21          
  22          
  23          /*******************************************************************************
  24          * È«¾Ö±äÁ¿¶¨ÒåÇø
  25          *******************************************************************************/
  26          uint8 *P_IEC_BUFF;    //Í¨Ñ¶»º³åÇøÖ¸Õë //
  27          uint8 g_ch_comm;   //µ±Ç°Í¨Ñ¶Í¨µÀºÅ //
  28          UART_COMM_APP_VAR  gs_uart_iec_app_var[UART_CH_NUM];
  29          COMM_DATA  comm_data;
  30          uint8 clr_flag = 0;
  31          uint8 IsClrEvent = 0;
  32          /*******************************************************************************
  33          * ³£Á¿±íÇøcode
  34          *******************************************************************************/
  35          const  INT8U Super_mima_iec[8] ={'4','5','6','1','2','3','0','0'};
  36          const  INT8U meter_info[Meter_INFO_LENTH] = {'X','L','E','3','D','D','S','3','1','1','-','7','V','4','.','
             -1',};        // ÒòÎªÔ¶ºìÍâ£¬À©Õ¹Îª2400bps//
  37          const  INT8U meter_info_IR[Meter_INFO_LENTH] = {'X','L','E','3','D','D','S','3','1','1','-','7','V','4','.
             -','1',};        // ÒòÎªÔ¶ºìÍâ£¬À©Õ¹Îª2400bps//
  38          const  INT8U mima_info[MIMA_INFO_LENTH] = {'(','1','1','1','1','1','1','1','1',')',};
  39          
  40          /*********************************************************************************************************
  41          **  Í¨Ñ¶ID±í¸ñ
  42          ********************************************************************************************************/
  43           code IEC_COMDISTAB    IEC_ComDisTab[] =
  44          {
  45                  // ÓÐ¹¦ºÏÏà·ÑÂÊ×Ü//
  46                  0x00010000, &gs_energy_user_data.us_val[EC_CH_AC_PT_TT][TARIFF_T].buf[0],       EN_R+P_RAM, 4,8,        //µ±Ç°×ÜµçÁ¿
  47          #if (BILL_MAX_NUM>0)
  48                  0x00010001, ADR_BLOCK101_BILL1_DATA_E2P+(OFFSET_bill_data_ec+TARIFF_T*LEN_EC_UNIT), EN_R+P_E2P1+CM_BILL ,
             -4,8,        //ÉÏ1ÔÂµçÁ¿
  49                  0x00010002, ADR_BLOCK102_BILL2_DATA_E2P+(OFFSET_bill_data_ec+TARIFF_T*LEN_EC_UNIT), EN_R+P_E2P1+CM_BILL,4
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 2   

             -,8,        //ÉÏ2ÔÂµçÁ¿
  50                  0x00010003, ADR_BLOCK103_BILL3_DATA_E2P+(OFFSET_bill_data_ec+TARIFF_T*LEN_EC_UNIT), EN_R+P_E2P1+CM_BILL,4
             -,8,        //ÉÏ3ÔÂµçÁ¿
  51                  0x00010004, ADR_BLOCK104_BILL4_DATA_E2P+(OFFSET_bill_data_ec+TARIFF_T*LEN_EC_UNIT), EN_R+P_E2P1+CM_BILL,4
             -,8,        //ÉÏ4ÔÂµçÁ¿
  52                  0x00010005, ADR_BLOCK105_BILL5_DATA_E2P+(OFFSET_bill_data_ec+TARIFF_T*LEN_EC_UNIT), EN_R+P_E2P1+CM_BILL,4
             -,8,        //ÉÏ5ÔÂµçÁ¿
  53                  0x00010006, ADR_BLOCK106_BILL6_DATA_E2P+(OFFSET_bill_data_ec+TARIFF_T*LEN_EC_UNIT), EN_R+P_E2P1+CM_BILL,4
             -,8,        //ÉÏ6ÔÂµçÁ¿
  54          #endif
  55          
  56          #if (TARIFF_MAX_NUM>0)//ÓÐ¹¦ËÄ·ÑÂÊ
  57                  0x00010100, &gs_energy_user_data.us_val[EC_CH_AC_PT_TT][TARIFF1].buf[0],        EN_R+P_RAM,     4,8,
  58                  0x00010200, &gs_energy_user_data.us_val[EC_CH_AC_PT_TT][TARIFF2].buf[0],        EN_R+P_RAM,     4,8,
  59                  0x00010300, &gs_energy_user_data.us_val[EC_CH_AC_PT_TT][TARIFF3].buf[0],        EN_R+P_RAM,     4,8,
  60                  0x00010400, &gs_energy_user_data.us_val[EC_CH_AC_PT_TT][TARIFF4].buf[0],        EN_R+P_RAM,     4,8,
  61          #endif  
  62                  //ÎÞ¹¦
  63                  0x00030000, &gs_energy_user_data.us_val[EC_CH_RE_PT_TT][TARIFF_T].buf[0],       EN_R+P_RAM,     4,8,  //×Ü
  64          #if (TARIFF_MAX_NUM>0)//ËÄ·ÑÂÊ
  65                  0x00030100, &gs_energy_user_data.us_val[EC_CH_RE_PT_TT][TARIFF1].buf[0],        EN_R+P_RAM,     4,8,
  66                  0x00030200, &gs_energy_user_data.us_val[EC_CH_RE_PT_TT][TARIFF2].buf[0],        EN_R+P_RAM,     4,8,
  67                  0x00030300, &gs_energy_user_data.us_val[EC_CH_RE_PT_TT][TARIFF3].buf[0],        EN_R+P_RAM,     4,8,
  68                  0x00030400, &gs_energy_user_data.us_val[EC_CH_RE_PT_TT][TARIFF4].buf[0],        EN_R+P_RAM,     4,8,
  69          #endif
  70          
  71                  //ÐèÁ¿ ×Ü
  72                  0x01010000, ADR_BLOCK01_MMD_L0_E2P+(TARIFF_T*LEN_MMD_UNIT), EN_R+P_E2P1,9,18,//µ±Ç°ÐèÁ¿ÀàÊý¾Ý 4+5 ÐèÁ¿+Ê±
             -¼ä
  73                  0x010100FF,     &sum_st_mmd_unit_array[0].buf[0],       EN_R+P_RAM,     5,10, //µ±Ç°ÀÛ¼Æ×î´óÐèÁ¿
  74          #if (BILL_MAX_NUM>0)
  75                  0x01010001, ADR_BLOCK101_BILL1_DATA_E2P+OFFSET_bill_data_mmd+(TARIFF_T*LEN_MMD_UNIT), EN_R+P_E2P1+CM_BILL
             -,9,18,//ÉÏ1ÔÂÐèÁ¿Àà
  76                  0x01010002, ADR_BLOCK102_BILL2_DATA_E2P+OFFSET_bill_data_mmd+(TARIFF_T*LEN_MMD_UNIT), EN_R+P_E2P1+CM_BILL
             -,9,18,//ÉÏ2ÔÂÐèÁ¿Àà
  77                  0x01010003, ADR_BLOCK103_BILL3_DATA_E2P+OFFSET_bill_data_mmd+(TARIFF_T*LEN_MMD_UNIT), EN_R+P_E2P1+CM_BILL
             -,9,18,//ÉÏ3ÔÂÐèÁ¿Àà
  78                  0x01010004, ADR_BLOCK104_BILL4_DATA_E2P+OFFSET_bill_data_mmd+(TARIFF_T*LEN_MMD_UNIT), EN_R+P_E2P1+CM_BILL
             -,9,18,//ÉÏ4ÔÂÐèÁ¿Àà
  79                  0x01010005, ADR_BLOCK105_BILL5_DATA_E2P+OFFSET_bill_data_mmd+(TARIFF_T*LEN_MMD_UNIT), EN_R+P_E2P1+CM_BILL
             -,9,18,//ÉÏ5ÔÂÐèÁ¿Àà
  80                  0x01010006, ADR_BLOCK106_BILL6_DATA_E2P+OFFSET_bill_data_mmd+(TARIFF_T*LEN_MMD_UNIT), EN_R+P_E2P1+CM_BILL
             -,9,18,//ÉÏ6ÔÂÐèÁ¿Àà
  81          #endif
  82                  //±äÁ¿Êý¾Ý      //
  83                  0x02010000,&gs_measure_var_data.gs_really[0].dw_u_val.B08[0],   EN_R+P_RAM, 2,4,        //ºÏÏàµçÑ¹ xxx.x                 YYY
  84                  0x02010100,&gs_measure_var_data.gs_really[0].dw_u_val.B08[0],   EN_R+P_RAM, 2,4,        //AÏàµçÑ¹ xxx.x          YYY
  85                  0x02020000,&gs_measure_var_data.gs_really[0].dw_i_val.B08[0],   EN_R+P_RAM, 3,6,        //ºÏÏàµçÁ÷       XXX.XXX
  86                  0x02020100,&gs_measure_var_data.gs_really[0].dw_i_val.B08[0],   EN_R+P_RAM, 3,6,        //AÏàµçÁ÷   XXX.XXX
  87                  0x02030000,&gs_measure_var_data.gs_really[0].dw_p_val.B08[0],     EN_R+P_RAM,   3,6,    // TOTAL ACTIVE POWER   XX
             -.XXXX 
  88                  0x02030100,&gs_measure_var_data.gs_really[0].dw_p_val.B08[0],     EN_R+P_RAM,   3,6,    // AÏà ACTIVE POWER   XX
             -.XXXX 
  89                  0x02030200,&gs_measure_var_data.dw_p_n_val.B08[0],                               EN_R+P_RAM,    3,6,    // BÏà ACTIVE POWER   XX.XXXX 
  90                  0x02060000,&gs_measure_var_data.gs_really[0].dw_pf_val.B08[0],   EN_R+P_RAM,2,4,        //ºÏÏà¹¦ÂÊÒòÊý  X.XXX
  91                  0x02060100,&gs_measure_var_data.gs_really[0].dw_pf_val.B08[0],   EN_R+P_RAM,2,4,        // AÏà¹¦ÂÊÒòÊý  X.XXX
  92                  0x02800001,&gs_measure_var_data.dw_i_n_val.B08[0],              EN_R+P_RAM, 3,6,        //NÏàµçÁ÷   XXX.XXX
  93                  0x02800002,&gs_measure_var_data.gs_really[0].w_freq_val.B08[0],    EN_R+P_RAM,2,4,      //ÆµÂÊ  XX.XX
  94          #if (TARIFF_MAX_NUM>1)
  95                  0x02900001,&gs_current_triff_var.triff_No,        EN_R+P_RAM,1,2,       //µ±Ç°·ÑÂÊ 1~4//
  96                  0x02900002,&gs_current_triff_var.dayTab_No,    EN_R+P_RAM,1,2,  //µ±Ç°ÈÕÊ±¶Î±í 1~4//
  97                  0x02900003,&gs_current_triff_var.weekTab_No,    EN_R+P_RAM,1,2, //µ±Ç°ÖÜ±í 1~4//
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 3   

  98                  0x02900004,&gs_current_triff_var.seasonTab_No,    EN_R+P_RAM,1,2,       //µ±Ç°¼¾½Ú±í 1~4//
  99          #endif
 100          
 101                  //±í¼ÆÐÅÏ¢///
 102                  0x04000100,&gs_CurDateTime.Week,                                EN_RW+P_RAM,7,14,       //×¢ÒâÈÕÆÚ£¬Í¨Ñ¶¶ÁÐ´Ë³Ðò YYMMDDWWhhmmss
 103                  0x04000103,ADR_METER_PARAM1_MD,                            EN_RW+P_E2P1,        2,      4,      //×î´óÐèÁ¿ÖÜÆÚ,»¬²îÊ±¼ä//
 104                  0x04000401,ADR_METER_PARAM1_METER_ID,           EN_RW+P_E2P1,16,32, //Í¨Ñ¶µØÖ· ±íºÅ
 105                  0x04000402,ADR_METER_PARAM1_RF_COMM_ID,         EN_RW+P_E2P1,6,12, //RFÍ¨Ñ¶µØÖ· yang 2017-12-21
 106                  0x04000409,&sys_parm.meter_cons[0],                     EN_R+P_RAM,3,6,         //³£Êý   //     
 107          #if (TARIFF_MAX_NUM>1)//2019-01-07 ÐÂÔöÐÞ¸Ä·ÑÂÊÏà¹ØÃüÁîcxy
 108                  0x04000801,ADR_BLOCK83_WEEK_TAB_E2P     ,                       EN_RW+P_E2P1,LEN_WEEK_TABLE_ONE,(2*LEN_WEEK_TABLE_ONE), //ÖÜ±íÆðÊ
             -¼µØÖ·(4¸öÖÜ±í)        
 109                  0x04000802,ADR_BLOCK83_WEEK_TAB_E2P+(1*LEN_WEEK_TABLE_ONE),             EN_RW+P_E2P1,LEN_WEEK_TABLE_ONE,(2*LEN_WEEK_
             -TABLE_ONE),        //ÖÜ±íÆðÊ¼µØÖ·(4¸öÖÜ±í)
 110                  0x04000803,ADR_BLOCK83_WEEK_TAB_E2P+(2*LEN_WEEK_TABLE_ONE),             EN_RW+P_E2P1,LEN_WEEK_TABLE_ONE,(2*LEN_WEEK_
             -TABLE_ONE),        //ÖÜ±íÆðÊ¼µØÖ·(4¸öÖÜ±í)
 111                  0x04000804,ADR_BLOCK83_WEEK_TAB_E2P+(3*LEN_WEEK_TABLE_ONE),             EN_RW+P_E2P1,LEN_WEEK_TABLE_ONE,(2*LEN_WEEK_
             -TABLE_ONE),        //ÖÜ±íÆðÊ¼µØÖ·(4¸öÖÜ±í) 
 112          
 113                  0x04010000,ADR_BLOCK82_SEASON_TAB_E2P,               EN_RW+P_E2P1,LEN_SEASON_TABLE, (2*LEN_SEASON_TABLE), 
             -   // ¼¾½Ú±í 8*3  ÔÂÈÕ+ÖÜ±íºÅ
 114                  0x04010001,ADR_BLOCK84_DAY_TAB_E2P,                             EN_RW+P_E2P1,LEN_DAY_TABLE_ONE, (2*LEN_DAY_TABLE_ONE),//Ê±¶Î±í1  Ê
             -±¶Î±íÆðÊ¼µØÖ·(8¸öÊ±¶Î±í£¬10¸öÊ±¶ÎÊý)  288      BCD  hhnnNN          
 115                  0x04010002,ADR_BLOCK84_DAY_TAB_E2P+(1*LEN_DAY_TABLE_ONE),               EN_RW+P_E2P1,LEN_DAY_TABLE_ONE, (2*LEN_DAY_TAB
             -LE_ONE),//Ê±¶Î±í2  Ê±¶Î±íÆðÊ¼µØÖ·(8¸öÊ±¶Î±í£¬10¸öÊ±¶ÎÊý)  288      BCD  hhnnNN          
 116                  0x04010003,ADR_BLOCK84_DAY_TAB_E2P+(2*LEN_DAY_TABLE_ONE),               EN_RW+P_E2P1,LEN_DAY_TABLE_ONE, (2*LEN_DAY_TAB
             -LE_ONE),//Ê±¶Î±í3  Ê±¶Î±íÆðÊ¼µØÖ·(8¸öÊ±¶Î±í£¬10¸öÊ±¶ÎÊý)  288      BCD  hhnnNN          
 117                  0x04010004,ADR_BLOCK84_DAY_TAB_E2P+(3*LEN_DAY_TABLE_ONE),               EN_RW+P_E2P1,LEN_DAY_TABLE_ONE, (2*LEN_DAY_TAB
             -LE_ONE),//Ê±¶Î±í4  Ê±¶Î±íÆðÊ¼µØÖ·(8¸öÊ±¶Î±í£¬10¸öÊ±¶ÎÊý)  288      BCD  hhnnNN
 118          #endif
 119          
 120                  0x04000B01,ADR_METER_PARAM1_SETL_DDHH,                  EN_RW+P_E2P1,2,4,       //½áËãÈÕ
 121                  0x04000B02,ADR_BLOCK20_METER_PARAM1_E2P+ST_MB_OFFSET(E2P_METER_PARAM1_MAP,BILL_FLAG), EN_RW+P_E2P1,1,2,  
             -//½áËã·½Ê½
 122                  0x04000C01,ADR_METER_PARAM1_PW0,                                        EN_W+P_E2P1,4,8,        //TTL 2¼¶ÃÜÂë
 123                  0x04000C02,ADR_METER_PARAM1_RF_PW0,                                     EN_W+P_E2P1,4,8,        //RF 2¼¶ÃÜÂë
 124                  0x04800003,ADR_METER_PARAM1_RELAY_CMD,                     EN_RW+P_E2P1,        2,      4,//¼ÌµçÆ÷ÃüÁî¼°×´Ì¬×Ö//
 125              0x04000A01,  ADR_METER_PARAM1_load_lptime_inv_var,          EN_RW+P_E2P1,2,4,//¼ÇÂ¼¼ä¸ô
 126              0x04000AA1,  ADR_METER_PARAM1_load_egcode_var,            EN_RW+P_E2P1,10,20, //¸ººÉ±í±àÂë
 127              0x06010000,  &LPRunPa.Num[0],                                   EN_R+P_RAM,2,4, //ÒÑ¼ÇÂ¼ÌõÊý
 128                                  //ÏÔÊ¾Àà²ÎÊý//
 129                  0x04000302,ADR_DIS_PARAM_AUTO_SEC,                      EN_RW+P_E2P1,1,2,        //×Ô¶¯Ñ­ÏÔÊ±¼ä 
 130                  0x04000303,ADR_DIS_PARAM_EC_FORM,                EN_RW+P_E2P1,1,2,        // µçÁ¿ÏÔÊ¾Î»Êý//
 131                  0x04040100,ADR_DIS_PARAM_AUTO_TAB,               EN_RW+P_E2P1,(DIS_MAX_ITEM+1),(2*(DIS_MAX_ITEM+1)), //×Ô¶¯Ñ­ÏÔ±í//
 132                  0x04800001,&sys_parm.video[0],                  EN_R+P_RAM,12,12,  //Èí¼þ°æ±¾ºÅ(ASCII)
 133          
 134          
 135                  // ¹¤³§À©Õ¹ÀàÃüÁî//
 136                  0x80805001, 0x0000,                                     EN_R+P_E2P1,12,24,  // À©Õ¹ÃüÁî µçÁ¿+¼ÌµçÆ÷×´Ì¬+ÈÕÆÚÊ±¼ä yang 2017-12-22// 
 137                  0x08020100,0x0000,                                              EN_W+P_RAM,1,2,                    //ÐèÁ¿ÇåÁã/ÊÖ¶¯¸´Î»//
 138                  0x08020200,0x0000,                                              EN_W+P_RAM,1,2,                    //=FF ÊÂ¼þ¼ÇÂ¼ÇåÁã  // Çå¿ª¸Ç
 139                  0x08020300,0x0000,                                              EN_W+P_RAM,1,2,                    //=00 ¸ººÉ¼ÇÂ¼ÇåÁã  //
 140                  0x08020400,0x0000,                                              EN_W+P_RAM,4,8,                   //xxxxxxxx = 00000000Ê±Çå³ýµ±Ç°ºÍÀúÊ·µçÁ¿ÐèÁ¿Êý¾Ý//
 141                  0x08020500,ADR_METER_PARAM1_FC_CFG,     EN_RW+P_E2P1,4,8,                 //¹¤³§³ö³§×´Ì¬×Ö£¬4×Ö½Ú  // 5A:³§ÄÚ   //
 142                  0x04000107,ADR_METER_PARAM1_BAT_LEVEL,  EN_RW+P_E2P1,   2,      4,      // µç³ØµÍÑ¹·§Öµ  1 ×Ö½Ú£¬BCD  X.X 
 143                  //Õû»ú³õÊ¼»¯ //
 144                  0x0000FEFF,0x0000,                                                      EN_W+P_RAM,2,4,         // ³õÊ¼»¯
 145                  0xEE000109,ADR_BLOCK70_EMU_PARAM_E2P,                   EN_RW+P_E2P1+W_FCT,32,64,//!Ð£±í²ÎÊýÇø(U,I1,I2,P1,P2,Fre)
 146                  0xEE000118,ADR_METER_PARAM1_EEPROM_Flag,        EN_RW+P_E2P1+W_FCT,3,6,//EEPROMÊ×´ÎÉÏµç±êÖ¾Î» Ê×´ÎÉÏµç ¸Ã±êÖ¾Î»²
             -»µÈÓÚ0x653412£¬ÆäËû¾ùÎªÊ×´ÎÉÏµç///
 147                  //ÊÂ¼þ¼ÇÂ¼ID À­Õ¢//
 148                  
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 4   

 149                  // Ò»ÀàÊÂ¼þ  //
 150                  //ÐèÁ¿¸´Î»   //
 151                  0x03500000, ADR_BLOCK151_EVENI_resetMD_E2P,                         EN_R+P_E2P1, 2,4,   //×Ü´ÎÊý
 152                  0x03500101, ADR_BLOCK151_EVENI_resetMD_E2P+2,               EN_R+P_E2P1, 6,12, //×î½üÒ»´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±
             -¼ä ½áÊøÊ±¼ä
 153                  0x03500102, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 1*6),    EN_R+P_E2P1, 6,12,//×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 154                  0x03500103, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 2*6),    EN_R+P_E2P1, 6,12,//×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 155                  0x03500104, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 3*6),    EN_R+P_E2P1, 6,12,//×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 156                  0x03500105, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 4*6),    EN_R+P_E2P1, 6,12,//×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 157                  0x03500106, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 5*6),    EN_R+P_E2P1, 6,12,//×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 158                  0x03500107, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 6*6),    EN_R+P_E2P1, 6,12,//×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 159                  0x03500108, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 7*6),    EN_R+P_E2P1, 6,12,//×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 160                  0x03500109, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 8*6),    EN_R+P_E2P1, 6,12,//×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 161                  0x0350010A, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 9*6),    EN_R+P_E2P1, 6,12,//×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 162          
 163          //      0x0350FFFF, ADR_BLOCK151_EVENI_resetMD_E2P+2,                   EN_R+P_E2P1, 60,120,//×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê
             -±¼ä ½áÊøÊ±¼ä
 164          
 165                  //ÃÜÂëÈÏÖ¤´íÎó
 166                  0x03560000,  ADR_BLOCK153_EVENI_MMERR_E2P,                  EN_R+P_E2P1,        2,4,    //×Ü´ÎÊý
 167                  0x03560101,  ADR_BLOCK153_EVENI_MMERR_E2P+2,            EN_R+P_E2P1, 6,12,               //×î½üÒ»´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±¼ä
             - ½áÊøÊ±¼ä
 168                  0x03560102,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 1*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 169                  0x03560103,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 2*6),     EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 170                  0x03560104,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 3*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 171                  0x03560105,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 4*6),     EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 172                  0x03560106,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 5*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 173                  0x03560107,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 6*6),     EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 174                  0x03560108,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 7*6),     EN_R+P_E2P1 , 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 175                  0x03560109,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 8*6),     EN_R+P_E2P1 , 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 176                  0x0356010A,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 9*6),     EN_R+P_E2P1 , 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 177          
 178          //      0x0356FFFF,  ADR_BLOCK153_EVENI_MMERR_E2P+2,            EN_R+P_E2P1 , 60,120, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 179          
 180                  //Ê±ÖÓÐ£×¼
 181                  0x03570000,  ADR_BLOCK152_EVENI_setRtc_E2P,                         EN_R+P_E2P1,        2,4,    //×Ü´ÎÊý
 182                  0x03570101,  ADR_BLOCK152_EVENI_setRtc_E2P+2,               EN_R+P_E2P1, 6,12,           //×î½üÒ»´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë 
             -¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 183                  0x03570102,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 1*6),    EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 184                  0x03570103,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 2*6),    EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 185                  0x03570104,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 3*6),    EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 5   

             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 186                  0x03570105,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 4*6),    EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 187                  0x03570106,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 5*6),    EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 188                  0x03570107,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 6*6),    EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 189                  0x03570108,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 7*6),    EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 190                  0x03570109,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 8*6),    EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 191                  0x0357010A,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 9*6),    EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 192          
 193          //      0x0357FFFF,  ADR_BLOCK152_EVENI_setRtc_E2P+2,                   EN_R+P_E2P1, 60,120,             //×î½üÒ»´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂ
             -ë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 194          
 195                  //E2P´íÎó
 196                  0x03580000,  ADR_BLOCK156_EVENII_EERR_E2P,                  EN_R+P_E2P1,        2,4,    //×Ü´ÎÊý
 197                  0x03580101,  ADR_BLOCK156_EVENII_EERR_E2P+2,            EN_R+P_E2P1, 6,12,               //×î½üÒ»´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±¼
             -ä ½áÊøÊ±¼ä
 198                  0x03580102,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 1*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 199                  0x03580103,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 2*6),     EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 200                  0x03580104,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 3*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 201                  0x03580105,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 4*6),     EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 202                  0x03580106,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 5*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 203                  0x03580107,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 6*6),     EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 204                  0x03580108,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 7*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 205                  0x03580109,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 8*6),     EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 206                  0x0358010A,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 9*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 207          
 208          //      0x0358FFFF,   ADR_BLOCK156_EVENII_EERR_E2P+2,                   EN_R+P_E2P1, 60,120,             //×î½üÒ»´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂ
             -ë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 209          
 210          //  ¶þÀàÊÂ¼þ    //
 211                  //µç³ØÇ·Ñ¹ ÌØÊâ´¦Àí  Ö»³­¶Á·¢ÉúÊ±¼ä//   
 212                  0x03590000,   ADR_BLOCK162_EVENII_lowbattery_E2P,            EN_R+P_E2P1, 2,4,  //×Ü´ÎÊý
 213                  0x03590001,   ADR_BLOCK162_EVENII_lowbattery_E2P+2,          EN_R+P_E2P1, 4,8,  //ÀÛ¼ÆÊ±¼ä
 214                  0x03590101,   ADR_BLOCK162_EVENII_lowbattery_E2P+6,                  EN_R+P_E2P1+CM_EBIL, 12,24,         //×î½üÒ»´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 215                  0x03590102,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 1*6),        EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 216                  0x03590103,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 2*6),        EN_R+P_E2P1+CM_EBIL, 12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 217                  0x03590104,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 3*6),        EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 218                  0x03590105,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 4*6),        EN_R+P_E2P1+CM_EBIL, 12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 219                  0x03590106,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 5*6),        EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 220                  0x03590107,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 6*6),        EN_R+P_E2P1+CM_EBIL, 12,24,//×î½üÈý´Îµµ°¸¼ÇÂ¼ 
             - ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 221                  0x03590108,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 7*6),        EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 6   

             -  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 222                  0x03590109,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 8*6),        EN_R+P_E2P1+CM_EBIL, 12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 223                  0x0359010A,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 9*6),        EN_R+P_E2P1+CM_EBIL, 12,24,//×î½ü¶þ´Îµµ°¸¼ÇÂ¼ 
             - ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 224          
 225          //      0x0359FFFF,  ADR_BLOCK162_EVENII_lowbattery_E2P+6,               EN_R+P_E2P1, 60,120,//¿ªÊ¼¼ÇÂ¼  6*10´Î
 226                  
 227                  // µçÔ´µôµç  // 
 228                  0x03380000,  ADR_BLOCK161_EVENII_PWN_E2P,                      EN_R+P_E2P1,     2,4,    //×Ü´ÎÊý
 229                  0x03380001,  ADR_BLOCK161_EVENII_PWN_E2P+2,                  EN_R+P_E2P1,       4,8,    //ÀÛ¼ÆÊ±¼ä
 230                  0x03380101,  ADR_BLOCK161_EVENII_PWN_E2P+6,                     EN_R+P_E2P1+CM_EBIL, 12,24,              //×î½üÒ»´Îµµ°¸¼ÇÂ¼  Ê
             -Â¼þ´úÂë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 231                  0x03380102,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 1*6),       EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ
             -´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 232                  0x03380103,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 2*6),       EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ
             -´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 233                  0x03380104,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 3*6),       EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ
             -´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 234                  0x03380105,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 4*6),        EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 235                  0x03380106,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 5*6),        EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 236                  0x03380107,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 6*6),       EN_R+P_E2P1+CM_EBIL, 12,24, //×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´
             -úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 237                  0x03380108,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 7*6),        EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 238                  0x03380109,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 8*6),        EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 239                  0x0338010A,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 9*6),        EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 240          
 241          //      0x0338FFFF,   ADR_BLOCK161_EVENII_PWN_E2P+6,                   EN_R+P_E2P1+CM_GETHER_EBIL, 120,240,              //×î½üÒ»´Îµ
             -µ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 242          
 243                  //COVER_//      
 244                  0x03450000,  ADR_BLOCK163_EVENII_COVER_E2P,           EN_R+P_E2P1,      2,4,    //×Ü´ÎÊý
 245                  0x03450001,  ADR_BLOCK163_EVENII_COVER_E2P+2,         EN_R+P_E2P1,      4,8,    //×Ü´ÎÊý
 246                  0x03450101,  ADR_BLOCK163_EVENII_COVER_E2P+6,                 EN_R+P_E2P1+CM_EBIL, 12,24,                //×î½üÒ»´Îµµ°¸¼ÇÂ¼  ÊÂ
             -¼þ´úÂë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 247                  0x03450102,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 1*6),     EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 248                  0x03450103,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 2*6),     EN_R+P_E2P1+CM_EBIL, 12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 249                  0x03450104,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 3*6),     EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 250                  0x03450105,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 4*6),  EN_R+P_E2P1+CM_EBIL, 12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 251                  0x03450106,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 5*6),     EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 252                  0x03450107,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 6*6),  EN_R+P_E2P1+CM_EBIL, 12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 253                  0x03450108,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 7*6),     EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 254                  0x03450109,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 8*6),     EN_R+P_E2P1+CM_EBIL, 12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 255                  0x0345010A,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 9*6),     EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 256          
 257          //      0x0341FFFF,  ADR_BLOCK163_EVENII_NOL1_E2P+6,                   EN_R+P_E2P1+CM_GETHER_EBIL, 120,240,              //×î½üÒ»´Îµ
             -µ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 258                  //L2 ¶ÏÏà //
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 7   

 259          //      0x03420000,  ADR_BLOCK164_EVENII_NOL2_E2P,                      EN_R+P_E2P1,    2,4,    //×Ü´ÎÊý
 260          //      0x03420001, ( ADR_BLOCK164_EVENII_NOL2_E2P+2),               EN_R+P_E2P1,       4,8,    //×ÜÀÛ¼ÆÊ±¼ä//
 261          ////    0x03420101,  ADR_BLOCK164_EVENII_NOL2_E2P+6,                     EN_R+P_E2P1+CM_EBIL,   12,24,//×î½üÒ»´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 262          //      0x03420102,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 1*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 263          //      0x03420103,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 2*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 264          //      0x03420104,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 3*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 265          //      0x03420105,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 4*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 266          //      0x03420106,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 5*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 267          //      0x03420107,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 6*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 268          //      0x03420108,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 7*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 269          //      0x03420109,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 8*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 270          //      0x0342010A,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 9*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 271          
 272          //      0x0342FFFF,  ADR_BLOCK164_EVENII_NOL2_E2P+6,               EN_R+P_E2P1+CM_GETHER_EBIL,  120,240,//×î½üÒ»´Îµµ°¸¼ÇÂ
             -¼  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 273                  // ¹¦ÂÊ·´ÏòÊÂ¼þ  //     
 274                  0x03360000,  ADR_BLOCK164_EVENII_L1reverse_E2P,                       EN_R+P_E2P1,      2,4,    //×Ü´ÎÊý
 275                  0x03360001, ( ADR_BLOCK164_EVENII_L1reverse_E2P+2),                EN_R+P_E2P1,         4,8,    //×ÜÀÛ¼ÆÊ±¼ä//
 276                  0x03360101,  (ADR_BLOCK164_EVENII_L1reverse_E2P+6),                EN_R+P_E2P1+CM_EBIL,         12,24,  //¿ªÊ¼Ê±¼
             -ä+½áÊøÊ±¼ä//
 277                  0x03360102, ( ADR_BLOCK164_EVENII_L1reverse_E2P+6+1*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 278                  0x03360103,  (ADR_BLOCK164_EVENII_L1reverse_E2P+6+2*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 279                  0x03360104, ( ADR_BLOCK164_EVENII_L1reverse_E2P+6+3*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 280                  0x03360105, ( ADR_BLOCK164_EVENII_L1reverse_E2P+6+4*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 281                  0x03360106, ( ADR_BLOCK164_EVENII_L1reverse_E2P+6+5*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 282                  0x03360107,  (ADR_BLOCK164_EVENII_L1reverse_E2P+6+6*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 283                  0x03360108, ( ADR_BLOCK164_EVENII_L1reverse_E2P+6+7*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 284                  0x03360109, ( ADR_BLOCK164_EVENII_L1reverse_E2P+6+8*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 285                  0x0336010A,  (ADR_BLOCK164_EVENII_L1reverse_E2P+6+9*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 286          
 287          //      0x0336FFFF,  (ADR_BLOCK165_EVENII_L1reverse_E2P+6),                EN_R+P_E2P1+CM_GETHER_EBIL,  120,240
             -,        //¿ªÊ¼Ê±¼ä+½áÊøÊ±¼ä//
 288          
 289                  // ÉÏÒ»´Î½áËãÊ±¼ä
 290                  0x03700101 ,   ADR_BLOCK101_BILL1_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12,  // ÄêÔÂÈÕÊ±·ÖÃë
 291                  0x03700102 ,   ADR_BLOCK102_BILL2_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 292                  0x03700103 ,   ADR_BLOCK103_BILL3_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 293                  0x03700104 ,   ADR_BLOCK104_BILL4_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 294                  0x03700105 ,   ADR_BLOCK105_BILL5_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 295                  0x03700106 ,   ADR_BLOCK106_BILL6_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë 
 296          //      0x03700107 ,   ADR_BLOCK107_BILL7_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 297          //      0x03700108 ,   ADR_BLOCK108_BILL8_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 298          //      0x03700109 ,   ADR_BLOCK109_BILL9_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 8   

 299          //      0x0370010A ,   ADR_BLOCK110_BILL10_DATA_E2P ,     EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 300          //      0x0370010B ,   ADR_BLOCK111_BILL11_DATA_E2P,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë 
 301          //      0x0370010C ,   ADR_BLOCK112_BILL12_DATA_E2P,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 302          
 303          //ÈÕ¶³½á
 304                  0x0506FF01,    0x0000,    EN_R+P_E2P1, 18,36,
 305                  0x0506FF02,    0x0000,    EN_R+P_E2P1, 18,36,
 306                  0x0506FF03,    0x0000,    EN_R+P_E2P1, 18,36,
 307                  0x0506FF04,    0x0000,    EN_R+P_E2P1, 18,36,
 308          
 309                  //Í¨Ñ¶ÅúÁ¿Ð£±í 6 //
 310                  0x0000FEBB,0x0000,                                              EN_W+P_E2P1+W_FCT,2,4,//ÅäÖÃEMU ±¶Æµ //
 311                  0x80800803, 0x0000,                                     EN_W+P_E2P1+W_FCT,2,4,  // EMU¼ÆÁ¿²ÎÊý³õÊ¼»¯ £¬ÓÃÄ¬ÈÏ²ÎÊý¸³Öµ // 
 312                  0x0000FEB0, 0x0000,                                     EN_W+P_E2P1+W_FCT,12,24,   //Ö÷»ØÂ· 1.0L IB Îó²îºÍÓÐÐ§ÖµÐ£×¼// 
 313                  0x0000FEB1, 0x0000,                                     EN_W+P_E2P1+W_FCT,12,24,   //Ö÷»ØÂ· 0.5L IB Îó²îÐ£×¼// 
 314                  0x0000FEB2, 0x0000,                                     EN_W+P_E2P1+W_FCT,12,24,   //´Î»ØÂ·1.0L IB Îó²îÐ£×¼// 
 315                  0x0000FEB3, 0x0000,                                     EN_W+P_E2P1+W_FCT,12,24,   //´Î»ØÂ·0.5L IB Îó²îÐ£×¼// 
 316                  0x0000FEB4, 0x0000,                                     EN_W+P_E2P1+W_FCT,12,24,  //´Î»ØÂ·0.5L IB Îó²îÐ£×¼// 
 317                  0x0000FEB5, 0x0000,                                     EN_W+P_E2P1+W_FCT,12,24,  //´Î»ØÂ·1.0L 5%IB Îó²îÐ£×¼// 
 318          };
 319          //---------------------------------------------------------------------//
 320          //¹¦ÄÜ:   ¼ÆËãÓÉÆðÊ¼µØÖ·¿ªÊ¼µ½F½ØÖ¹µÄ³¤¶È//
 321          //     0000F     return 4
 322          //      *Addr Êý¾ÝÆðÊ¼µØÖ·£¬numÊý¾Ý³¤¶È
 323          //---------------------------------------------------------------------//
 324          INT8U get_meter_id_asclen(INT8U *Addr,INT8U numbyte)
 325          {
 326   1              INT8U i;
 327   1              INT8U asclen=0;
 328   1              for(i=0;i<numbyte;i++)
 329   1              {
 330   2                      if((((*(Addr+i))>>4)&0x0F)==0x0F)
 331   2                      {
 332   3                              return asclen;
 333   3                      }
 334   2                      asclen++;
 335   2                      if(((*(Addr+i))&0x0F)==0x0F)
 336   2                      {
 337   3                              return asclen;
 338   3                      }
 339   2                      asclen++;
 340   2              }
 341   1              return asclen;
 342   1      }
 343          
 344          
 345          /*****************************************************************
 346           name:          INT8U  get_comm_var( INT16U id )
 347           function:      get command information precess  
 348           input:         no            
 349           return:        GetComVar()
 350                          =0    succeed  precess 
 351                          =1    fail precess 
 352          *****************************************************************/
 353          INT8U  get_IEC_comm_var( INT32U id )
 354          {
 355   1              INT16U i;  
 356   1          //²»ÔÚ±í¸ñÄÚÊý¾Ý ¸ººÉÊý¾Ý//
 357   1          if((id>=0x06010001)&&(id<=0x060105A0))//¸ººÉÊý¾Ý×î¶à¼ÇÂ¼900Ìõ   //SXL 2019-01-6
 358   1          {
 359   2                      comm_data.addr =0;
 360   2                      comm_data.Info.u16 = EN_R;              //²»ÄÜ»òÉÏ
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 9   

 361   2                      comm_data.len = 0;
 362   2                      comm_data.len_asc = 0;
 363   2                      return TRUE;
 364   2          }
 365   1                       if((id>=0x060A0001)&&(id<=0x060A0120))//¸ººÉÊý¾Ý¿é×î¶à¼ÇÂ¼90Ìõ   //SXL 2019-01-6
 366   1          {
 367   2                      comm_data.addr =0;
 368   2                      comm_data.Info.u16 = EN_R;              //²»ÄÜ»òÉÏ
 369   2                      comm_data.len = 0;
 370   2                      comm_data.len_asc = 0;
 371   2                      return TRUE;
 372   2          }
 373   1         for( i = 0 ; i <dim(IEC_ComDisTab) ; i++ )
 374   1              {
 375   2                  if( id == IEC_ComDisTab[i].ComID )
 376   2                  {
 377   3                      comm_data.addr = IEC_ComDisTab[i].Addr;
 378   3                      comm_data.Info.u16 = IEC_ComDisTab[i].ComInfo;
 379   3                      comm_data.len = IEC_ComDisTab[i].Len;
 380   3                      comm_data.len_asc = IEC_ComDisTab[i].Len_Asc;
 381   3                      return TRUE;
 382   3                  }
 383   2              }
 384   1              return FALSE;   
 385   1      
 386   1              
 387   1      
 388   1      /*   INT16U i;  
 389   1      
 390   1          //²»ÔÚ±í¸ñÄÚÊý¾Ý//
 391   1          if((id>=0x06010001)&&(id<=0x060116A9))
 392   1          {
 393   1              comm_data.addr =0;
 394   1              comm_data.Info.u16 = EN_R;              //²»ÄÜ»òÉÏ
 395   1              comm_data.len = 0;
 396   1              comm_data.len_asc = 0;
 397   1              return 1;
 398   1          }
 399   1      
 400   1          if((id>=0x06012001)&&(id<=0x06012245))
 401   1          {
 402   1              comm_data.addr =0;
 403   1              comm_data.Info.u16 = EN_R;              //²»ÄÜ»òÉÏ
 404   1              comm_data.len = 0;
 405   1              comm_data.len_asc = 0;
 406   1              return 1;
 407   1          }
 408   1      
 409   1          //±í¸ñÄÚÊý¾Ý·ÖÇøÓò²é±í//
 410   1          
 411   1              if(id<0x01000000) //µçÁ¿ÇøÓò
 412   1              {
 413   1                  for( i = 0 ; i <dim(IEC_ComDisTab) ; i++ )
 414   1                  {
 415   1                      if( id == IEC_ComDisTab[i].ComID )
 416   1                      {
 417   1                          comm_data.addr = IEC_ComDisTab[i].Addr;
 418   1                          comm_data.Info.u16 = IEC_ComDisTab[i].ComInfo;
 419   1                          comm_data.len = IEC_ComDisTab[i].Len;
 420   1                          comm_data.len_asc = IEC_ComDisTab[i].Len_Asc;
 421   1                          return TRUE;
 422   1                      }
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 10  

 423   1                  }
 424   1              }
 425   1              else if(id<0x02000000)//ÐèÁ¿Çø
 426   1              {
 427   1                  for( i = 0 ; i <dim(IEC_ComDisTab1) ; i++ )
 428   1                  {
 429   1                      if( id == IEC_ComDisTab1[i].ComID )
 430   1                      {
 431   1                          comm_data.addr = IEC_ComDisTab1[i].Addr;
 432   1                          comm_data.Info.u16 = IEC_ComDisTab1[i].ComInfo;
 433   1                          comm_data.len = IEC_ComDisTab1[i].Len;
 434   1                          comm_data.len_asc = IEC_ComDisTab1[i].Len_Asc;
 435   1                          return TRUE;
 436   1                      }
 437   1                  }
 438   1              }
 439   1              else if(id<0x03000000)//ÏµÍ³±äÁ¿Çø
 440   1              {
 441   1                  for( i = 0 ; i <dim(IEC_ComDisTab2) ; i++ )
 442   1                  {
 443   1                      if( id == IEC_ComDisTab2[i].ComID )
 444   1                      {
 445   1                          comm_data.addr = IEC_ComDisTab2[i].Addr;
 446   1                          comm_data.Info.u16 = IEC_ComDisTab2[i].ComInfo;
 447   1                          comm_data.len = IEC_ComDisTab2[i].Len;
 448   1                          comm_data.len_asc = IEC_ComDisTab2[i].Len_Asc;
 449   1                          return TRUE;
 450   1                      }
 451   1                  }
 452   1              }
 453   1              else if(id<0x04000000)//ÊÂ¼þ¼ÇÂ¼Çø
 454   1              {
 455   1                  for( i = 0 ; i <dim(IEC_ComDisTab3) ; i++ )
 456   1                  {
 457   1                      if( id == IEC_ComDisTab3[i].ComID )
 458   1                      {
 459   1                          comm_data.addr = IEC_ComDisTab3[i].Addr;
 460   1                          comm_data.Info.u16 = IEC_ComDisTab3[i].ComInfo;
 461   1                          comm_data.len = IEC_ComDisTab3[i].Len;
 462   1                          comm_data.len_asc = IEC_ComDisTab3[i].Len_Asc;
 463   1                          return TRUE;
 464   1                      }
 465   1                  }
 466   1              }
 467   1              else if(id<0x05000000)//ÏµÍ³²ÎÊýÇø
 468   1              {
 469   1                  for( i = 0 ; i <dim(IEC_ComDisTab4) ; i++ )
 470   1                  {
 471   1                      if( id == IEC_ComDisTab4[i].ComID )
 472   1                      {
 473   1                          comm_data.addr = IEC_ComDisTab4[i].Addr;
 474   1                          comm_data.Info.u16 = IEC_ComDisTab4[i].ComInfo;
 475   1                          comm_data.len = IEC_ComDisTab4[i].Len;
 476   1                          comm_data.len_asc = IEC_ComDisTab4[i].Len_Asc;
 477   1                          return TRUE;
 478   1                      }
 479   1                  }
 480   1              }
 481   1              else if(id<0x09000000)//ÏµÍ³²ÎÊýÇø
 482   1              {
 483   1                  for( i = 0 ; i <dim(IEC_ComDisTab5) ; i++ )
 484   1                  {
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 11  

 485   1                      if( id == IEC_ComDisTab5[i].ComID )
 486   1                      {
 487   1                          comm_data.addr = IEC_ComDisTab5[i].Addr;
 488   1                          comm_data.Info.u16 = IEC_ComDisTab5[i].ComInfo;
 489   1                          comm_data.len = IEC_ComDisTab5[i].Len;
 490   1                          comm_data.len_asc = IEC_ComDisTab5[i].Len_Asc;
 491   1                          return TRUE;
 492   1                      }
 493   1                  }
 494   1              }
 495   1      
 496   1          return FALSE;*/
 497   1      }
 498          
 499          /*****************************************************************
 500           name:          uchar  GetComVar( uchar* Addr, uint* Info )
 501           function:      get command information precess  
 502           input:         no            
 503           return:        GetComVar()
 504                          =0    succeed  precess 
 505                          =1    fail precess 
 506          *****************************************************************/
 507          INT8U SecurityCK(void)
 508          {
 509   1              INT8U secType;
 510   1              secType = comm_data.Info.B08[0]&0x07; //È¨ÏÞ¼ì²â//
 511   1              /*
 512   1              if(secType ==(W_FCT>>8))
 513   1              {
 514   1                      if(ADJA_KEY)    // 0 ¶Ì½Ó 1 Î´¶Ì½Ó
 515   1                      {
 516   1                              return (mmover);
 517   1                      }
 518   1              }
 519   1          */
 520   1              return (mmok);
 521   1      }
 522          
 523          //-------------------------------------------------------------------------------//
 524          //  Function:      INT8U IEC_Cmd_Password_Deal(INT8U* sptr,INT8U len) 
 525          //  Description:   iec Í¨Ñ¶ÃÜÂëÖ¸Áî´¦Àí³ÌÐò
 526          //  Parameters:    
 527          //  Returns:        ÎÞ                          
 528          //  Others:         
 529          //-------------------------------------------------------------------------------//
 530          INT8U IEC_Cmd_Password_Deal(INT8U* sptr)
 531          {
 532   1        INT8U tmp_8u_01[4];
 533   1        INT8U tmp_8u_02[8];
 534   1      
 535   1          if((gs_uart_iec_app_var[g_ch_comm].iec_status & (COMM_REQUIST_OK_IEC+COMM_INFO_OK_IEC)) != 0x03)   ret
             -urn(FALSE);
 536   1      
 537   1           mem_read(&tmp_8u_01[0], ADR_METER_PARAM1_PW0, 4, MEM_E2P1);
 538   1           Lib_BCD_AscA(&tmp_8u_02[0], &tmp_8u_01[0], 4);
 539   1               
 540   1      
 541   1          if(Lib_Cmp_TwoArry((sptr+5), &tmp_8u_02[0], 8) == 0x00)  
 542   1          {
 543   2               gs_uart_iec_app_var[g_ch_comm].iec_status |= COMM_MIMA_OK_IEC;  // ¸ø³öÇëÇóÃüÁî³É¹¦±êÊ¶ //
 544   2               Get_ACK_Answer(sptr);
 545   2               gs_uart_iec_app_var[g_ch_comm].len = 1;
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 12  

 546   2               return TRUE;
 547   2          }
 548   1          else
 549   1          {
 550   2              if(Lib_Cmp_TwoArry((sptr+5), &Super_mima_iec[0], 8) == 0x00) 
 551   2              {
 552   3                  gs_uart_iec_app_var[g_ch_comm].iec_status |= COMM_MIMA_OK_IEC;  // ¸ø³öÇëÇóÃüÁî³É¹¦±êÊ¶ //
 553   3                  Get_ACK_Answer(sptr);
 554   3                  gs_uart_iec_app_var[g_ch_comm].len = 1;
 555   3                  return TRUE;
 556   3              }
 557   2          }
 558   1          api_deal_even_class_recode(ID_CLASS_I_MMERR,START); //  
 559   1          return FALSE;
 560   1      }
 561          
 562          
 563          //-------------------------------------------------------------------------------//
 564          //  Function:      INT8U IEC_Cmd_Read_Deal(INT8U* sptr,INT8U len)
 565          //  Description:   iec Í¨Ñ¶¶ÁÖ¸Áî´¦Àí³ÌÐò
 566          //  Parameters:    
 567          //  Returns:        ÎÞ                          
 568          //  Others:         
 569          //-------------------------------------------------------------------------------//
 570          INT8U IEC_Cmd_Read_Deal(INT8U* sptr)
 571          {
 572   1       INT8U i,j;
 573   1       INT8U  mem_type;
 574   1       INT8U  data_buff[128];
 575   1       INT8U  *ptr_adr;
 576   1       INT16U ctmp1;
 577   1       ST_U32_U08  long_tmp;
 578   1       ST_U16_U08      LPRecStart,LPRecEnd;
 579   1      
 580   1      SUM_MMD_DATA_UNIT t;
 581   1      NEW_MMD_DATA_UNIT te;
 582   1          if((gs_uart_iec_app_var[g_ch_comm].iec_status &(COMM_REQUIST_OK_IEC+COMM_INFO_OK_IEC+COMM_MIMA_OK_IEC)
             -) != 0x07)   return(FALSE);   
 583   1          //get comm DI1 DI0
 584   1           Lib_Asc_BCDA(&comm_data.di1_di0.B08[0], sptr+4,8);
 585   1      
 586   1          //get other comm fram data  
 587   1          if(get_IEC_comm_var( comm_data.di1_di0.u32) == 0 )   return(FALSE);
 588   1          if( ( comm_data.Info.u16& EN_R) == 0 )  return(FALSE);
 589   1          //  »ñÈ¡Êý¾ÝµÄ´æ´¢ÀàÐÍ //
 590   1          mem_type = (comm_data.Info.B08[0]>>3)&0x07;         
 591   1          //Êý¾ÝÓòÇåÁã²¢ÉèÖÃ·¢ËÍ³¤¶È
 592   1          Lib_Set_String((sptr+2), '0', comm_data.len_asc);  
 593   1      
 594   1          ptr_adr = comm_data.addr;
 595   1      
 596   1            //    // 
 597   1              //²»ÔÚ±í¸ñÄÚID´¦Àí µ¥Ìõ¸ººÉID 
 598   1              if((comm_data.di1_di0.u32>=0x06010001)&&(comm_data.di1_di0.u32<=0x060105A0))
 599   1              {
 600   2                      ctmp1 = (INT16U)(comm_data.di1_di0.u32 - 0x06010001);
 601   2                      if(ctmp1 < LPRunPa.Num[0])      // ¶ÁÈ¡ID Ð¡ÓÚÓÚÒÑ¼ÇÂ¼Êý
 602   2                      {
 603   3                              comm_data.len = LPRec_Read_1(sptr+2, ctmp1);
 604   3                              comm_data.len_asc = 2*comm_data.len;    
 605   3                      }
 606   2                      else
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 13  

 607   2                      {
 608   3      //                      comm_data.len = LPRec_Read_1(sptr+2, ctmp1);
 609   3      //                      comm_data.len_asc = 2*comm_data.len;    
 610   3      //                      Lib_Set_String((sptr+2), 'F', comm_data.len_asc); 
 611   3                              comm_data.len_asc = 0;  
 612   3                      }
 613   2      
 614   2      
 615   2                      // ³É¹¦ºóÊý¾Ý×éÖ¡ //
 616   2                      //api_deal_even_class_recode(ID_CLASS_I_COMM,START);
 617   2                      gs_uart_iec_app_var[g_ch_comm].len= (comm_data.len_asc+5);
 618   2                      *(sptr+0) = STX;
 619   2                      *(sptr+1) = '(';
 620   2                      CLRWDT(); *(sptr+2+comm_data.len_asc) = ')';
 621   2                      *(sptr+gs_uart_iec_app_var[g_ch_comm].len-2) =ETX;
 622   2              CLRWDT();       *(sptr+gs_uart_iec_app_var[g_ch_comm].len-1) = Get_Bcc_Chk(sptr, 1, gs_uart_iec_app_var[g_ch_c
             -omm].len-2);
 623   2      
 624   2                      return(TRUE); 
 625   2              }
 626   1              
 627   1              
 628   1              if((comm_data.di1_di0.u32>=0x060A0001)&&(comm_data.di1_di0.u32<=0x060A0120))//   //SXL 2019-01-6
 629   1        {
 630   2                      LPRecStart.u16 =(INT16U)((comm_data.di1_di0.u32 - 0x060A0001)*BLOCK_MAX_LEN);
 631   2                      LPRecEnd.u16 =LPRecStart.u16+BLOCK_MAX_LEN;
 632   2                      
 633   2                      if(LPReadPara.ReadLoraFlag == FALSE )
 634   2                      {                       
 635   3                              LPReadPara.Original_FrameNum = LPRunPa.Num[0] ;
 636   3                              LPReadPara.Original_Ptr = LPRunPa.Ptr[0] ;
 637   3                      }               
 638   2                      
 639   2                      comm_data.len_asc  = LPRec_Read_Block(sptr+2,LPRecStart.u16, LPRecEnd.u16);
 640   2                       
 641   2                      
 642   2                      if(LPReadPara.ReadLoraFlag == FALSE )   LPReadPara.ReadLoraFlag = TRUE; 
 643   2                              
 644   2                      gs_uart_iec_app_var[g_ch_comm].len= (comm_data.len_asc+5);
 645   2                      CLRWDT(); 
 646   2                      *(sptr+0) = STX;
 647   2                      *(sptr+1) = '(';CLRWDT(); 
 648   2                      *(sptr+2+comm_data.len_asc) = ')';
 649   2                      CLRWDT(); *(sptr+gs_uart_iec_app_var[g_ch_comm].len-2) =ETX;
 650   2                      *(sptr+gs_uart_iec_app_var[g_ch_comm].len-1) = Get_Bcc_Chk(sptr, 1, gs_uart_iec_app_var[g_ch_comm].len-2
             -);
 651   2      CLRWDT(); 
 652   2                      return(TRUE); 
 653   2                      
 654   2                      }
 655   1              
 656   1          // ¸ù¾Ý¶ÁÈ¡Êý¾ÝµÄIDÏîÄ¿×ö·ÖÖ§´¦Àí //
 657   1          switch(comm_data.di1_di0.u32)
 658   1          {   
 659   2                      case 0x02010000:    //µçÑ¹ Ô´Êý¾ÝÎªHEX32£¬0.1VÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XXX.XV //
 660   2                      case 0x02010100:    //µçÑ¹ Ô´Êý¾ÝÎªHEX32£¬0.1VÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XXX.XV //
 661   2                              Lib_long_bcd4(&long_tmp.B08[0],gs_measure_var_data.gs_really[0].dw_u_val.u32);
 662   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &long_tmp.B08[2], 2);
 663   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 664   2                      break;
 665   2                      
 666   2                      case 0x02020000:    //LµçÁ÷ Ô´Êý¾ÝÎªHEX32£¬0.001AÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XXX.XXXA //
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 14  

 667   2                      case 0x02020100:    //LµçÁ÷ Ô´Êý¾ÝÎªHEX32£¬0.001AÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XXX.XXXA //
 668   2                              Lib_long_bcd4(&long_tmp.B08[0],(gs_measure_var_data.gs_really[0].dw_i_val.u32));
 669   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &long_tmp.B08[1], 3);
 670   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 671   2                      break;
 672   2                      
 673   2                      case 0x02800001:    //NµçÁ÷ Ô´Êý¾ÝÎªHEX32£¬0.001AÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XXX.XXXA //
 674   2                              Lib_long_bcd4(&long_tmp.B08[0],(gs_measure_var_data.dw_i_n_val.u32));
 675   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &long_tmp.B08[1], 3);
 676   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 677   2                      break;
 678   2                      
 679   2                      case 0x02030000:    //L   ¹¦ÂÊÔ´Êý¾ÝÎªHEX32£¬0.0001KWÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XX.XXXXkW //
 680   2                      case 0x02030100:        //¹¦ÂÊÔ´Êý¾ÝÎªHEX32£¬0.0001KWÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XX.XXXXkW //
 681   2                              Lib_long_bcd4(&long_tmp.B08[0],(gs_measure_var_data.gs_really[0].dw_p_val.u32));
 682   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &long_tmp.B08[1], 3);
 683   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 684   2                      break;
 685   2                      
 686   2                      case 0x02030200:    //N¹¦ÂÊÔ´Êý¾ÝÎªHEX32£¬0.0001KWÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XX.XXXXkW //
 687   2                              Lib_long_bcd4(&long_tmp.B08[0],(gs_measure_var_data.dw_p_n_val.u32));
 688   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &long_tmp.B08[1], 3);
 689   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 690   2                      break;
 691   2      
 692   2                      case 0x02060000:        //¹¦ÂÊÒòÊýÊý¾ÝÎªHEX16£¬0.001£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½0.001 //
 693   2                      case 0x02060100:    //¹¦ÂÊÒòÊýÊý¾ÝÎªHEX16£¬0.001£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½0.001 //
 694   2                              Lib_word_bcd2(&long_tmp.B08[0],(gs_measure_var_data.gs_really[0].dw_pf_val.u16));
 695   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &long_tmp.B08[0], 2);
 696   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 697   2                      break;
 698   2      
 699   2                      case 0x02800002:    //µçÍøÆµÂÊÊý¾ÝÎªHEX16£¬0.01Hz£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½xx.xx //
 700   2                              Lib_word_bcd2(&long_tmp.B08[0],(gs_measure_var_data.gs_really[0].w_freq_val.u16));
 701   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &long_tmp.B08[0], 2);
 702   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 703   2                      break;
 704   2      
 705   2                      case 0x04000100://ÈÕÆÚ¼°ÐÇÆÚ(ÆäÖÐ0´ú±íÐÇÆÚÌì)YYMMDDWWhhmmss
 706   2                              Lib_Copy_Str_TwoArry(&data_buff[0], ptr_adr, comm_data.len);
 707   2                              data_buff[7] = data_buff[0];    //ww
 708   2                              data_buff[0] = data_buff[1];    //YY
 709   2                              data_buff[1] = data_buff[2];    //MM
 710   2                              data_buff[2] = data_buff[3];    //DD
 711   2                              data_buff[3] = data_buff[7];    //WW
 712   2                              data_buff[4] = data_buff[4];    //hh
 713   2                              data_buff[5] = data_buff[5];    //mm
 714   2                              data_buff[6] = data_buff[6];    //ss
 715   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 716   2                      break;
 717   2      
 718   2                      case 0x04000401://±íµØÖ· ±íºÅ NNNNNNNNNNNN
 719   2                              mem_read(&data_buff[0], (INT16U)comm_data.addr,  comm_data.len,  mem_type );
 720   2                              comm_data.len_asc = get_meter_id_asclen(&data_buff[0], 16);
 721   2                              comm_data.len = comm_data.len_asc>>1;
 722   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len);
 723   2                      break;
 724   2                      
 725   2                      case 0x04800001: //Èí¼þ°æ±¾ºÅ ÒÑÊÇASCÂë
 726   2                              Lib_Copy_Str_TwoArry(sptr+2, ptr_adr, comm_data.len);
 727   2                      break;          
 728   2                      
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 15  

 729   2                      case 0x80805001:        //µ±Ç°ÔÂ×ÜµçÁ¿+¼ÌµçÆ÷×´Ì¬+±í¼ÆÈÕÆÚÊ±¼ä //
 730   2                              //µ±Ç°ÔÂ×ÜµçÁ¿
 731   2                              mem_read(&data_buff[10], (INT16U)&gs_energy_user_data.us_val[0][0].buf[0], LEN_EC_UNIT, MEM_RAM);         //»
             -ñÈ¡µ±Ç°Êý¾Ý //
 732   2                              api_get_energy_LCD(&data_buff[10], 0x62,&data_buff[0]);
 733   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], 4); 
 734   2                              //¼ÌµçÆ÷×´Ì¬
 735   2                              mem_read(&data_buff[0], (INT16U)ADR_METER_PARAM1_RELAY_CMD, 2, MEM_E2P1);         //»ñÈ¡µ±Ç°Êý¾Ý //
 736   2                              Lib_BCD_AscA(sptr+2+8, &data_buff[0], 2); 
 737   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &gs_CurDateTime.Year, 6);
 738   2                              Lib_BCD_AscA(sptr+2+8+4, &data_buff[0], 6); 
 739   2                      break;
 740   2      
 741   2                      case 0x0506FF01: //¶³½á1
 742   2                      case 0x0506FF02: //¶³½á2
 743   2                      case 0x0506FF03: //¶³½á3
 744   2                      case 0x0506FF04: //¶³½á4
 745   2                                i = comm_data.di1_di0.B08[3];
 746   2                                mem_read(&data_buff[10], &energy_data_array[i].buf[0], LEN_BLOCK_4Energy_E2P/4,MEM_RAM);//µçÁ¿
*** WARNING C214 IN LINE 746 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: 'Argument': conversion: pointer to non-pointer
 747   2                                api_get_energy_LCD(&data_buff[10], 0x62,&data_buff[0]);
 748   2                                Lib_BCD_AscA(sptr+2+10, &data_buff[0], 4);    
 749   2                                      
 750   2                                mem_read(&te, &st_mmd_unit_array[i].buf[0], LEN_NEW_MMD_UNIT, MEM_RAM);//ÐèÁ¿
*** WARNING C182 IN LINE 750 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: pointer to different objects
*** WARNING C214 IN LINE 750 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: 'Argument': conversion: pointer to non-pointer
 751   2                                te.val.val_hex32 /=100;
 752   2                                data_buff[0] = te.val.val_hex32/1000000;
 753   2                                data_buff[1] = te.val.val_hex32%1000000/10000;
 754   2                                data_buff[2] = te.val.val_hex32%10000/100 ;
 755   2                                data_buff[3] = te.val.val_hex32%100  ;
 756   2                                for(j=0;j<4;j++)
 757   2                                {
 758   3                                      if(data_buff[j]>0x09)
 759   3                                      {
 760   4                                              data_buff[j]+= 0x06*(data_buff[j]/10);
 761   4                                      }
 762   3                                }
 763   2                                Lib_BCD_AscA(sptr+2+10+8,&data_buff[0],4);
 764   2                                //Lib_BCD_AscA(sptr+2+10+8,&te.buf[0],4);
 765   2                               
 766   2                                mem_read(&t, &sum_st_mmd_unit_array[i].buf[0], LEN_SUM_MMD_UNIT, MEM_RAM);//ÀÛ¼ÆÐèÁ¿
*** WARNING C182 IN LINE 766 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: pointer to different objects
*** WARNING C214 IN LINE 766 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: 'Argument': conversion: pointer to non-pointer
 767   2                                t.val.val_hex32 /=100;
 768   2                                data_buff[0] = t.val.val_hex32/1000000;
 769   2                                data_buff[1] = t.val.val_hex32%1000000/10000;
 770   2                                data_buff[2] = t.val.val_hex32%10000/100; 
 771   2                                data_buff[3] = t.val.val_hex32%100;
 772   2                                for(j=0;j<4;j++)
 773   2                                {
 774   3                                      if(data_buff[j]>0x09)
 775   3                                      {
 776   4                                              data_buff[j]+=0x06*(data_buff[j]/10);
 777   4                                      }
 778   3                                }
 779   2                                Lib_BCD_AscA(sptr+2+10+8+8,&data_buff[0],4);
 780   2                               // Lib_BCD_AscA(sptr+2+10+8+8,&t.buf[0],4);
 781   2                                data_buff[0] = te.val.date_rtc[0];    //YY
 782   2                                data_buff[1] = te.val.date_rtc[1];    //MM
 783   2                                data_buff[2] = te.val.date_rtc[2];    //DD
 784   2                                data_buff[3] = te.val.date_rtc[3];    //hh
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 16  

 785   2                                data_buff[4] = te.val.date_rtc[4];    //mm
 786   2                                Lib_BCD_AscA(sptr+2, &data_buff[0], 5);
 787   2                                if(t.buf[4]>0x09)
 788   2                                      {
 789   3                                              t.buf[4]+=0x06*(t.buf[4]/10);
 790   3                                      }
 791   2                                Lib_BCD_AscA(sptr+2+10+8+8+8,&t.buf[4],1);//´ÎÊý
 792   2                      break;
 793   2                      
 794   2              default:
 795   2                              ////////////////µçÄÜÁ¿ÌØÊâ´¦Àí/////////////////////////////
 796   2                              if(comm_data.di1_di0.B08[0]==0x00)
 797   2                              {
 798   3                                      comm_data.len = LEN_EC_UNIT;   // ÐÞ¸Ä»ñÈ¡³¤¶È//
 799   3                              }
 800   2                              ///////////////////////////////////////////////////////////////////
 801   2      
 802   2                              if((comm_data.Info.u16&CM_ALL) == CM_BILL)
 803   2                              {
 804   3                                      mem_read(&data_buff[0],api_get_bill_record_addr((INT16U)comm_data.addr), comm_data.len,  mem_type );
 805   3                              }
 806   2                              else if((comm_data.Info.u16&CM_ALL) == CM_EBIL)//ÊÂ¼þ¼ÇÂ¼ÀàÊý¾Ý
 807   2                      {
 808   3              mem_read(&data_buff[0], comm_data.addr,     (comm_data.len>>1),  mem_type );
*** WARNING C214 IN LINE 808 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: 'Argument': conversion: pointer to non-pointer
 809   3              mem_read(&data_buff[6], comm_data.addr+60,  (comm_data.len>>1),  mem_type );
*** WARNING C214 IN LINE 809 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: 'Argument': conversion: pointer to non-pointer
 810   3                  }
 811   2                              
 812   2                              else 
 813   2                              {
 814   3                                      if(mem_type==MEM_RAM)
 815   3                                      {
 816   4                                              Lib_Copy_Str_TwoArry(&data_buff[0], ptr_adr, comm_data.len);
 817   4                                      }
 818   3                                      else
 819   3                                      {
 820   4                                              mem_read(&data_buff[0],(INT16U)comm_data.addr,comm_data.len,mem_type );
 821   4                                      }
 822   3                              }
 823   2                              ////////////////µçÄÜÁ¿ÌØÊâ´¦Àí/////////////////////////////
 824   2                              if(comm_data.di1_di0.B08[0]==0x00)
 825   2                              {
 826   3                                      Lib_Copy_Str_TwoArry(&data_buff[10], &data_buff[0], LEN_EC_UNIT);
 827   3                                      api_get_energy_LCD(&data_buff[10], 0x62, &data_buff[0]) ;
 828   3                                      comm_data.len=4;
 829   3                              }
 830   2                              ///////////////////////////////////////////////////////////////////
 831   2      
 832   2                              ////////////////×î´óÐèÁ¿ÌØÊâ´¦Àí/////////////////////////////
 833   2                              if(comm_data.di1_di0.B08[0]==0x01)
 834   2                              {  
 835   3                                      Lib_Copy_Str_TwoArry(&long_tmp.B08[0], &data_buff[0], 4);
 836   3                                      Lib_long_bcd4(&data_buff[0],long_tmp.u32);
 837   3                              }
 838   2                              
 839   2                              
 840   2                              
 841   2                              
 842   2                              
 843   2                              ///////////////////////////////////////////////////////////////////                
 844   2                              if(comm_data.len_asc == 5)
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 17  

 845   2                              {
 846   3                                      *(sptr+2) = Lib_BtoA(data_buff[0]&0x0f);
 847   3                                      Lib_BCD_AscA(sptr+3, &data_buff[1], 2);   
 848   3                              }
 849   2                              else
 850   2                              {
 851   3                                      Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 852   3                              }
 853   2                  break;      
 854   2          }
 855   1      
 856   1          // ³É¹¦ºóÊý¾Ý×éÖ¡ //
 857   1          gs_uart_iec_app_var[g_ch_comm].len= (comm_data.len_asc+5);
 858   1          *(sptr+0) = STX;
 859   1          *(sptr+1) = '(';
 860   1          *(sptr+2+comm_data.len_asc) = ')';
 861   1          *(sptr+gs_uart_iec_app_var[g_ch_comm].len-2) =ETX;
 862   1          *(sptr+gs_uart_iec_app_var[g_ch_comm].len-1) = Get_Bcc_Chk(sptr, 1, gs_uart_iec_app_var[g_ch_comm].len
             --2);
 863   1              
 864   1          return(TRUE); 
 865   1      }
 866          
 867          
 868          //-------------------------------------------------------------------------------//
 869          //  Function:      INT8U IEC_Cmd_Write_Deal(INT8U* sptr,INT8U len)
 870          //  Description:   iec Í¨Ñ¶Ð´Ö¸Áî´¦Àí³ÌÐò
 871          //  Parameters:   lenÎªÉèÖÃÊý¾ÝµÄÊµ¼Ê³¤¶È
 872          //  Returns:        ÎÞ                          
 873          //  Others:         
 874          //-------------------------------------------------------------------------------//
 875          INT8U IEC_Cmd_Write_Deal(INT8U* sptr,INT8U len)
 876          {
 877   1      // INT8U tmp_8u_01[16];
 878   1       INT8U  mem_type;
 879   1       INT8U  data_buff[70];
 880   1       INT8U  sectemp;
 881   1       INT8U i,MeterID_LenTmp; //±íºÅ  ÓÐÐ§³¤¶È asc
 882   1       INT8U  *ptr_adr;
 883   1       
 884   1          if((gs_uart_iec_app_var[g_ch_comm].iec_status &(COMM_REQUIST_OK_IEC+COMM_INFO_OK_IEC+COMM_MIMA_OK_IEC)
             -) != 0x07)   return(FALSE);
 885   1          //get comm DI1 DI0
 886   1          Lib_Asc_BCDA(&comm_data.di1_di0.B08[0], sptr+4,8);
 887   1          //get other comm fram data 
 888   1          if(get_IEC_comm_var( comm_data.di1_di0.u32) == 0 )   return(FALSE);
 889   1      
 890   1          if( ( comm_data.Info.u16& EN_W) == 0 )  return(FALSE);
 891   1          //  »ñÈ¡Êý¾ÝµÄ´æ´¢ÀàÐÍ //
 892   1          mem_type = (comm_data.Info.B08[0]>>3)&0x07;         
 893   1          sectemp = SecurityCK();                                     //È¨ÏÞÅÐ¶Ï
 894   1          if(sectemp == mmover)   return(FALSE);
 895   1      
 896   1          //Êý¾ÝÓòÇåÁã²¢¼ì²é½ÓÊÕµÄÊý¾Ý³¤¶ÈºÏ·¨ÐÔ //
 897   1          Lib_Set_String(&data_buff[0], 0x00, comm_data.len); 
 898   1          if(comm_data.di1_di0.u32== 0x04000401) //³ýÉèÖÃ±íºÅÍâ.¶¼ÐèÒª¶Ô±ÈÊý¾Ý³¤¶È
 899   1          {
 900   2              if((len > comm_data.len_asc+16)||(len < 16))
 901   2              return(FALSE);
 902   2          }
 903   1          else
 904   1          {
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 18  

 905   2              if(len != (comm_data.len_asc+16))          
 906   2              return(FALSE);
 907   2          }
 908   1      
 909   1          ptr_adr = comm_data.addr;
 910   1      
 911   1          // ¸ù¾ÝÉèÖÃÊý¾ÝµÄIDÏîÄ¿×ö·ÖÖ§´¦Àí //
 912   1          switch(comm_data.di1_di0.u32)
 913   1          {
 914   2      
 915   2              case 0x04000100://ÈÕÆÚ¼°ÐÇÆÚ(ÆäÖÐ0´ú±íÐÇÆÚÌì)YYMMDDWWhhmmss  
 916   2                  Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);   //AtoB(INT8U Asc)
 917   2                  gs_CurDateTime.Year= data_buff[0];
 918   2                  gs_CurDateTime.Month= data_buff[1];
 919   2                  gs_CurDateTime.Day= data_buff[2];
 920   2                  gs_CurDateTime.Week= data_buff[3];
 921   2                  gs_CurDateTime.Hour= data_buff[4];
 922   2                  gs_CurDateTime.Minute= data_buff[5];
 923   2                  gs_CurDateTime.Second= data_buff[6];
 924   2                  EA=0;
 925   2                  Set_RTCTime(&gs_CurDateTime);
 926   2                  EA=1;
 927   2                  mem_db_write(ADR_METER_VAR_RTC, &gs_CurDateTime.Week, 7, MEM_E2P1);
 928   2                              CLRWDT();  
 929   2                                          api_deal_even_class_recode(ID_CLASS_I_setRtc,START);
 930   2                  api_init_md_data_ram();
 931   2                      #if (TARIFF_MAX_NUM>0)
 932   2                  api_update_triffNo_pre_minute();
 933   2                      #endif
 934   2                  break;
 935   2                              
 936   2      
 937   2                  //±íºÅÌØÊâ´¦Àí
 938   2                  case 0x04000401://±íµØÖ· ±íºÅ 16¸ö×Ö½Ú ×ÔÊÊÓ¦,ÈçÉèÆæÊý£¬ÔòÇ°²¹0
 939   2                      MeterID_LenTmp = (len-16);      //ÓÐÐ§±íºÅ  ³¤¶È
 940   2                      if(((len-16)%2)!=0)     //ÆæÊýÔòÇ°Ãæ²¹Ò»¸ö0
 941   2                      {
 942   3                              for(i=(len-16);i>0;i--)
 943   3                              {
 944   4                                      *(sptr+13+i) = *(sptr+13+i-1) ; //ÏòºóÅ²1Î»
 945   4                              }
 946   3                              *(sptr+13)= '0';                                        //¸ßÎ»²¹0
 947   3                              MeterID_LenTmp = (len-16) +1;
 948   3                      }
 949   2                                      comm_data.len_asc = MeterID_LenTmp;
 950   2                                      Lib_Set_String(&data_buff[0], 0xFF, 16);
 951   2                                      Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);   //AtoB(INT8U Asc)                  
 952   2                                      mem_db_write((INT16U)comm_data.addr, &data_buff[0], comm_data.len, mem_type);           //Ð´ÈëÓ¦¸ÃÊÇ16×Ö½Ú£¬¶ø²
             -»ÊÇÉèÖÃµÄ³¤¶È
 953   2                      break;
 954   2      
 955   2                              
 956   2                      case 0x04000B01://½áËãÈÕDDHH 4
 957   2                      Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);   //AtoB(INT8U Asc)
 958   2                      if((data_buff[0]<0x01)||(data_buff[0]>0x28)||(data_buff[1]>0x23))               //´íÎóÅÐ¶Ï
 959   2                      {
 960   3                          return(FALSE);
 961   3                      }
 962   2                      mem_db_write((INT16U)comm_data.addr, &data_buff[0], comm_data.len, mem_type);
 963   2                      break;
 964   2      //              case 0x04800003://À­Õ¢ºÏÕ¢²Ù×÷//)
 965   2      //                              Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);       //AtoB(INT8U Asc)
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 19  

 966   2      //                              if(Drv_relay_COMM_CMD_operating(&data_buff[0])==FALSE)  
 967   2      ////                            {
 968   2      //                                      return(FALSE);
 969   2      //                              }
 970   2      //                              break;  
 971   2      
 972   2                      case 0x04000103://ÐèÁ¿²ÎÊý PERIOD : SLID   4  //ÐÞ¸ÄºóÐèÁ¿ÖØÐÂ¼ÆËã //
 973   2                      Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);   //AtoB(INT8U Asc)
 974   2                      if(((data_buff[0]%data_buff[1]) !=0)||(data_buff[0]>30)||(data_buff[0]==0)||(data_buff[1]=
             -=0))                //´íÎóÅÐ¶Ï//
 975   2                      {
 976   3                          return(FALSE);
 977   3                      }
 978   2                      mem_db_write((INT16U)comm_data.addr, &data_buff[0], comm_data.len, mem_type);
 979   2      //                              CLRWDT();
 980   2                      api_init_md_data_ram();
 981   2                                      CLRWDT();
 982   2                      break;
 983   2      
 984   2      
 985   2      ///////////Îó²îÐ£±í//////////////////
 986   2                      case 0x0000FEB0: 
 987   2                      case 0x0000FEB1:
 988   2                      case 0x0000FEB2:
 989   2                      case 0x0000FEB3:
 990   2                      case 0x0000FEB4:
 991   2                      case 0x0000FEB5:
 992   2                              Measure_Electric_Err_Gain(sptr);//±ØÐëÏÈÐ£×¼Îó²î£¬ÑÓÊ±1ÃëÒÔÉÏÐ£×¼µç²ÎÁ¿²Å×¼//   
 993   2                      break;
 994   2                      //Ð£±í³õÊ¼»¯(²ÎÊýÇåÁã)
 995   2                      case 0x80800803:                
 996   2                              if((*(sptr+13)=='3')&&(*(sptr+14)=='3')&&(*(sptr+15)=='3'))  
 997   2                              {
 998   3                                      if((*(sptr+16)=='3'))                                   // clear all
 999   3                                      {
1000   4                                              gs_adj_emu_param.w1gain=0;
1001   4                                              gs_adj_emu_param.p1cal=0;
1002   4                                              gs_adj_emu_param.watt1os=0;
1003   4                                              gs_adj_emu_param.irms1os=0;
1004   4                                              gs_adj_emu_param.w2gain=0;
1005   4                                              gs_adj_emu_param.p2cal=0;
1006   4                                              gs_adj_emu_param.watt2os=0;
1007   4                                              gs_adj_emu_param.irms2os=0;
1008   4                                              gs_adj_emu_param.urmsos=0;
1009   4                                              CLRWDT();
1010   4                                      }
1011   3                                      if((*(sptr+16)=='2'))                                   // ÇåµÚ¶þÂ·½»±í²ÎÊý
1012   3                                      {
1013   4                                              gs_adj_emu_param.w1gain=0;
1014   4                                              gs_adj_emu_param.p1cal=0;
1015   4                                              gs_adj_emu_param.watt1os=0;
1016   4                                              gs_adj_emu_param.irms1os=0;
1017   4                                              gs_adj_emu_param.urmsos=0;
1018   4                                              CLRWDT();
1019   4                                      }
1020   3                                      Save_EMU_AdjParam();
1021   3                                      Check_EMU_AdjParam();//  »Ö¸´Ä¬ÈÏÊý¾Ý//
1022   3                              }
1023   2                              else
1024   2                              {
1025   3                                      return FALSE;
1026   3                              }
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 20  

1027   2                              break;  
1028   2      
1029   2                      case 0x0000FEBB://¼ÆÁ¿±¶Æµ10±¶»ò //     
1030   2                              if((*(sptr+13)=='0')&&(*(sptr+14)=='0')&&(*(sptr+15)=='1')&&(*(sptr+16)=='6')) 
1031   2                              {
1032   3                                      //±¶Æµ10±¶£¬³£ÊýÎª10000 //
1033   3                                      data_buff[0] = 0x3C;     // ´ú±í±¶Æµ10±¶ //
1034   3                                      mem_db_write(ADR_METER_PARAM1_CONST_FAST_FLG, &data_buff[0], 1, MEM_E2P1);
1035   3                                      Check_EMU_AdjParam();//  »Ö¸´Ä¬ÈÏÊý¾Ý//
1036   3                              }
1037   2                              else if((*(sptr+13)=='0')&&(*(sptr+14)=='1')&&(*(sptr+15)=='B')&&(*(sptr+16)=='8')) 
1038   2                              {
1039   3                                      //±¶Æµ»Ö¸´£¬³£ÊýÎª1000 //
1040   3                                       data_buff[0] = 0;         // ´ú±í±¶Æµ10±¶ //
1041   3                                      mem_db_write(ADR_METER_PARAM1_CONST_FAST_FLG, &data_buff[0], 1, MEM_E2P1);
1042   3                                      Check_EMU_AdjParam();//  »Ö¸´Ä¬ÈÏÊý¾Ý//
1043   3                              }
1044   2                              else
1045   2                              {
1046   3                                      return FALSE;
1047   3                              }
1048   2                              break;
1049   2                              
1050   2                      case 0x08020200://NN=FF£¬Çå³ýËùÓÐÍ¨µÀ£»//
1051   2                              if((*(sptr+13)=='F')&&(*(sptr+14)=='F'))        //YYY
1052   2                              {
1053   3      //                              api_clr_even_by_comm(); 
1054   3                                      IsClrEvent = 1;
1055   3                                      CLRWDT();
1056   3                              }
1057   2                              else
1058   2                              {
1059   3                                      return(FALSE);
1060   3                              }
1061   2                              break;
1062   2                      
1063   2                              case 0x08020100://Ö»Çåµ±Ç°ÐèÁ¿ÇåÁã//
1064   2                                      Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);   //AtoB(INT8U Asc)
1065   2                                      if((data_buff[0]!=0))  return(FALSE);
1066   2                                      CLRWDT();
1067   2                                      api_clr_current_MD_data();
1068   2                                      api_deal_even_class_recode(ID_CLASS_I_resetMD,START);
1069   2                              CLRWDT();
1070   2                              break;
1071   2      
1072   2                  case 0x08020300:
1073   2                              // Asc_BCDA( &data_buff[0],(sptr+13), 1*2);
1074   2                  // Ò»¸öÍ¨µÀ¸ººÉ¼ÇÂ¼Ö¸Õë¡¢¼ÇÂ¼¸öÊý 
1075   2                  if((*(sptr+13)=='0')&&(*(sptr+14)=='0'))    //YYY
1076   2                              {
1077   3                                      LoadProRst();
1078   3                                      CLRWDT();
1079   3                              }
1080   2                              else
1081   2                              {
1082   3                                      return(FALSE);
1083   3                              }
1084   2                              break;
1085   2                              
1086   2                              
1087   2                      case 0x08020400://µçÁ¿ÇåÁã(µç±í×ÜÇå(µçÁ¿+ÐèÁ¿)) //
1088   2                              Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);   //AtoB(INT8U Asc)
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 21  

1089   2                              if((data_buff[0]!=0)||(data_buff[1]!=0)||(data_buff[2]!=0)||(data_buff[3]!=0))  return(FALSE);
1090   2                              CLRWDT();
1091   2                              clr_flag = 1;
1092   2                              break;
1093   2      
1094   2                      case 0x08020500:// ¹¤³§Ä£Ê½//   
1095   2                              Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);       //AtoB(INT8U Asc)
1096   2                              gs_sys_globaL_var.meter_factory_status = data_buff[0] ; //¸üÐÂ×´Ì¬×Ö
1097   2                              mem_db_write((INT16U)comm_data.addr, &data_buff[0], comm_data.len, mem_type);
1098   2                              break;
1099   2                              
1100   2                      case 0xEE000118://EEPROM±êÖ¾//
1101   2                              Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);       //AtoB(INT8U Asc)
1102   2                              CLRWDT();
1103   2                              mem_db_write((INT16U)comm_data.addr, &data_buff[0], comm_data.len, mem_type);
1104   2                              CLRWDT();
1105   2                              while(1)
1106   2                              {
1107   3                                      NOP();                  // ¸´Î»£¬µÈ´ýÊý¾Ý¼ì²é»Ø¸´Êý¾Ý£¬10Ãë×óÓÒ //
1108   3                              }       
1109   2                              CLRWDT();
1110   2                              break;
1111   2                              
1112   2                       //Ð£±í²ÎÊýÍâËùÓÐÊý¾ÝÇåÁã//
1113   2                      case 0x0000FEFF://NN=FF£¬Çå³ýËùÓÐÍ¨µÀ£»//
1114   2                               if((*(sptr+13)=='5')&&(*(sptr+14)=='5')&&(*(sptr+15)=='5')&&(*(sptr+16)=='5'))  
1115   2                              {
1116   3                                      mem_db_clr(0);   //Êý¾ÝÇøÐ£ÑéºÍÈ«²¿ÇåÁã //
1117   3                                      //2019-01-24  cxy
1118   3                                      api_clr_freeze_energy();//Çå³ý¶³½áÊý¾Ý
*** WARNING C206 IN LINE 1118 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: 'api_clr_freeze_energy': missing function-proto
             -type
1119   3      
1120   3                      while(1)
1121   3                      {
1122   4                          NOP();          // ¸´Î»£¬µÈ´ýÊý¾Ý¼ì²é»Ø¸´Êý¾Ý£¬10Ãë×óÓÒ //
1123   4                      }       
1124   3                                      CLRWDT();
1125   3                              }
1126   2                              else if((*(sptr+13)=='3')&&(*(sptr+14)=='3')&&(*(sptr+15)=='3')&&(*(sptr+16)=='3'))  
1127   2                               {
1128   3                                       mem_db_clr(0xA5);   //°üÀ¨Ð£×¼²ÎÊýÈ«²¿ÇåÁã //
1129   3                                       while(1)
1130   3                                       {
1131   4                                               NOP();                  // ¸´Î»£¬µÈ´ýÊý¾Ý¼ì²é»Ø¸´Êý¾Ý£¬10Ãë×óÓÒ //
1132   4                                       }       
1133   3                                       CLRWDT();
1134   3                               }
1135   2                              else
1136   2                              {
1137   3                                      return(FALSE);
1138   3                              }
1139   2                              break;
1140   2      
1141   2                default:
1142   2                       Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);   //AtoB(INT8U Asc)
1143   2                          
1144   2                       if(mem_type == MEM_RAM)
1145   2                       {
1146   3                             mem_write((INT16U)comm_data.addr,&data_buff[0], comm_data.len, mem_type);
1147   3                       }
1148   2                       else
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 22  

1149   2                       {
1150   3                             mem_db_write((INT16U)comm_data.addr, &data_buff[0], comm_data.len, mem_type);
1151   3                       }
1152   2                                       
1153   2                              break;  
1154   2                         
1155   2              }
1156   1                      
1157   1      // Í¨Ñ¶¹ýºó ÏµÍ³¸üÐÂ
1158   1          #if (TARIFF_MAX_NUM>1)
1159   1              if(((comm_data.di1_di0.u32 >= 0x04000801)&&(comm_data.di1_di0.u32 <= 0x04000807))
1160   1                      ||((comm_data.di1_di0.u32 >= 0x04010000)&&(comm_data.di1_di0.u32 <= 0x04010008)))
1161   1              {
1162   2              
1163   2                      api_update_triffNo_pre_minute();
1164   2              }
1165   1          #endif
1166   1      
1167   1      // ÓÐ¹¦×éºÏ·½Ê½×Ö¸üÐÂ´¦Àí//
1168   1              if((comm_data.di1_di0.u32 == 0x04000601))
1169   1              {
1170   2            mem_read(&gs_sys_globaL_var.fac_energy[0], ADR_METER_PARAM1_FAC_ENERGY, 2, MEM_E2P1);   
1171   2              }
1172   1      
1173   1              if((comm_data.di1_di0.u32 == 0x04000602))
1174   1              {
1175   2            mem_read(&gs_sys_globaL_var.Rac_energy[0], ADR_METER_PARAM1_REC_ENERGY, 2, MEM_E2P1);    
1176   2              }
1177   1      /////////////////ÉèÖÃÏÔÊ¾²ÎÊýºóÐèÒª¸üÐÂ///////
1178   1              if((comm_data.di1_di0.u32 == 0x04000302)||(comm_data.di1_di0.u32 == 0x04000303)||(comm_data.di1_di0.u32 =
             -= 0x04040100))
1179   1              {
1180   2                      mem_read(&gs_dis_param.auto_sec, ADR_BLOCK21_DIS_PARAM_E2P, LEN_BLOCK21_DIS_PARAM_E2P, MEM_E2P1);
1181   2              }
1182   1      //      CLRWDT();  //2019-04-11Ôö¼Ó¿´ÃÅ¹··ÀÖ¹¸´Î»       
1183   1          // Êý¾ÝÉèÖÃ³É¹¦ºóµÄ×éÖ¡²Ù×÷ //
1184   1      //      gs_uart_iec_app_var[g_ch_comm].tx_ready_10ms  += 4;
1185   1          api_deal_even_class_recode(ID_CLASS_I_PROG,START);   //Éú³É±à³ÌÊÂ¼þ¼ÇÂ¼ //
1186   1      //      IsProg = 1;
1187   1          gs_uart_iec_app_var[g_ch_comm].len= 1;
1188   1          Get_ACK_Answer(sptr);
1189   1      //      gs_uart_iec_app_var[g_ch_comm].delay_10ms = 0;   
1190   1          return(TRUE); 
1191   1      }
1192          
1193          
1194          //-------------------------------------------------------------------------------//
1195          //  Function:     INT8U IEC_Cmd_Break_Deal(INT8U* sptr,INT8U len)
1196          //  Description:   iec Í¨Ñ¶ÖÕÖ¹Ö¸Áî´¦Àí³ÌÐò
1197          //  Parameters:   
1198          //  Returns:        ÎÞ                          
1199          //  Others:         
1200          //-------------------------------------------------------------------------------//
1201          INT8U IEC_Cmd_Break_Deal(INT8U* sptr)
1202          {
1203   1      
1204   1             gs_uart_iec_app_var[g_ch_comm].iec_status |= COMM_BREAK_OK_IEC;
1205   1               gs_uart_iec_app_var[g_ch_comm].len= 1;
1206   1             Get_ACK_Answer(sptr);     
1207   1             return(TRUE);  
1208   1      }
1209          
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 23  

1210          /*****************************************************************************
1211          ** Function name    :api_init_md_data_ram
1212          **
1213          ** Description         :³õÊ¼»¯µ±Ç°ÐèÁ¿¼ÆËãRAMÇøÊý¾Ý£¬³ÌÐò¸´Î»³õÊ¼»¯µ÷ÓÃ        
1214          **
1215          ** Parameters         :NONE          
1216          **
1217          ** Returned value   :NONE
1218          **
1219          **----------------------------------------------------------------------------
1220          ** V01.01  MJ  2016-04-23
1221          ******************************************************************************/
1222          void lnk_tx_comm_ready( uint8 ch,uint8 start_index)
1223          {
1224   1          uint16 u16_badu;
1225   1          //comm_IEC_Tx_Ready();   
1226   1          switch(gs_uart_iec_app_var[ch].baud_rate)
1227   1          {
1228   2              case CBaud_3:
1229   2                  u16_badu =300;
1230   2              break;
1231   2              case CBaud_6:
1232   2                  u16_badu =600;
1233   2              break;
1234   2              case CBaud_12:
1235   2                  u16_badu =1200;
1236   2              break;
1237   2              case CBaud_24:
1238   2                  u16_badu =2400;
1239   2              break;
1240   2              case CBaud_48:
1241   2                  u16_badu =4800;
1242   2              break;
1243   2              case CBaud_96:
1244   2                  u16_badu =9600;
1245   2              break;
1246   2      
1247   2              default:
1248   2                  u16_badu =300;
1249   2              break;
1250   2          }
1251   1      
1252   1          P_IEC_BUFF = &gs_uart_drv_var[ch].buff[0] ;
1253   1         // Tx_UART_frist(&P_IEC_BUFF[0], (gs_uart_iec_app_var[ch].len+start_index),u16_badu,ch); // Êý¾Ý·¢ËÍ //
             -     
1254   1          Tx_UART_frist(&P_IEC_BUFF[start_index], (gs_uart_iec_app_var[ch].len),u16_badu,ch);        // Êý¾Ý·¢ËÍ
             - //     
1255   1      }
1256          
1257          
1258          /*****************************************************************************
1259          ** Function name    :api_init_md_data_ram
1260          **
1261          ** Description         :³õÊ¼»¯µ±Ç°ÐèÁ¿¼ÆËãRAMÇøÊý¾Ý£¬³ÌÐò¸´Î»³õÊ¼»¯µ÷ÓÃ        
1262          **
1263          ** Parameters         :NONE          
1264          **
1265          ** Returned value   :NONE
1266          **
1267          **----------------------------------------------------------------------------
1268          ** V01.01  MJ  2016-04-23
1269          ******************************************************************************/
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 24  

1270          void api_handl_COMM_FRAME_ERROR( uint8 ch)
1271          {
1272   1          if(ch==UART_CH0_IR)           
1273   1          {
1274   2              Lib_Clr_String(&gs_uart_iec_app_var[ch].len, sizeof(UART_COMM_APP_VAR));   
1275   2              Init_UART4_hard(BPS300);  //reset_uart(UART_RESET_ALL); 
1276   2              Init_UART_soft(ch); 
1277   2                          Lib_Set_String( &LPReadPara.Original_Ptr, 0, 5) ;           
*** WARNING C182 IN LINE 1277 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: pointer to different objects
1278   2          }
1279   1          
1280   1          if(ch==CH_RF)
1281   1          {
1282   2           Lib_Clr_String(&gs_uart_iec_app_var[ch].len, sizeof(UART_COMM_APP_VAR));   
1283   2           Init_UART_soft(ch); 
1284   2               SX127x_init();
1285   2           Rx_mode(); 
1286   2          }
1287   1          
1288   1          return;
1289   1      }
1290          
1291          //-------------------------------------------------------------------------------//
1292          //  Function:      void init_comm_link(INT8U mode)         
1293          //  Description:   ³õÊ¼»¯´®¿ÚÁ´Â·²ã±äÁ¿Êý¾Ý
1294          //  Parameters:   mode: Í¨Ñ¶Í¨µÀÐòºÅ  
1295          //  Returns:        ÎÞ                          
1296          //  Others:         
1297          //-------------------------------------------------------------------------------//
1298          void process_iec62056_21 (INT8U ch)
1299          {
1300   1       INT8U buff_size;
1301   1       INT8U start_index;
1302   1       INT8U meterID_len;
1303   1      
1304   1       INT8U tmp_8u_01[16];
1305   1       INT8U tmp_8u_02[32];
1306   1      // int i;
1307   1      // INT16U  u16_badu;
1308   1      
1309   1          
1310   1          if(ch > UART_CH_INDEX_MAX)  return ;
1311   1          
1312   1          if(gs_uart_iec_app_var[ch].tx_delay_flg ==TRUE ) 
1313   1          {
1314   2              return ;    //·¢ËÍµÈ´ý×´Ì¬Ê±ÍË³ö //
1315   2          }
1316   1      
1317   1          buff_size = Get_UART_rx_buff(&P_IEC_BUFF,ch);
1318   1          if(buff_size==0)   return;    // Ã¿¸öÑ­»·»ñÈ¡Ò»´Î½ÓÊÕÊý¾Ý³¤¶È£¬=0£¬ÍË³ö //
1319   1      
1320   1      /////////////////////////////////////////////////////////////////////////
1321   1          if((gs_uart_iec_app_var[ch].iec_status & COMM_INFO_OK_IEC) !=0)
1322   1          {
1323   2              CLRWDT();
1324   2              CLRWDT();
1325   2          }
1326   1      ////////////////////////////////////////////////////////////////////////
1327   1      
1328   1          // Ç°µ¼×Ö½Ú´¦Àí //
1329   1          for(start_index=0;start_index<5;start_index++)
1330   1          {
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 25  

1331   2              if((P_IEC_BUFF[start_index]=='/')||(P_IEC_BUFF[start_index]==ACKCOM)||(P_IEC_BUFF[start_index]==SO
             -H))  break;
1332   2          }
1333   1      
1334   1          if(start_index>3)
1335   1          {
1336   2              //½ÓÊÕµÄÊý¾ÝÖ¡´íÎó£¬²¹³ä´®¿Ú¸´Î»²Ù×÷      //
1337   2              api_handl_COMM_FRAME_ERROR(ch);
1338   2              return;
1339   2          }
1340   1      
1341   1          gs_uart_iec_app_var[ch].tx_delay_flg =FALSE;   // ÓÐÊý¾Ý½ÓÊÕÊ±Çå³ý·¢ËÍÑÓÊ±±êÊ¶ //
1342   1          gs_uart_iec_app_var[ch].delay_10ms = 0;   // ÓÐÊý¾Ý´¦ÀíÊ±Çå³ýÑÓÊ±¼ÆÊýÆ÷ //
1343   1          gs_uart_iec_app_var[ch].err_flg = 0;
1344   1          g_ch_comm = ch;
1345   1          
1346   1          if(((buff_size >2) &&((P_IEC_BUFF[buff_size-2]) == CR ||(P_IEC_BUFF[buff_size-2]) == ETX )) )
1347   1          {
1348   2              buff_size =buff_size-start_index;
1349   2              // Êý¾ÝÖ¡´¦Àí //
1350   2              switch(P_IEC_BUFF[start_index])
1351   2              {
1352   3                  case IEC_COMM_REQUEST:      
1353   3                      if((gs_uart_iec_app_var[ch].iec_status & COMM_INFO_OK_IEC) !=0)
1354   3                      {
1355   4                          api_handl_COMM_FRAME_ERROR(ch);
1356   4                          return;
1357   4                      }
1358   3                      mem_read (&tmp_8u_01[0],ADR_METER_PARAM1_METER_ID, 16,MEM_E2P1);
1359   3                      meterID_len = get_meter_id_asclen(&tmp_8u_01[0], 16);   //»ñÈ¡±íºÅÓÐÐ§asc³¤¶È
1360   3                      Lib_BCD_AscA(&tmp_8u_02[0], &tmp_8u_01[0], 16);
1361   3                      if(IEC_Comm_Request_Cmd_Judge(&P_IEC_BUFF[start_index], buff_size, &tmp_8u_02[0],meterID_l
             -en)==TRUE)
1362   3                      {
1363   4                          if(ch==UART_CH0_IR)   // TTL//
1364   4                         {
1365   5                               Get_IEC_Comm_Request_Cmd_Answer(&P_IEC_BUFF[start_index], Meter_INFO_LENTH,(uint8
             -*)&meter_info_IR[0]);//start_index
1366   5                          }
1367   4                           if(ch==CH_RF)  // RF//
1368   4                         {
1369   5                               Get_IEC_Comm_Request_Cmd_Answer(&P_IEC_BUFF[start_index], Meter_INFO_LENTH,(uint8
             -*)&meter_info[0]);
1370   5                          }           
1371   4                          gs_uart_iec_app_var[ch].len = Meter_INFO_LENTH+3;
1372   4                          gs_uart_iec_app_var[ch].iec_status |= COMM_INFO_OK_IEC;    // ÎÕÊÖÃüÁî³É¹¦±êÊ¶ //
1373   4                      }
1374   3                      else
1375   3                      {
1376   4                          //¿¼ÂÇµ½¿ª·ÅÊ½Í¨Ñ¶£¬Ê§°ÜÊ±²»·µ»ØÊý¾Ý //
1377   4                          api_handl_COMM_FRAME_ERROR(ch);
1378   4                          return;
1379   4                      }
1380   3                  break;
1381   3      
1382   3                  case IEC_COMM_ACKNOWLEDGEMENT:
1383   3                      if((gs_uart_iec_app_var[ch].iec_status & COMM_INFO_OK_IEC) ==0)
1384   3                      {
1385   4                          api_handl_COMM_FRAME_ERROR(ch);
1386   4                          return;
1387   4                      }
1388   3                      if(IEC_Comm_Acknowledgement_Cmd_Judge(&P_IEC_BUFF[start_index],buff_size)==TRUE)
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 26  

1389   3                      {
1390   4                          gs_uart_iec_app_var[ch].baud_rate = P_IEC_BUFF[start_index+2];      //                
             -                     //²¨ÌØÂÊ¸³Öµ  //
1391   4                          Get_IEC_Comm_Operand_Answer(&P_IEC_BUFF[start_index], MIMA_INFO_LENTH,(uint8*)&mima_in
             -fo[0]); //   // »ñÈ¡Êý¾Ý×éÖ¡ //
1392   4                          gs_uart_iec_app_var[ch].len = (MIMA_INFO_LENTH+6);
1393   4                          gs_uart_iec_app_var[ch].iec_status |= COMM_REQUIST_OK_IEC;  // ¸ø³öÇëÇóÃüÁî³É¹¦±êÊ¶ //
1394   4                      }
1395   3                      else
1396   3                      {
1397   4                          gs_uart_iec_app_var[ch].iec_status &= ~COMM_REQUIST_OK_IEC;  // clr ÇëÇóÃüÁî³É¹¦±êÊ¶ /
             -/
1398   4                          Get_Error_Answer(&P_IEC_BUFF[start_index]);//
1399   4                          gs_uart_iec_app_var[ch].len = 1;
1400   4                      }
1401   3      
1402   3                  break;
1403   3      
1404   3                  case IEC_COMM_COMMAND:
1405   3                      if((gs_uart_iec_app_var[ch].iec_status & COMM_REQUIST_OK_IEC) ==0)
1406   3                      {
1407   4                          api_handl_COMM_FRAME_ERROR(ch);
1408   4                          return;
1409   4                      } 
1410   3              //                      i = IEC_Comm_Command_Cmd_Judge(&P_IEC_BUFF[start_index],buff_size);             
1411   3                      if(IEC_Comm_Command_Cmd_Judge(&P_IEC_BUFF[start_index],buff_size) !=TRUE)//
1412   3                      {
1413   4                           // ÃüÁî³ö´í
1414   4                              // Êý¾Ý½âÎöÊ§°Ü //
1415   4                          Get_Error_Answer(&P_IEC_BUFF[start_index]);
1416   4                          gs_uart_iec_app_var[ch].len = 1;                       
1417   4                      }
1418   3                  break;
1419   3      
1420   3                  default:
1421   3                      gs_uart_iec_app_var[ch].err_flg |= FRAME_ERROR;   //Ö¡´íÎó£¬ÐèÒª¸´Î»  //        
1422   3                  break;
1423   3              }
1424   2      
1425   2          }
1426   1          else
1427   1          {
1428   2              gs_uart_iec_app_var[ch].err_flg |= FRAME_ERROR;   //Ö¡´íÎó£¬ÐèÒª¸´Î»  //        
1429   2          }
1430   1      
1431   1          if((gs_uart_iec_app_var[ch].err_flg & FRAME_ERROR) )
1432   1          {
1433   2              //½ÓÊÕµÄÊý¾ÝÖ¡´íÎó£¬²¹³ä´®¿Ú¸´Î»²Ù×÷      //
1434   2              api_handl_COMM_FRAME_ERROR(ch);
1435   2              return;
1436   2          }
1437   1          else
1438   1          {
1439   2              gs_uart_iec_app_var[ch].tx_delay_flg =TRUE;
1440   2              gs_uart_iec_app_var[ch].tx_ready_10ms = 0;   // ÓÐÊý¾Ý´¦ÀíÊ±Çå³ýÑÓÊ±¼ÆÊýÆ÷ //
1441   2              if(gs_uart_iec_app_var[ch].iec_status ==(COMM_INFO_OK_IEC+COMM_REQUIST_OK_IEC))
1442   2              {
1443   3                  gs_uart_iec_app_var[ch].tx_ready_10ms  += 4;   // ÇÐ»»²¨ÌØÂÊÊ±ÑÓÊ±Ôö¼Ó10ms //
1444   3              }
1445   2              gs_uart_iec_app_var[ch].start_index = start_index;
1446   2          }
1447   1      }
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 27  

1448          
1449          
1450          /*****************************************************************************
1451          ** Function name    :api_init_md_data_ram
1452          **
1453          ** Description         :³õÊ¼»¯µ±Ç°ÐèÁ¿¼ÆËãRAMÇøÊý¾Ý£¬³ÌÐò¸´Î»³õÊ¼»¯µ÷ÓÃ        
1454          **
1455          ** Parameters         :NONE          
1456          **
1457          ** Returned value   :NONE
1458          **
1459          **----------------------------------------------------------------------------
1460          ** V01.01  MJ  2016-04-23
1461          ******************************************************************************/
1462          void api_handl_COMM_pre_10ms(uint8 ch)
1463          {
1464   1      
1465   1              process_iec62056_21(ch);    
1466   1      
1467   1          if(gs_uart_iec_app_var[ch].delay_10ms >COMM_DELAY_3500MS)
1468   1          {   
1469   2              //³¬Ê±ÍË³öÎÕÊÖ£¬ÖØÐÂ½øÈë¿ÕÏÐµÈ´ý×´Ì¬ //
1470   2              api_handl_COMM_FRAME_ERROR(ch);    
1471   2          }
1472   1      
1473   1          if((gs_uart_iec_app_var[ch].tx_ready_10ms ==0)&&(gs_uart_iec_app_var[ch].tx_delay_flg ==TRUE))
1474   1          {   
1475   2              //Êý¾Ý×¼±¸·¢ËÍ   //
1476   2              gs_uart_iec_app_var[ch].tx_delay_flg =FALSE;
1477   2              lnk_tx_comm_ready(ch,gs_uart_iec_app_var[ch].start_index);     
1478   2          }
1479   1      
1480   1              if(clr_flag == 1)
1481   1              {
1482   2                      clr_flag = 0;
1483   2                      CLRWDT();
1484   2                      api_clr_current_energy_data();
1485   2                      CLRWDT();
1486   2                      api_clr_current_MD_data();
1487   2                      CLRWDT();
1488   2                      #if (BILL_MAX_NUM>0)
1489   2                      api_clr_bill_data();
1490   2                      #endif
1491   2                      gs_uart_iec_app_var[g_ch_comm].delay_10ms = 0; // 
1492   2                      LoadProRst();
1493   2                      CLRWDT();
1494   2                      api_clr_even_by_comm(); 
1495   2                      CLRWDT();
1496   2                      //2019-01-24  cxy
1497   2                      api_clr_freeze_energy();//Çå³ý¶³½áÊý¾Ý
1498   2                      CLRWDT();
1499   2                      api_chg_LCDDisplay_adj_item(DIS_DATA_CLR);   // Òº¾§ÏÔÊ¾ //
1500   2              }
1501   1                      
1502   1              if(IsClrEvent == 1)
1503   1              {
1504   2                      IsClrEvent = 0;
1505   2                      api_clr_even_by_comm();
1506   2              }
1507   1      //      if(IsProg == 1)
1508   1      //      {
1509   1      //              IsProg = 0;
C51 COMPILER V9.01   API_USER_COMM                                                         04/11/2019 19:00:08 PAGE 28  

1510   1      //              api_deal_even_class_recode(ID_CLASS_I_PROG,START);
1511   1      //      }
1512   1      
1513   1      }
1514          ///////////////////////////////////////////////////////////////////
1515          //  RF Í¨Ñ¶²¿·Ö
1516          ///////////////////////////////////////////////////////////////////
1517          //-------------------------------------------------------------------------------//
1518          //  Function:      void uart_comm_deal(void)    ´®¿ÚÍ¨Ñ¶´¦Àíº¯Êý        
1519          //  Description:   ÊµÏÖ´®¿Ú¹¦ÄÜµÄ¹ÜÀíºÍ²Ù×÷
1520          //  Parameters:   ÎÞ  
1521          //  Returns:        ÎÞ                          
1522          //  Others:         
1523          //-------------------------------------------------------------------------------//
1524          void RF_comm_deal(void)
1525          {  
1526   1          // RF Í¨µÀÊÇ·ñ½ÓÊÕµ½Êý¾Ý //
1527   1          if(LSD4RF_READ_DIO0() ==0) return;
1528   1          Lib_Delay_Nop(20);
1529   1          if(LSD4RF_READ_DIO0() ==0) return;   
1530   1          
1531   1          // ½ÓÊÕµ½Êý¾ÝºóµÄ´¦Àí //
1532   1              LSD_RF_RxPacket(&gs_uart_drv_var[CH_RF].buff[0]);
1533   1          CLRWDT();   // Çå¿´ÃÅ¹·//
1534   1          gs_uart_iec_app_var[CH_RF].delay_10ms = 0;   // ÓÐÊý¾Ý´¦ÀíÊ±Çå³ýÑÓÊ±¼ÆÊýÆ÷ //
1535   1          gs_uart_drv_var[CH_RF].rx_over_ticks =5;
1536   1              ////////////////////////
1537   1              gs_uart_drv_var[CH_RF].buff_index = G_LoRaConfig.PayloadLength;
1538   1           ///////////////////////////////
1539   1      }
1540          /***************************************************************
1541          *    END
1542          ****************************************************************/
1543          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   8251    ----
   CONSTANT SIZE    =   2035    ----
   XDATA SIZE       =     78     326
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  9 WARNING(S),  0 ERROR(S)
