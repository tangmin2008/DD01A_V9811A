C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE API_USER_COMM
OBJECT MODULE PLACED IN .\Api_User_Comm.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\C_Source\S4_ApiUser\Api_User_Comm.c LARGE BROWSE INCDIR(..\C_Source\S0_S
                    -ystem;..\C_Source\S1_HardDrv;..\C_Source\S2_MyLib;..\C_Source\S3_ApiPlat;..\C_Source\S4_ApiUser;..\C_Source\S5_ApiProtoc
                    -ol;..\C_Source\S6_MyIncludes;..\C_Source\S1_HardDrv\V9811A_EMU;..\C_Source\S1_HardDrv\V9811A_MCU;..\C_Source\S1_HardDrv\
                    -E2P_24CXXX) DEBUG OBJECTEXTEND PRINT(.\Api_User_Comm.lst) OBJECT(.\Api_User_Comm.obj)

line level    source

   1          /*
   2          *****************Copyright (c)*************************************
   3          **      Hangzhou Xili Watthour Meter Manufacture Co., Ltd. 
   4          **--------------file info--------------------------------------------
   5          **name                  : Api_User_Comm.c
   6          **Author                : maji
   7          **date                  : 2016-04-21 
   8          **description   : Í¨Ñ¶´¦ÀíÓ¦ÓÃ²ãÏà¹Øº¯Êý³ÌÐòCÎÄ¼þ
   9          **note                  : V9811A £¬MERTER FOR DL03C
  10          **--------------------Version History -------------------------------------
  11          ** NO. Date         Ver      By         Description 
  12          **==============================================================
  13          ** 1   2016-04-26   v01.00   sosomj     1. frist version                             
  14          **
  15          **==============================================================
  16          */
  17          
  18          
  19          
  20          #include <MyIncludes_H.h>
  21          
  22          
  23          /*******************************************************************************
  24          * È«¾Ö±äÁ¿¶¨ÒåÇø
  25          *******************************************************************************/
  26          uint8 *P_IEC_BUFF;    //Í¨Ñ¶»º³åÇøÖ¸Õë //
  27          uint8 g_ch_comm;   //µ±Ç°Í¨Ñ¶Í¨µÀºÅ //
  28          UART_COMM_APP_VAR  gs_uart_iec_app_var[UART_CH_NUM];
  29          COMM_DATA  comm_data;
  30          uint8 clr_flag = 0;
  31          uint8 IsClrEvent = 0;
  32          uint8 IsReset = 0;
  33          /*******************************************************************************
  34          * ³£Á¿±íÇøcode
  35          *******************************************************************************/
  36          const  INT8U Super_mima_iec[8] ={'4','5','6','1','2','3','0','0'};
  37          const  INT8U meter_info[Meter_INFO_LENTH] = {'X','L','E','3','D','D','S','3','1','1','-','7','V','4','.','
             -1',};        // ÒòÎªÔ¶ºìÍâ£¬À©Õ¹Îª2400bps//
  38          const  INT8U meter_info_IR[Meter_INFO_LENTH] = {'X','L','E','3','D','D','S','3','1','1','-','7','V','4','.
             -','1',};        // ÒòÎªÔ¶ºìÍâ£¬À©Õ¹Îª2400bps//
  39          const  INT8U mima_info[MIMA_INFO_LENTH] = {'(','1','1','1','1','1','1','1','1',')',};
  40          
  41          /*********************************************************************************************************
  42          **  Í¨Ñ¶ID±í¸ñ
  43          ********************************************************************************************************/
  44           code IEC_COMDISTAB    IEC_ComDisTab[] =
  45          {
  46                  // ÓÐ¹¦ºÏÏà·ÑÂÊ×Ü//
  47                  0x00010000, &gs_energy_user_data.us_val[EC_CH_AC_PT_TT][TARIFF_T].buf[0],       EN_R+P_RAM, 4,8,        //µ±Ç°×ÜµçÁ¿
  48          #if (BILL_MAX_NUM>0)
  49                  0x00010001, ADR_BLOCK101_BILL1_DATA_E2P+(OFFSET_bill_data_ec+TARIFF_T*LEN_EC_UNIT), EN_R+P_E2P1+CM_BILL ,
             -4,8,        //ÉÏ1ÔÂµçÁ¿
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 2   

  50                  0x00010002, ADR_BLOCK102_BILL2_DATA_E2P+(OFFSET_bill_data_ec+TARIFF_T*LEN_EC_UNIT), EN_R+P_E2P1+CM_BILL,4
             -,8,        //ÉÏ2ÔÂµçÁ¿
  51                  0x00010003, ADR_BLOCK103_BILL3_DATA_E2P+(OFFSET_bill_data_ec+TARIFF_T*LEN_EC_UNIT), EN_R+P_E2P1+CM_BILL,4
             -,8,        //ÉÏ3ÔÂµçÁ¿
  52                  0x00010004, ADR_BLOCK104_BILL4_DATA_E2P+(OFFSET_bill_data_ec+TARIFF_T*LEN_EC_UNIT), EN_R+P_E2P1+CM_BILL,4
             -,8,        //ÉÏ4ÔÂµçÁ¿
  53                  0x00010005, ADR_BLOCK105_BILL5_DATA_E2P+(OFFSET_bill_data_ec+TARIFF_T*LEN_EC_UNIT), EN_R+P_E2P1+CM_BILL,4
             -,8,        //ÉÏ5ÔÂµçÁ¿
  54                  0x00010006, ADR_BLOCK106_BILL6_DATA_E2P+(OFFSET_bill_data_ec+TARIFF_T*LEN_EC_UNIT), EN_R+P_E2P1+CM_BILL,4
             -,8,        //ÉÏ6ÔÂµçÁ¿
  55          #endif
  56          
  57          #if (TARIFF_MAX_NUM>0)//ÓÐ¹¦ËÄ·ÑÂÊ
  58                  0x00010100, &gs_energy_user_data.us_val[EC_CH_AC_PT_TT][TARIFF1].buf[0],        EN_R+P_RAM,     4,8,
  59                  0x00010200, &gs_energy_user_data.us_val[EC_CH_AC_PT_TT][TARIFF2].buf[0],        EN_R+P_RAM,     4,8,
  60                  0x00010300, &gs_energy_user_data.us_val[EC_CH_AC_PT_TT][TARIFF3].buf[0],        EN_R+P_RAM,     4,8,
  61                  0x00010400, &gs_energy_user_data.us_val[EC_CH_AC_PT_TT][TARIFF4].buf[0],        EN_R+P_RAM,     4,8,
  62          #endif  
  63                  //ÎÞ¹¦
  64                  0x00030000, &gs_energy_user_data.us_val[EC_CH_RE_PT_TT][TARIFF_T].buf[0],       EN_R+P_RAM,     4,8,  //×Ü
  65          #if (TARIFF_MAX_NUM>0)//ËÄ·ÑÂÊ
  66                  0x00030100, &gs_energy_user_data.us_val[EC_CH_RE_PT_TT][TARIFF1].buf[0],        EN_R+P_RAM,     4,8,
  67                  0x00030200, &gs_energy_user_data.us_val[EC_CH_RE_PT_TT][TARIFF2].buf[0],        EN_R+P_RAM,     4,8,
  68                  0x00030300, &gs_energy_user_data.us_val[EC_CH_RE_PT_TT][TARIFF3].buf[0],        EN_R+P_RAM,     4,8,
  69                  0x00030400, &gs_energy_user_data.us_val[EC_CH_RE_PT_TT][TARIFF4].buf[0],        EN_R+P_RAM,     4,8,
  70          #endif
  71          
  72                  //ÐèÁ¿ ×Ü
  73                  0x01010000, ADR_BLOCK01_MMD_L0_E2P+(TARIFF_T*LEN_MMD_UNIT), EN_R+P_E2P1,9,18,//µ±Ç°ÐèÁ¿ÀàÊý¾Ý 4+5 ÐèÁ¿+Ê±
             -¼ä
  74                  0x010100FF,     &sum_st_mmd_unit_array[0].buf[0],       EN_R+P_RAM,     5,10, //µ±Ç°ÀÛ¼Æ×î´óÐèÁ¿
  75          #if (BILL_MAX_NUM>0)
  76                  0x01010001, ADR_BLOCK101_BILL1_DATA_E2P+OFFSET_bill_data_mmd+(TARIFF_T*LEN_MMD_UNIT), EN_R+P_E2P1+CM_BILL
             -,9,18,//ÉÏ1ÔÂÐèÁ¿Àà
  77                  0x01010002, ADR_BLOCK102_BILL2_DATA_E2P+OFFSET_bill_data_mmd+(TARIFF_T*LEN_MMD_UNIT), EN_R+P_E2P1+CM_BILL
             -,9,18,//ÉÏ2ÔÂÐèÁ¿Àà
  78                  0x01010003, ADR_BLOCK103_BILL3_DATA_E2P+OFFSET_bill_data_mmd+(TARIFF_T*LEN_MMD_UNIT), EN_R+P_E2P1+CM_BILL
             -,9,18,//ÉÏ3ÔÂÐèÁ¿Àà
  79                  0x01010004, ADR_BLOCK104_BILL4_DATA_E2P+OFFSET_bill_data_mmd+(TARIFF_T*LEN_MMD_UNIT), EN_R+P_E2P1+CM_BILL
             -,9,18,//ÉÏ4ÔÂÐèÁ¿Àà
  80                  0x01010005, ADR_BLOCK105_BILL5_DATA_E2P+OFFSET_bill_data_mmd+(TARIFF_T*LEN_MMD_UNIT), EN_R+P_E2P1+CM_BILL
             -,9,18,//ÉÏ5ÔÂÐèÁ¿Àà
  81                  0x01010006, ADR_BLOCK106_BILL6_DATA_E2P+OFFSET_bill_data_mmd+(TARIFF_T*LEN_MMD_UNIT), EN_R+P_E2P1+CM_BILL
             -,9,18,//ÉÏ6ÔÂÐèÁ¿Àà
  82          #endif
  83                  //±äÁ¿Êý¾Ý      //
  84                  0x02010000,&gs_measure_var_data.gs_really[0].dw_u_val.B08[0],   EN_R+P_RAM, 2,4,        //ºÏÏàµçÑ¹ xxx.x                 YYY
  85                  0x02010100,&gs_measure_var_data.gs_really[0].dw_u_val.B08[0],   EN_R+P_RAM, 2,4,        //AÏàµçÑ¹ xxx.x          YYY
  86                  0x02020000,&gs_measure_var_data.gs_really[0].dw_i_val.B08[0],   EN_R+P_RAM, 3,6,        //ºÏÏàµçÁ÷       XXX.XXX
  87                  0x02020100,&gs_measure_var_data.gs_really[0].dw_i_val.B08[0],   EN_R+P_RAM, 3,6,        //AÏàµçÁ÷   XXX.XXX
  88                  0x02030000,&gs_measure_var_data.gs_really[0].dw_p_val.B08[0],     EN_R+P_RAM,   3,6,    // TOTAL ACTIVE POWER   XX
             -.XXXX 
  89                  0x02030100,&gs_measure_var_data.gs_really[0].dw_p_val.B08[0],     EN_R+P_RAM,   3,6,    // AÏà ACTIVE POWER   XX
             -.XXXX 
  90                  0x02030200,&gs_measure_var_data.dw_p_n_val.B08[0],                               EN_R+P_RAM,    3,6,    // BÏà ACTIVE POWER   XX.XXXX 
  91                  0x02060000,&gs_measure_var_data.gs_really[0].dw_pf_val.B08[0],   EN_R+P_RAM,2,4,        //ºÏÏà¹¦ÂÊÒòÊý  X.XXX
  92                  0x02060100,&gs_measure_var_data.gs_really[0].dw_pf_val.B08[0],   EN_R+P_RAM,2,4,        // AÏà¹¦ÂÊÒòÊý  X.XXX
  93                  0x02800001,&gs_measure_var_data.dw_i_n_val.B08[0],              EN_R+P_RAM, 3,6,        //NÏàµçÁ÷   XXX.XXX
  94                  0x02800002,&gs_measure_var_data.gs_really[0].w_freq_val.B08[0],    EN_R+P_RAM,2,4,      //ÆµÂÊ  XX.XX
  95          #if (TARIFF_MAX_NUM>1)
  96                  0x02900001,&gs_current_triff_var.triff_No,        EN_R+P_RAM,1,2,       //µ±Ç°·ÑÂÊ 1~4//
  97                  0x02900002,&gs_current_triff_var.dayTab_No,    EN_R+P_RAM,1,2,  //µ±Ç°ÈÕÊ±¶Î±í 1~4//
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 3   

  98                  0x02900003,&gs_current_triff_var.weekTab_No,    EN_R+P_RAM,1,2, //µ±Ç°ÖÜ±í 1~4//
  99                  0x02900004,&gs_current_triff_var.seasonTab_No,    EN_R+P_RAM,1,2,       //µ±Ç°¼¾½Ú±í 1~4//
 100          #endif
 101          
 102                  //±í¼ÆÐÅÏ¢///
 103                  0x04000100,&gs_CurDateTime.Week,                                EN_RW+P_RAM,7,14,       //×¢ÒâÈÕÆÚ£¬Í¨Ñ¶¶ÁÐ´Ë³Ðò YYMMDDWWhhmmss
 104                  0x04000103,ADR_METER_PARAM1_MD,                            EN_RW+P_E2P1,        2,      4,      //×î´óÐèÁ¿ÖÜÆÚ,»¬²îÊ±¼ä//
 105                  0x04000401,ADR_METER_PARAM1_METER_ID,           EN_RW+P_E2P1,16,32, //Í¨Ñ¶µØÖ· ±íºÅ
 106                  0x04000402,ADR_METER_PARAM1_RF_COMM_ID,         EN_RW+P_E2P1,6,12, //RFÍ¨Ñ¶µØÖ· yang 2017-12-21
 107                  0x04000409,&sys_parm.meter_cons[0],                     EN_R+P_RAM,3,6,         //³£Êý   //     
 108          #if (TARIFF_MAX_NUM>1)//2019-01-07 ÐÂÔöÐÞ¸Ä·ÑÂÊÏà¹ØÃüÁîcxy
 109                  0x04000801,ADR_BLOCK83_WEEK_TAB_E2P     ,                       EN_RW+P_E2P1,LEN_WEEK_TABLE_ONE,(2*LEN_WEEK_TABLE_ONE), //ÖÜ±íÆðÊ
             -¼µØÖ·(4¸öÖÜ±í)        
 110                  0x04000802,ADR_BLOCK83_WEEK_TAB_E2P+(1*LEN_WEEK_TABLE_ONE),             EN_RW+P_E2P1,LEN_WEEK_TABLE_ONE,(2*LEN_WEEK_
             -TABLE_ONE),        //ÖÜ±íÆðÊ¼µØÖ·(4¸öÖÜ±í)
 111                  0x04000803,ADR_BLOCK83_WEEK_TAB_E2P+(2*LEN_WEEK_TABLE_ONE),             EN_RW+P_E2P1,LEN_WEEK_TABLE_ONE,(2*LEN_WEEK_
             -TABLE_ONE),        //ÖÜ±íÆðÊ¼µØÖ·(4¸öÖÜ±í)
 112                  0x04000804,ADR_BLOCK83_WEEK_TAB_E2P+(3*LEN_WEEK_TABLE_ONE),             EN_RW+P_E2P1,LEN_WEEK_TABLE_ONE,(2*LEN_WEEK_
             -TABLE_ONE),        //ÖÜ±íÆðÊ¼µØÖ·(4¸öÖÜ±í) 
 113          
 114                  0x04010000,ADR_BLOCK82_SEASON_TAB_E2P,               EN_RW+P_E2P1,LEN_SEASON_TABLE, (2*LEN_SEASON_TABLE), 
             -   // ¼¾½Ú±í 8*3  ÔÂÈÕ+ÖÜ±íºÅ
 115                  0x04010001,ADR_BLOCK84_DAY_TAB_E2P,                             EN_RW+P_E2P1,LEN_DAY_TABLE_ONE, (2*LEN_DAY_TABLE_ONE),//Ê±¶Î±í1  Ê
             -±¶Î±íÆðÊ¼µØÖ·(8¸öÊ±¶Î±í£¬10¸öÊ±¶ÎÊý)  288      BCD  hhnnNN          
 116                  0x04010002,ADR_BLOCK84_DAY_TAB_E2P+(1*LEN_DAY_TABLE_ONE),               EN_RW+P_E2P1,LEN_DAY_TABLE_ONE, (2*LEN_DAY_TAB
             -LE_ONE),//Ê±¶Î±í2  Ê±¶Î±íÆðÊ¼µØÖ·(8¸öÊ±¶Î±í£¬10¸öÊ±¶ÎÊý)  288      BCD  hhnnNN          
 117                  0x04010003,ADR_BLOCK84_DAY_TAB_E2P+(2*LEN_DAY_TABLE_ONE),               EN_RW+P_E2P1,LEN_DAY_TABLE_ONE, (2*LEN_DAY_TAB
             -LE_ONE),//Ê±¶Î±í3  Ê±¶Î±íÆðÊ¼µØÖ·(8¸öÊ±¶Î±í£¬10¸öÊ±¶ÎÊý)  288      BCD  hhnnNN          
 118                  0x04010004,ADR_BLOCK84_DAY_TAB_E2P+(3*LEN_DAY_TABLE_ONE),               EN_RW+P_E2P1,LEN_DAY_TABLE_ONE, (2*LEN_DAY_TAB
             -LE_ONE),//Ê±¶Î±í4  Ê±¶Î±íÆðÊ¼µØÖ·(8¸öÊ±¶Î±í£¬10¸öÊ±¶ÎÊý)  288      BCD  hhnnNN
 119          #endif
 120          
 121                  0x04000B01,ADR_METER_PARAM1_SETL_DDHH,                  EN_RW+P_E2P1,2,4,       //½áËãÈÕ
 122                  0x04000B02,ADR_BLOCK20_METER_PARAM1_E2P+ST_MB_OFFSET(E2P_METER_PARAM1_MAP,BILL_FLAG), EN_RW+P_E2P1,1,2,  
             -//½áËã·½Ê½
 123                  0x04000C01,ADR_METER_PARAM1_PW0,                                        EN_W+P_E2P1,4,8,        //TTL 2¼¶ÃÜÂë
 124                  0x04000C02,ADR_METER_PARAM1_RF_PW0,                                     EN_W+P_E2P1,4,8,        //RF 2¼¶ÃÜÂë
 125                  0x04800003,ADR_METER_PARAM1_RELAY_CMD,                     EN_RW+P_E2P1,        2,      4,//¼ÌµçÆ÷ÃüÁî¼°×´Ì¬×Ö//
 126              0x04000A01,  ADR_METER_PARAM1_load_lptime_inv_var,          EN_RW+P_E2P1,2,4,//¼ÇÂ¼¼ä¸ô
 127              0x04000AA1,  ADR_METER_PARAM1_load_egcode_var,            EN_RW+P_E2P1,10,20, //¸ººÉ±í±àÂë
 128              0x06010000,  &LPRunPa.Num[0],                                   EN_R+P_RAM,2,4, //ÒÑ¼ÇÂ¼ÌõÊý
 129                                  //ÏÔÊ¾Àà²ÎÊý//
 130                  0x04000302,ADR_DIS_PARAM_AUTO_SEC,                      EN_RW+P_E2P1,1,2,        //×Ô¶¯Ñ­ÏÔÊ±¼ä 
 131                  0x04000303,ADR_DIS_PARAM_EC_FORM,                EN_RW+P_E2P1,1,2,        // µçÁ¿ÏÔÊ¾Î»Êý//
 132                  0x04040100,ADR_DIS_PARAM_AUTO_TAB,               EN_RW+P_E2P1,(DIS_MAX_ITEM+1),(2*(DIS_MAX_ITEM+1)), //×Ô¶¯Ñ­ÏÔ±í//
 133                  0x04800001,&sys_parm.video[0],                  EN_R+P_RAM,12,12,  //Èí¼þ°æ±¾ºÅ(ASCII)
 134          
 135          
 136                  // ¹¤³§À©Õ¹ÀàÃüÁî//
 137                  0x80805001, 0x0000,                                     EN_R+P_E2P1,12,24,  // À©Õ¹ÃüÁî µçÁ¿+¼ÌµçÆ÷×´Ì¬+ÈÕÆÚÊ±¼ä yang 2017-12-22// 
 138                  0x08020100,0x0000,                                              EN_W+P_RAM,1,2,                    //ÐèÁ¿ÇåÁã/ÊÖ¶¯¸´Î»//
 139                  0x08020200,0x0000,                                              EN_W+P_RAM,1,2,                    //=FF ÊÂ¼þ¼ÇÂ¼ÇåÁã  // Çå¿ª¸Ç
 140                  0x08020300,0x0000,                                              EN_W+P_RAM,1,2,                    //=00 ¸ººÉ¼ÇÂ¼ÇåÁã  //
 141                  0x08020400,0x0000,                                              EN_W+P_RAM,4,8,                   //xxxxxxxx = 00000000Ê±Çå³ýµ±Ç°ºÍÀúÊ·µçÁ¿ÐèÁ¿Êý¾Ý//
 142                  0x08020500,ADR_METER_PARAM1_FC_CFG,     EN_RW+P_E2P1,4,8,                 //¹¤³§³ö³§×´Ì¬×Ö£¬4×Ö½Ú  // 5A:³§ÄÚ   //
 143                  0x04000107,ADR_METER_PARAM1_BAT_LEVEL,  EN_RW+P_E2P1,   2,      4,      // µç³ØµÍÑ¹·§Öµ  1 ×Ö½Ú£¬BCD  X.X 
 144                  //Õû»ú³õÊ¼»¯ //
 145                  0x0000FEFF,0x0000,                                                      EN_W+P_RAM,2,4,         // ³õÊ¼»¯
 146                  0xEE000109,ADR_BLOCK70_EMU_PARAM_E2P,                   EN_RW+P_E2P1+W_FCT,32,64,//!Ð£±í²ÎÊýÇø(U,I1,I2,P1,P2,Fre)
 147                  0xEE000118,ADR_METER_PARAM1_EEPROM_Flag,        EN_RW+P_E2P1+W_FCT,3,6,//EEPROMÊ×´ÎÉÏµç±êÖ¾Î» Ê×´ÎÉÏµç ¸Ã±êÖ¾Î»²
             -»µÈÓÚ0x653412£¬ÆäËû¾ùÎªÊ×´ÎÉÏµç///
 148                  //ÊÂ¼þ¼ÇÂ¼ID À­Õ¢//
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 4   

 149                  
 150                  // Ò»ÀàÊÂ¼þ  //
 151                  //ÐèÁ¿¸´Î»   //
 152                  0x03500000, ADR_BLOCK151_EVENI_resetMD_E2P,                         EN_R+P_E2P1, 2,4,   //×Ü´ÎÊý
 153                  0x03500101, ADR_BLOCK151_EVENI_resetMD_E2P+2,               EN_R+P_E2P1, 6,12, //×î½üÒ»´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±
             -¼ä ½áÊøÊ±¼ä
 154                  0x03500102, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 1*6),    EN_R+P_E2P1, 6,12,//×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 155                  0x03500103, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 2*6),    EN_R+P_E2P1, 6,12,//×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 156                  0x03500104, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 3*6),    EN_R+P_E2P1, 6,12,//×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 157                  0x03500105, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 4*6),    EN_R+P_E2P1, 6,12,//×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 158                  0x03500106, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 5*6),    EN_R+P_E2P1, 6,12,//×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 159                  0x03500107, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 6*6),    EN_R+P_E2P1, 6,12,//×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 160                  0x03500108, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 7*6),    EN_R+P_E2P1, 6,12,//×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 161                  0x03500109, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 8*6),    EN_R+P_E2P1, 6,12,//×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 162                  0x0350010A, (ADR_BLOCK151_EVENI_resetMD_E2P+2+ 9*6),    EN_R+P_E2P1, 6,12,//×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 163          
 164          //      0x0350FFFF, ADR_BLOCK151_EVENI_resetMD_E2P+2,                   EN_R+P_E2P1, 60,120,//×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê
             -±¼ä ½áÊøÊ±¼ä
 165          
 166                  //ÃÜÂëÈÏÖ¤´íÎó
 167                  0x03560000,  ADR_BLOCK153_EVENI_MMERR_E2P,                  EN_R+P_E2P1,        2,4,    //×Ü´ÎÊý
 168                  0x03560101,  ADR_BLOCK153_EVENI_MMERR_E2P+2,            EN_R+P_E2P1, 6,12,               //×î½üÒ»´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±¼ä
             - ½áÊøÊ±¼ä
 169                  0x03560102,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 1*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 170                  0x03560103,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 2*6),     EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 171                  0x03560104,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 3*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 172                  0x03560105,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 4*6),     EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 173                  0x03560106,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 5*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 174                  0x03560107,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 6*6),     EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 175                  0x03560108,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 7*6),     EN_R+P_E2P1 , 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 176                  0x03560109,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 8*6),     EN_R+P_E2P1 , 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 177                  0x0356010A,  (ADR_BLOCK153_EVENI_MMERR_E2P+2+ 9*6),     EN_R+P_E2P1 , 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 178          
 179          //      0x0356FFFF,  ADR_BLOCK153_EVENI_MMERR_E2P+2,            EN_R+P_E2P1 , 60,120, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ¼
             -Ê±¼ä ½áÊøÊ±¼ä
 180          
 181                  //Ê±ÖÓÐ£×¼
 182                  0x03570000,  ADR_BLOCK152_EVENI_setRtc_E2P,                         EN_R+P_E2P1,        2,4,    //×Ü´ÎÊý
 183                  0x03570101,  ADR_BLOCK152_EVENI_setRtc_E2P+2,               EN_R+P_E2P1, 6,12,           //×î½üÒ»´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë 
             -¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 184                  0x03570102,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 1*6),    EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 185                  0x03570103,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 2*6),    EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 5   

 186                  0x03570104,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 3*6),    EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 187                  0x03570105,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 4*6),    EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 188                  0x03570106,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 5*6),    EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 189                  0x03570107,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 6*6),    EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 190                  0x03570108,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 7*6),    EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 191                  0x03570109,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 8*6),    EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 192                  0x0357010A,  (ADR_BLOCK152_EVENI_setRtc_E2P+2+ 9*6),    EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ª
             -Ê¼Ê±¼ä ½áÊøÊ±¼ä
 193          
 194          //      0x0357FFFF,  ADR_BLOCK152_EVENI_setRtc_E2P+2,                   EN_R+P_E2P1, 60,120,             //×î½üÒ»´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂ
             -ë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 195          
 196                  //E2P´íÎó
 197                  0x03580000,  ADR_BLOCK156_EVENII_EERR_E2P,                  EN_R+P_E2P1,        2,4,    //×Ü´ÎÊý
 198                  0x03580101,  ADR_BLOCK156_EVENII_EERR_E2P+2,            EN_R+P_E2P1, 6,12,               //×î½üÒ»´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±¼
             -ä ½áÊøÊ±¼ä
 199                  0x03580102,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 1*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 200                  0x03580103,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 2*6),     EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 201                  0x03580104,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 3*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 202                  0x03580105,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 4*6),     EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 203                  0x03580106,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 5*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 204                  0x03580107,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 6*6),     EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 205                  0x03580108,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 7*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 206                  0x03580109,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 8*6),     EN_R+P_E2P1, 6,12, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 207                  0x0358010A,  (ADR_BLOCK156_EVENII_EERR_E2P+2+ 9*6),     EN_R+P_E2P1, 6,12, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë  ¿ªÊ
             -¼Ê±¼ä ½áÊøÊ±¼ä
 208          
 209          //      0x0358FFFF,   ADR_BLOCK156_EVENII_EERR_E2P+2,                   EN_R+P_E2P1, 60,120,             //×î½üÒ»´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´úÂ
             -ë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 210          
 211          //  ¶þÀàÊÂ¼þ    //
 212                  //µç³ØÇ·Ñ¹ ÌØÊâ´¦Àí  Ö»³­¶Á·¢ÉúÊ±¼ä//   
 213                  0x03590000,   ADR_BLOCK162_EVENII_lowbattery_E2P,            EN_R+P_E2P1, 2,4,  //×Ü´ÎÊý
 214                  0x03590001,   ADR_BLOCK162_EVENII_lowbattery_E2P+2,          EN_R+P_E2P1, 4,8,  //ÀÛ¼ÆÊ±¼ä
 215                  0x03590101,   ADR_BLOCK162_EVENII_lowbattery_E2P+6,                  EN_R+P_E2P1+CM_EBIL, 12,24,         //×î½üÒ»´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 216                  0x03590102,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 1*6),        EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 217                  0x03590103,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 2*6),        EN_R+P_E2P1+CM_EBIL, 12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 218                  0x03590104,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 3*6),        EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 219                  0x03590105,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 4*6),        EN_R+P_E2P1+CM_EBIL, 12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 220                  0x03590106,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 5*6),        EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 221                  0x03590107,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 6*6),        EN_R+P_E2P1+CM_EBIL, 12,24,//×î½üÈý´Îµµ°¸¼ÇÂ¼ 
             - ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 6   

 222                  0x03590108,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 7*6),        EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 223                  0x03590109,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 8*6),        EN_R+P_E2P1+CM_EBIL, 12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 224                  0x0359010A,  (ADR_BLOCK162_EVENII_lowbattery_E2P+6+ 9*6),        EN_R+P_E2P1+CM_EBIL, 12,24,//×î½ü¶þ´Îµµ°¸¼ÇÂ¼ 
             - ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 225          
 226          //      0x0359FFFF,  ADR_BLOCK162_EVENII_lowbattery_E2P+6,               EN_R+P_E2P1, 60,120,//¿ªÊ¼¼ÇÂ¼  6*10´Î
 227                  
 228                  // µçÔ´µôµç  // 
 229                  0x03380000,  ADR_BLOCK161_EVENII_PWN_E2P,                      EN_R+P_E2P1,     2,4,    //×Ü´ÎÊý
 230                  0x03380001,  ADR_BLOCK161_EVENII_PWN_E2P+2,                  EN_R+P_E2P1,       4,8,    //ÀÛ¼ÆÊ±¼ä
 231                  0x03380101,  ADR_BLOCK161_EVENII_PWN_E2P+6,                     EN_R+P_E2P1+CM_EBIL, 12,24,              //×î½üÒ»´Îµµ°¸¼ÇÂ¼  Ê
             -Â¼þ´úÂë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 232                  0x03380102,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 1*6),       EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ
             -´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 233                  0x03380103,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 2*6),       EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ
             -´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 234                  0x03380104,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 3*6),       EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ
             -´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 235                  0x03380105,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 4*6),        EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 236                  0x03380106,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 5*6),        EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 237                  0x03380107,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 6*6),       EN_R+P_E2P1+CM_EBIL, 12,24, //×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼þ´
             -úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 238                  0x03380108,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 7*6),        EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 239                  0x03380109,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 8*6),        EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 240                  0x0338010A,  (ADR_BLOCK161_EVENII_PWN_E2P+6+ 9*6),        EN_R+P_E2P1+CM_EBIL, 12,24, ///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 241          
 242          //      0x0338FFFF,   ADR_BLOCK161_EVENII_PWN_E2P+6,                   EN_R+P_E2P1+CM_GETHER_EBIL, 120,240,              //×î½üÒ»´Îµ
             -µ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 243          
 244                  //COVER_//      
 245                  0x03450000,  ADR_BLOCK163_EVENII_COVER_E2P,           EN_R+P_E2P1,      2,4,    //×Ü´ÎÊý
 246                  0x03450001,  ADR_BLOCK163_EVENII_COVER_E2P+2,         EN_R+P_E2P1,      4,8,    //×Ü´ÎÊý
 247                  0x03450101,  ADR_BLOCK163_EVENII_COVER_E2P+6,                 EN_R+P_E2P1+CM_EBIL, 12,24,                //×î½üÒ»´Îµµ°¸¼ÇÂ¼  ÊÂ
             -¼þ´úÂë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 248                  0x03450102,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 1*6),     EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 249                  0x03450103,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 2*6),     EN_R+P_E2P1+CM_EBIL, 12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 250                  0x03450104,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 3*6),     EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 251                  0x03450105,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 4*6),  EN_R+P_E2P1+CM_EBIL, 12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 252                  0x03450106,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 5*6),     EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 253                  0x03450107,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 6*6),  EN_R+P_E2P1+CM_EBIL, 12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 254                  0x03450108,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 7*6),     EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 255                  0x03450109,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 8*6),     EN_R+P_E2P1+CM_EBIL, 12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 256                  0x0345010A,  (ADR_BLOCK163_EVENII_COVER_E2P+6+ 9*6),     EN_R+P_E2P1+CM_EBIL, 12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  ÊÂ¼
             -þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 257          
 258          //      0x0341FFFF,  ADR_BLOCK163_EVENII_NOL1_E2P+6,                   EN_R+P_E2P1+CM_GETHER_EBIL, 120,240,              //×î½üÒ»´Îµ
             -µ°¸¼ÇÂ¼  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 7   

 259                  //L2 ¶ÏÏà //
 260          //      0x03420000,  ADR_BLOCK164_EVENII_NOL2_E2P,                      EN_R+P_E2P1,    2,4,    //×Ü´ÎÊý
 261          //      0x03420001, ( ADR_BLOCK164_EVENII_NOL2_E2P+2),               EN_R+P_E2P1,       4,8,    //×ÜÀÛ¼ÆÊ±¼ä//
 262          ////    0x03420101,  ADR_BLOCK164_EVENII_NOL2_E2P+6,                     EN_R+P_E2P1+CM_EBIL,   12,24,//×î½üÒ»´Îµµ°¸¼ÇÂ¼
             -  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 263          //      0x03420102,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 1*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 264          //      0x03420103,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 2*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 265          //      0x03420104,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 3*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 266          //      0x03420105,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 4*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 267          //      0x03420106,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 5*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 268          //      0x03420107,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 6*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 269          //      0x03420108,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 7*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 270          //      0x03420109,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 8*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½üÈý´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 271          //      0x0342010A,  (ADR_BLOCK164_EVENII_NOL2_E2P+6+ 9*6),       EN_R+P_E2P1+CM_EBIL,  12,24,///×î½ü¶þ´Îµµ°¸¼ÇÂ¼  
             -ÊÂ¼þ´úÂë  ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 272          
 273          //      0x0342FFFF,  ADR_BLOCK164_EVENII_NOL2_E2P+6,               EN_R+P_E2P1+CM_GETHER_EBIL,  120,240,//×î½üÒ»´Îµµ°¸¼ÇÂ
             -¼  ÊÂ¼þ´úÂë ¿ªÊ¼Ê±¼ä ½áÊøÊ±¼ä
 274                  // ¹¦ÂÊ·´ÏòÊÂ¼þ  //     
 275                  0x03360000,  ADR_BLOCK164_EVENII_L1reverse_E2P,                       EN_R+P_E2P1,      2,4,    //×Ü´ÎÊý
 276                  0x03360001, ( ADR_BLOCK164_EVENII_L1reverse_E2P+2),                EN_R+P_E2P1,         4,8,    //×ÜÀÛ¼ÆÊ±¼ä//
 277                  0x03360101,  (ADR_BLOCK164_EVENII_L1reverse_E2P+6),                EN_R+P_E2P1+CM_EBIL,         12,24,  //¿ªÊ¼Ê±¼
             -ä+½áÊøÊ±¼ä//
 278                  0x03360102, ( ADR_BLOCK164_EVENII_L1reverse_E2P+6+1*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 279                  0x03360103,  (ADR_BLOCK164_EVENII_L1reverse_E2P+6+2*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 280                  0x03360104, ( ADR_BLOCK164_EVENII_L1reverse_E2P+6+3*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 281                  0x03360105, ( ADR_BLOCK164_EVENII_L1reverse_E2P+6+4*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 282                  0x03360106, ( ADR_BLOCK164_EVENII_L1reverse_E2P+6+5*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 283                  0x03360107,  (ADR_BLOCK164_EVENII_L1reverse_E2P+6+6*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 284                  0x03360108, ( ADR_BLOCK164_EVENII_L1reverse_E2P+6+7*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 285                  0x03360109, ( ADR_BLOCK164_EVENII_L1reverse_E2P+6+8*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 286                  0x0336010A,  (ADR_BLOCK164_EVENII_L1reverse_E2P+6+9*6),         EN_R+P_E2P1+CM_EBIL,    12,24,  //¿ªÊ¼Ê±¼ä+½
             -áÊøÊ±¼ä//
 287          
 288          //      0x0336FFFF,  (ADR_BLOCK165_EVENII_L1reverse_E2P+6),                EN_R+P_E2P1+CM_GETHER_EBIL,  120,240
             -,        //¿ªÊ¼Ê±¼ä+½áÊøÊ±¼ä//
 289          
 290                  // ÉÏÒ»´Î½áËãÊ±¼ä
 291                  0x03700101 ,   ADR_BLOCK101_BILL1_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12,  // ÄêÔÂÈÕÊ±·ÖÃë
 292                  0x03700102 ,   ADR_BLOCK102_BILL2_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 293                  0x03700103 ,   ADR_BLOCK103_BILL3_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 294                  0x03700104 ,   ADR_BLOCK104_BILL4_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 295                  0x03700105 ,   ADR_BLOCK105_BILL5_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 296                  0x03700106 ,   ADR_BLOCK106_BILL6_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë 
 297          //      0x03700107 ,   ADR_BLOCK107_BILL7_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 298          //      0x03700108 ,   ADR_BLOCK108_BILL8_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 8   

 299          //      0x03700109 ,   ADR_BLOCK109_BILL9_DATA_E2P ,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 300          //      0x0370010A ,   ADR_BLOCK110_BILL10_DATA_E2P ,     EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 301          //      0x0370010B ,   ADR_BLOCK111_BILL11_DATA_E2P,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë 
 302          //      0x0370010C ,   ADR_BLOCK112_BILL12_DATA_E2P,      EN_R+P_E2P1+CM_BILL, 6,12, // ÄêÔÂÈÕÊ±·ÖÃë
 303          
 304          //ÈÕ¶³½á
 305                  0x0506FF01,    0x0000,    EN_R+P_E2P1, 18,36,
 306                  0x0506FF02,    0x0000,    EN_R+P_E2P1, 18,36,
 307                  0x0506FF03,    0x0000,    EN_R+P_E2P1, 18,36,
 308                  0x0506FF04,    0x0000,    EN_R+P_E2P1, 18,36,
 309          
 310                  //Í¨Ñ¶ÅúÁ¿Ð£±í 6 //
 311                  0x0000FEBB,0x0000,                                              EN_W+P_E2P1+W_FCT,2,4,//ÅäÖÃEMU ±¶Æµ //
 312                  0x80800803, 0x0000,                                     EN_W+P_E2P1+W_FCT,2,4,  // EMU¼ÆÁ¿²ÎÊý³õÊ¼»¯ £¬ÓÃÄ¬ÈÏ²ÎÊý¸³Öµ // 
 313                  0x0000FEB0, 0x0000,                                     EN_W+P_E2P1+W_FCT,12,24,   //Ö÷»ØÂ· 1.0L IB Îó²îºÍÓÐÐ§ÖµÐ£×¼// 
 314                  0x0000FEB1, 0x0000,                                     EN_W+P_E2P1+W_FCT,12,24,   //Ö÷»ØÂ· 0.5L IB Îó²îÐ£×¼// 
 315                  0x0000FEB2, 0x0000,                                     EN_W+P_E2P1+W_FCT,12,24,   //´Î»ØÂ·1.0L IB Îó²îÐ£×¼// 
 316                  0x0000FEB3, 0x0000,                                     EN_W+P_E2P1+W_FCT,12,24,   //´Î»ØÂ·0.5L IB Îó²îÐ£×¼// 
 317                  0x0000FEB4, 0x0000,                                     EN_W+P_E2P1+W_FCT,12,24,  //´Î»ØÂ·0.5L IB Îó²îÐ£×¼// 
 318                  0x0000FEB5, 0x0000,                                     EN_W+P_E2P1+W_FCT,12,24,  //´Î»ØÂ·1.0L 5%IB Îó²îÐ£×¼// 
 319          };
 320          //---------------------------------------------------------------------//
 321          //¹¦ÄÜ:   ¼ÆËãÓÉÆðÊ¼µØÖ·¿ªÊ¼µ½F½ØÖ¹µÄ³¤¶È//
 322          //     0000F     return 4
 323          //      *Addr Êý¾ÝÆðÊ¼µØÖ·£¬numÊý¾Ý³¤¶È
 324          //---------------------------------------------------------------------//
 325          INT8U get_meter_id_asclen(INT8U *Addr,INT8U numbyte)
 326          {
 327   1              INT8U i;
 328   1              INT8U asclen=0;
 329   1              for(i=0;i<numbyte;i++)
 330   1              {
 331   2                      if((((*(Addr+i))>>4)&0x0F)==0x0F)
 332   2                      {
 333   3                              return asclen;
 334   3                      }
 335   2                      asclen++;
 336   2                      if(((*(Addr+i))&0x0F)==0x0F)
 337   2                      {
 338   3                              return asclen;
 339   3                      }
 340   2                      asclen++;
 341   2              }
 342   1              return asclen;
 343   1      }
 344          
 345          
 346          /*****************************************************************
 347           name:          INT8U  get_comm_var( INT16U id )
 348           function:      get command information precess  
 349           input:         no            
 350           return:        GetComVar()
 351                          =0    succeed  precess 
 352                          =1    fail precess 
 353          *****************************************************************/
 354          INT8U  get_IEC_comm_var( INT32U id )
 355          {
 356   1              INT16U i;  
 357   1          //²»ÔÚ±í¸ñÄÚÊý¾Ý ¸ººÉÊý¾Ý//
 358   1          if((id>=0x06010001)&&(id<=0x060105A0))//¸ººÉÊý¾Ý×î¶à¼ÇÂ¼900Ìõ   //SXL 2019-01-6
 359   1          {
 360   2                      comm_data.addr =0;
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 9   

 361   2                      comm_data.Info.u16 = EN_R;              //²»ÄÜ»òÉÏ
 362   2                      comm_data.len = 0;
 363   2                      comm_data.len_asc = 0;
 364   2                      return TRUE;
 365   2          }
 366   1                       if((id>=0x060A0001)&&(id<=0x060A0120))//¸ººÉÊý¾Ý¿é×î¶à¼ÇÂ¼90Ìõ   //SXL 2019-01-6
 367   1          {
 368   2                      comm_data.addr =0;
 369   2                      comm_data.Info.u16 = EN_R;              //²»ÄÜ»òÉÏ
 370   2                      comm_data.len = 0;
 371   2                      comm_data.len_asc = 0;
 372   2                      return TRUE;
 373   2          }
 374   1         for( i = 0 ; i <dim(IEC_ComDisTab) ; i++ )
 375   1              {
 376   2                  if( id == IEC_ComDisTab[i].ComID )
 377   2                  {
 378   3                      comm_data.addr = IEC_ComDisTab[i].Addr;
 379   3                      comm_data.Info.u16 = IEC_ComDisTab[i].ComInfo;
 380   3                      comm_data.len = IEC_ComDisTab[i].Len;
 381   3                      comm_data.len_asc = IEC_ComDisTab[i].Len_Asc;
 382   3                      return TRUE;
 383   3                  }
 384   2              }
 385   1              return FALSE;   
 386   1      
 387   1              
 388   1      
 389   1      /*   INT16U i;  
 390   1      
 391   1          //²»ÔÚ±í¸ñÄÚÊý¾Ý//
 392   1          if((id>=0x06010001)&&(id<=0x060116A9))
 393   1          {
 394   1              comm_data.addr =0;
 395   1              comm_data.Info.u16 = EN_R;              //²»ÄÜ»òÉÏ
 396   1              comm_data.len = 0;
 397   1              comm_data.len_asc = 0;
 398   1              return 1;
 399   1          }
 400   1      
 401   1          if((id>=0x06012001)&&(id<=0x06012245))
 402   1          {
 403   1              comm_data.addr =0;
 404   1              comm_data.Info.u16 = EN_R;              //²»ÄÜ»òÉÏ
 405   1              comm_data.len = 0;
 406   1              comm_data.len_asc = 0;
 407   1              return 1;
 408   1          }
 409   1      
 410   1          //±í¸ñÄÚÊý¾Ý·ÖÇøÓò²é±í//
 411   1          
 412   1              if(id<0x01000000) //µçÁ¿ÇøÓò
 413   1              {
 414   1                  for( i = 0 ; i <dim(IEC_ComDisTab) ; i++ )
 415   1                  {
 416   1                      if( id == IEC_ComDisTab[i].ComID )
 417   1                      {
 418   1                          comm_data.addr = IEC_ComDisTab[i].Addr;
 419   1                          comm_data.Info.u16 = IEC_ComDisTab[i].ComInfo;
 420   1                          comm_data.len = IEC_ComDisTab[i].Len;
 421   1                          comm_data.len_asc = IEC_ComDisTab[i].Len_Asc;
 422   1                          return TRUE;
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 10  

 423   1                      }
 424   1                  }
 425   1              }
 426   1              else if(id<0x02000000)//ÐèÁ¿Çø
 427   1              {
 428   1                  for( i = 0 ; i <dim(IEC_ComDisTab1) ; i++ )
 429   1                  {
 430   1                      if( id == IEC_ComDisTab1[i].ComID )
 431   1                      {
 432   1                          comm_data.addr = IEC_ComDisTab1[i].Addr;
 433   1                          comm_data.Info.u16 = IEC_ComDisTab1[i].ComInfo;
 434   1                          comm_data.len = IEC_ComDisTab1[i].Len;
 435   1                          comm_data.len_asc = IEC_ComDisTab1[i].Len_Asc;
 436   1                          return TRUE;
 437   1                      }
 438   1                  }
 439   1              }
 440   1              else if(id<0x03000000)//ÏµÍ³±äÁ¿Çø
 441   1              {
 442   1                  for( i = 0 ; i <dim(IEC_ComDisTab2) ; i++ )
 443   1                  {
 444   1                      if( id == IEC_ComDisTab2[i].ComID )
 445   1                      {
 446   1                          comm_data.addr = IEC_ComDisTab2[i].Addr;
 447   1                          comm_data.Info.u16 = IEC_ComDisTab2[i].ComInfo;
 448   1                          comm_data.len = IEC_ComDisTab2[i].Len;
 449   1                          comm_data.len_asc = IEC_ComDisTab2[i].Len_Asc;
 450   1                          return TRUE;
 451   1                      }
 452   1                  }
 453   1              }
 454   1              else if(id<0x04000000)//ÊÂ¼þ¼ÇÂ¼Çø
 455   1              {
 456   1                  for( i = 0 ; i <dim(IEC_ComDisTab3) ; i++ )
 457   1                  {
 458   1                      if( id == IEC_ComDisTab3[i].ComID )
 459   1                      {
 460   1                          comm_data.addr = IEC_ComDisTab3[i].Addr;
 461   1                          comm_data.Info.u16 = IEC_ComDisTab3[i].ComInfo;
 462   1                          comm_data.len = IEC_ComDisTab3[i].Len;
 463   1                          comm_data.len_asc = IEC_ComDisTab3[i].Len_Asc;
 464   1                          return TRUE;
 465   1                      }
 466   1                  }
 467   1              }
 468   1              else if(id<0x05000000)//ÏµÍ³²ÎÊýÇø
 469   1              {
 470   1                  for( i = 0 ; i <dim(IEC_ComDisTab4) ; i++ )
 471   1                  {
 472   1                      if( id == IEC_ComDisTab4[i].ComID )
 473   1                      {
 474   1                          comm_data.addr = IEC_ComDisTab4[i].Addr;
 475   1                          comm_data.Info.u16 = IEC_ComDisTab4[i].ComInfo;
 476   1                          comm_data.len = IEC_ComDisTab4[i].Len;
 477   1                          comm_data.len_asc = IEC_ComDisTab4[i].Len_Asc;
 478   1                          return TRUE;
 479   1                      }
 480   1                  }
 481   1              }
 482   1              else if(id<0x09000000)//ÏµÍ³²ÎÊýÇø
 483   1              {
 484   1                  for( i = 0 ; i <dim(IEC_ComDisTab5) ; i++ )
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 11  

 485   1                  {
 486   1                      if( id == IEC_ComDisTab5[i].ComID )
 487   1                      {
 488   1                          comm_data.addr = IEC_ComDisTab5[i].Addr;
 489   1                          comm_data.Info.u16 = IEC_ComDisTab5[i].ComInfo;
 490   1                          comm_data.len = IEC_ComDisTab5[i].Len;
 491   1                          comm_data.len_asc = IEC_ComDisTab5[i].Len_Asc;
 492   1                          return TRUE;
 493   1                      }
 494   1                  }
 495   1              }
 496   1      
 497   1          return FALSE;*/
 498   1      }
 499          
 500          /*****************************************************************
 501           name:          uchar  GetComVar( uchar* Addr, uint* Info )
 502           function:      get command information precess  
 503           input:         no            
 504           return:        GetComVar()
 505                          =0    succeed  precess 
 506                          =1    fail precess 
 507          *****************************************************************/
 508          INT8U SecurityCK(void)
 509          {
 510   1              INT8U secType;
 511   1              secType = comm_data.Info.B08[0]&0x07; //È¨ÏÞ¼ì²â//
 512   1              /*
 513   1              if(secType ==(W_FCT>>8))
 514   1              {
 515   1                      if(ADJA_KEY)    // 0 ¶Ì½Ó 1 Î´¶Ì½Ó
 516   1                      {
 517   1                              return (mmover);
 518   1                      }
 519   1              }
 520   1          */
 521   1              return (mmok);
 522   1      }
 523          
 524          //-------------------------------------------------------------------------------//
 525          //  Function:      INT8U IEC_Cmd_Password_Deal(INT8U* sptr,INT8U len) 
 526          //  Description:   iec Í¨Ñ¶ÃÜÂëÖ¸Áî´¦Àí³ÌÐò
 527          //  Parameters:    
 528          //  Returns:        ÎÞ                          
 529          //  Others:         
 530          //-------------------------------------------------------------------------------//
 531          INT8U IEC_Cmd_Password_Deal(INT8U* sptr)
 532          {
 533   1        INT8U tmp_8u_01[4];
 534   1        INT8U tmp_8u_02[8];
 535   1      
 536   1          if((gs_uart_iec_app_var[g_ch_comm].iec_status & (COMM_REQUIST_OK_IEC+COMM_INFO_OK_IEC)) != 0x03)   ret
             -urn(FALSE);
 537   1      
 538   1           mem_read(&tmp_8u_01[0], ADR_METER_PARAM1_PW0, 4, MEM_E2P1);
 539   1           Lib_BCD_AscA(&tmp_8u_02[0], &tmp_8u_01[0], 4);
 540   1               
 541   1      
 542   1          if(Lib_Cmp_TwoArry((sptr+5), &tmp_8u_02[0], 8) == 0x00)  
 543   1          {
 544   2               gs_uart_iec_app_var[g_ch_comm].iec_status |= COMM_MIMA_OK_IEC;  // ¸ø³öÇëÇóÃüÁî³É¹¦±êÊ¶ //
 545   2               Get_ACK_Answer(sptr);
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 12  

 546   2               gs_uart_iec_app_var[g_ch_comm].len = 1;
 547   2               return TRUE;
 548   2          }
 549   1          else
 550   1          {
 551   2              if(Lib_Cmp_TwoArry((sptr+5), &Super_mima_iec[0], 8) == 0x00) 
 552   2              {
 553   3                  gs_uart_iec_app_var[g_ch_comm].iec_status |= COMM_MIMA_OK_IEC;  // ¸ø³öÇëÇóÃüÁî³É¹¦±êÊ¶ //
 554   3                  Get_ACK_Answer(sptr);
 555   3                  gs_uart_iec_app_var[g_ch_comm].len = 1;
 556   3                  return TRUE;
 557   3              }
 558   2          }
 559   1          api_deal_even_class_recode(ID_CLASS_I_MMERR,START); //  
 560   1          return FALSE;
 561   1      }
 562          
 563          
 564          //-------------------------------------------------------------------------------//
 565          //  Function:      INT8U IEC_Cmd_Read_Deal(INT8U* sptr,INT8U len)
 566          //  Description:   iec Í¨Ñ¶¶ÁÖ¸Áî´¦Àí³ÌÐò
 567          //  Parameters:    
 568          //  Returns:        ÎÞ                          
 569          //  Others:         
 570          //-------------------------------------------------------------------------------//
 571          INT8U IEC_Cmd_Read_Deal(INT8U* sptr)
 572          {
 573   1       INT8U i,j;
 574   1       INT8U  mem_type;
 575   1       INT8U  data_buff[128];
 576   1       INT8U  *ptr_adr;
 577   1       INT16U ctmp1;
 578   1       ST_U32_U08  long_tmp;
 579   1       ST_U16_U08      LPRecStart,LPRecEnd;
 580   1      
 581   1      SUM_MMD_DATA_UNIT t;
 582   1      NEW_MMD_DATA_UNIT te;
 583   1          if((gs_uart_iec_app_var[g_ch_comm].iec_status &(COMM_REQUIST_OK_IEC+COMM_INFO_OK_IEC+COMM_MIMA_OK_IEC)
             -) != 0x07)   return(FALSE);   
 584   1          //get comm DI1 DI0
 585   1           Lib_Asc_BCDA(&comm_data.di1_di0.B08[0], sptr+4,8);
 586   1      
 587   1          //get other comm fram data  
 588   1          if(get_IEC_comm_var( comm_data.di1_di0.u32) == 0 )   return(FALSE);
 589   1          if( ( comm_data.Info.u16& EN_R) == 0 )  return(FALSE);
 590   1          //  »ñÈ¡Êý¾ÝµÄ´æ´¢ÀàÐÍ //
 591   1          mem_type = (comm_data.Info.B08[0]>>3)&0x07;         
 592   1          //Êý¾ÝÓòÇåÁã²¢ÉèÖÃ·¢ËÍ³¤¶È
 593   1          Lib_Set_String((sptr+2), '0', comm_data.len_asc);  
 594   1      
 595   1          ptr_adr = comm_data.addr;
 596   1      
 597   1            //    // 
 598   1              //²»ÔÚ±í¸ñÄÚID´¦Àí µ¥Ìõ¸ººÉID 
 599   1              if((comm_data.di1_di0.u32>=0x06010001)&&(comm_data.di1_di0.u32<=0x060105A0))
 600   1              {
 601   2                      ctmp1 = (INT16U)(comm_data.di1_di0.u32 - 0x06010001);
 602   2                      if(ctmp1 < LPRunPa.Num[0])      // ¶ÁÈ¡ID Ð¡ÓÚÓÚÒÑ¼ÇÂ¼Êý
 603   2                      {
 604   3                              comm_data.len = LPRec_Read_1(sptr+2, ctmp1);
 605   3                              comm_data.len_asc = 2*comm_data.len;    
 606   3                      }
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 13  

 607   2                      else
 608   2                      {
 609   3      //                      comm_data.len = LPRec_Read_1(sptr+2, ctmp1);
 610   3      //                      comm_data.len_asc = 2*comm_data.len;    
 611   3      //                      Lib_Set_String((sptr+2), 'F', comm_data.len_asc); 
 612   3                              comm_data.len_asc = 0;  
 613   3                      }
 614   2      
 615   2      
 616   2                      // ³É¹¦ºóÊý¾Ý×éÖ¡ //
 617   2                      //api_deal_even_class_recode(ID_CLASS_I_COMM,START);
 618   2                      gs_uart_iec_app_var[g_ch_comm].len= (comm_data.len_asc+5);
 619   2                      *(sptr+0) = STX;
 620   2                      *(sptr+1) = '(';
 621   2                      CLRWDT(); *(sptr+2+comm_data.len_asc) = ')';
 622   2                      *(sptr+gs_uart_iec_app_var[g_ch_comm].len-2) =ETX;
 623   2              CLRWDT();       *(sptr+gs_uart_iec_app_var[g_ch_comm].len-1) = Get_Bcc_Chk(sptr, 1, gs_uart_iec_app_var[g_ch_c
             -omm].len-2);
 624   2      
 625   2                      return(TRUE); 
 626   2              }
 627   1              
 628   1              
 629   1              if((comm_data.di1_di0.u32>=0x060A0001)&&(comm_data.di1_di0.u32<=0x060A0120))//   //SXL 2019-01-6
 630   1        {
 631   2                      LPRecStart.u16 =(INT16U)((comm_data.di1_di0.u32 - 0x060A0001)*BLOCK_MAX_LEN);
 632   2                      LPRecEnd.u16 =LPRecStart.u16+BLOCK_MAX_LEN;
 633   2                      
 634   2                      if(LPReadPara.ReadLoraFlag == FALSE )
 635   2                      {                       
 636   3                              LPReadPara.Original_FrameNum = LPRunPa.Num[0] ;
 637   3                              LPReadPara.Original_Ptr = LPRunPa.Ptr[0] ;
 638   3                      }               
 639   2                      
 640   2                      comm_data.len_asc  = LPRec_Read_Block(sptr+2,LPRecStart.u16, LPRecEnd.u16);
 641   2                       
 642   2                      
 643   2                      if(LPReadPara.ReadLoraFlag == FALSE )   LPReadPara.ReadLoraFlag = TRUE; 
 644   2                              
 645   2                      gs_uart_iec_app_var[g_ch_comm].len= (comm_data.len_asc+5);
 646   2                      CLRWDT(); 
 647   2                      *(sptr+0) = STX;
 648   2                      *(sptr+1) = '(';CLRWDT(); 
 649   2                      *(sptr+2+comm_data.len_asc) = ')';
 650   2                      CLRWDT(); *(sptr+gs_uart_iec_app_var[g_ch_comm].len-2) =ETX;
 651   2                      *(sptr+gs_uart_iec_app_var[g_ch_comm].len-1) = Get_Bcc_Chk(sptr, 1, gs_uart_iec_app_var[g_ch_comm].len-2
             -);
 652   2      CLRWDT(); 
 653   2                      return(TRUE); 
 654   2                      
 655   2                      }
 656   1              
 657   1          // ¸ù¾Ý¶ÁÈ¡Êý¾ÝµÄIDÏîÄ¿×ö·ÖÖ§´¦Àí //
 658   1          switch(comm_data.di1_di0.u32)
 659   1          {   
 660   2                      case 0x02010000:    //µçÑ¹ Ô´Êý¾ÝÎªHEX32£¬0.1VÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XXX.XV //
 661   2                      case 0x02010100:    //µçÑ¹ Ô´Êý¾ÝÎªHEX32£¬0.1VÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XXX.XV //
 662   2                              Lib_long_bcd4(&long_tmp.B08[0],gs_measure_var_data.gs_really[0].dw_u_val.u32);
 663   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &long_tmp.B08[2], 2);
 664   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 665   2                      break;
 666   2                      
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 14  

 667   2                      case 0x02020000:    //LµçÁ÷ Ô´Êý¾ÝÎªHEX32£¬0.001AÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XXX.XXXA //
 668   2                      case 0x02020100:    //LµçÁ÷ Ô´Êý¾ÝÎªHEX32£¬0.001AÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XXX.XXXA //
 669   2                              Lib_long_bcd4(&long_tmp.B08[0],(gs_measure_var_data.gs_really[0].dw_i_val.u32));
 670   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &long_tmp.B08[1], 3);
 671   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 672   2                      break;
 673   2                      
 674   2                      case 0x02800001:    //NµçÁ÷ Ô´Êý¾ÝÎªHEX32£¬0.001AÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XXX.XXXA //
 675   2                              Lib_long_bcd4(&long_tmp.B08[0],(gs_measure_var_data.dw_i_n_val.u32));
 676   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &long_tmp.B08[1], 3);
 677   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 678   2                      break;
 679   2                      
 680   2                      case 0x02030000:    //L   ¹¦ÂÊÔ´Êý¾ÝÎªHEX32£¬0.0001KWÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XX.XXXXkW //
 681   2                      case 0x02030100:        //¹¦ÂÊÔ´Êý¾ÝÎªHEX32£¬0.0001KWÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XX.XXXXkW //
 682   2                              Lib_long_bcd4(&long_tmp.B08[0],(gs_measure_var_data.gs_really[0].dw_p_val.u32));
 683   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &long_tmp.B08[1], 3);
 684   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 685   2                      break;
 686   2                      
 687   2                      case 0x02030200:    //N¹¦ÂÊÔ´Êý¾ÝÎªHEX32£¬0.0001KWÁ¿¸Ù£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½,XX.XXXXkW //
 688   2                              Lib_long_bcd4(&long_tmp.B08[0],(gs_measure_var_data.dw_p_n_val.u32));
 689   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &long_tmp.B08[1], 3);
 690   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 691   2                      break;
 692   2      
 693   2                      case 0x02060000:        //¹¦ÂÊÒòÊýÊý¾ÝÎªHEX16£¬0.001£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½0.001 //
 694   2                      case 0x02060100:    //¹¦ÂÊÒòÊýÊý¾ÝÎªHEX16£¬0.001£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½0.001 //
 695   2                              Lib_word_bcd2(&long_tmp.B08[0],(gs_measure_var_data.gs_really[0].dw_pf_val.u16));
 696   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &long_tmp.B08[0], 2);
 697   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 698   2                      break;
 699   2      
 700   2                      case 0x02800002:    //µçÍøÆµÂÊÊý¾ÝÎªHEX16£¬0.01Hz£¬ÐèÒª×ª»»ÎªBCDÂë¸ñÊ½xx.xx //
 701   2                              Lib_word_bcd2(&long_tmp.B08[0],(gs_measure_var_data.gs_really[0].w_freq_val.u16));
 702   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &long_tmp.B08[0], 2);
 703   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 704   2                      break;
 705   2      
 706   2                      case 0x04000100://ÈÕÆÚ¼°ÐÇÆÚ(ÆäÖÐ0´ú±íÐÇÆÚÌì)YYMMDDWWhhmmss
 707   2                              Lib_Copy_Str_TwoArry(&data_buff[0], ptr_adr, comm_data.len);
 708   2                              data_buff[7] = data_buff[0];    //ww
 709   2                              data_buff[0] = data_buff[1];    //YY
 710   2                              data_buff[1] = data_buff[2];    //MM
 711   2                              data_buff[2] = data_buff[3];    //DD
 712   2                              data_buff[3] = data_buff[7];    //WW
 713   2                              data_buff[4] = data_buff[4];    //hh
 714   2                              data_buff[5] = data_buff[5];    //mm
 715   2                              data_buff[6] = data_buff[6];    //ss
 716   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 717   2                      break;
 718   2      
 719   2                      case 0x04000401://±íµØÖ· ±íºÅ NNNNNNNNNNNN
 720   2                              mem_read(&data_buff[0], (INT16U)comm_data.addr,  comm_data.len,  mem_type );
 721   2                              comm_data.len_asc = get_meter_id_asclen(&data_buff[0], 16);
 722   2                              comm_data.len = comm_data.len_asc>>1;
 723   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len);
 724   2                      break;
 725   2                      
 726   2                      case 0x04800001: //Èí¼þ°æ±¾ºÅ ÒÑÊÇASCÂë
 727   2                              Lib_Copy_Str_TwoArry(sptr+2, ptr_adr, comm_data.len);
 728   2                      break;          
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 15  

 729   2                      
 730   2                      case 0x80805001:        //µ±Ç°ÔÂ×ÜµçÁ¿+¼ÌµçÆ÷×´Ì¬+±í¼ÆÈÕÆÚÊ±¼ä //
 731   2                              //µ±Ç°ÔÂ×ÜµçÁ¿
 732   2                              mem_read(&data_buff[10], (INT16U)&gs_energy_user_data.us_val[0][0].buf[0], LEN_EC_UNIT, MEM_RAM);         //»
             -ñÈ¡µ±Ç°Êý¾Ý //
 733   2                              api_get_energy_LCD(&data_buff[10], 0x62,&data_buff[0]);
 734   2                              Lib_BCD_AscA(sptr+2, &data_buff[0], 4); 
 735   2                              //¼ÌµçÆ÷×´Ì¬
 736   2                              mem_read(&data_buff[0], (INT16U)ADR_METER_PARAM1_RELAY_CMD, 2, MEM_E2P1);         //»ñÈ¡µ±Ç°Êý¾Ý //
 737   2                              Lib_BCD_AscA(sptr+2+8, &data_buff[0], 2); 
 738   2                              Lib_Copy_Str_TwoArry(&data_buff[0], &gs_CurDateTime.Year, 6);
 739   2                              Lib_BCD_AscA(sptr+2+8+4, &data_buff[0], 6); 
 740   2                      break;
 741   2      
 742   2                      case 0x0506FF01: //¶³½á1
 743   2                      case 0x0506FF02: //¶³½á2
 744   2                      case 0x0506FF03: //¶³½á3
 745   2                      case 0x0506FF04: //¶³½á4
 746   2                                i = comm_data.di1_di0.B08[3];
 747   2                                mem_read(&data_buff[10], &energy_data_array[i].buf[0], LEN_BLOCK_4Energy_E2P/4,MEM_RAM);//µçÁ¿
*** WARNING C214 IN LINE 747 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: 'Argument': conversion: pointer to non-pointer
 748   2                                api_get_energy_LCD(&data_buff[10], 0x62,&data_buff[0]);
 749   2                                Lib_BCD_AscA(sptr+2+10, &data_buff[0], 4);    
 750   2                                      
 751   2                                mem_read(&te, &st_mmd_unit_array[i].buf[0], LEN_NEW_MMD_UNIT, MEM_RAM);//ÐèÁ¿
*** WARNING C182 IN LINE 751 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: pointer to different objects
*** WARNING C214 IN LINE 751 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: 'Argument': conversion: pointer to non-pointer
 752   2                                te.val.val_hex32 /=100;
 753   2                                data_buff[0] = te.val.val_hex32/1000000;
 754   2                                data_buff[1] = te.val.val_hex32%1000000/10000;
 755   2                                data_buff[2] = te.val.val_hex32%10000/100 ;
 756   2                                data_buff[3] = te.val.val_hex32%100  ;
 757   2                                for(j=0;j<4;j++)
 758   2                                {
 759   3                                      if(data_buff[j]>0x09)
 760   3                                      {
 761   4                                              data_buff[j]+= 0x06*(data_buff[j]/10);
 762   4                                      }
 763   3                                }
 764   2                                Lib_BCD_AscA(sptr+2+10+8,&data_buff[0],4);
 765   2                                //Lib_BCD_AscA(sptr+2+10+8,&te.buf[0],4);
 766   2                               
 767   2                                mem_read(&t, &sum_st_mmd_unit_array[i].buf[0], LEN_SUM_MMD_UNIT, MEM_RAM);//ÀÛ¼ÆÐèÁ¿
*** WARNING C182 IN LINE 767 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: pointer to different objects
*** WARNING C214 IN LINE 767 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: 'Argument': conversion: pointer to non-pointer
 768   2                                t.val.val_hex32 /=100;
 769   2                                data_buff[0] = t.val.val_hex32/1000000;
 770   2                                data_buff[1] = t.val.val_hex32%1000000/10000;
 771   2                                data_buff[2] = t.val.val_hex32%10000/100; 
 772   2                                data_buff[3] = t.val.val_hex32%100;
 773   2                                for(j=0;j<4;j++)
 774   2                                {
 775   3                                      if(data_buff[j]>0x09)
 776   3                                      {
 777   4                                              data_buff[j]+=0x06*(data_buff[j]/10);
 778   4                                      }
 779   3                                }
 780   2                                Lib_BCD_AscA(sptr+2+10+8+8,&data_buff[0],4);
 781   2                               // Lib_BCD_AscA(sptr+2+10+8+8,&t.buf[0],4);
 782   2                                data_buff[0] = te.val.date_rtc[0];    //YY
 783   2                                data_buff[1] = te.val.date_rtc[1];    //MM
 784   2                                data_buff[2] = te.val.date_rtc[2];    //DD
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 16  

 785   2                                data_buff[3] = te.val.date_rtc[3];    //hh
 786   2                                data_buff[4] = te.val.date_rtc[4];    //mm
 787   2                                Lib_BCD_AscA(sptr+2, &data_buff[0], 5);
 788   2                                if(t.buf[4]>0x09)
 789   2                                      {
 790   3                                              t.buf[4]+=0x06*(t.buf[4]/10);
 791   3                                      }
 792   2                                Lib_BCD_AscA(sptr+2+10+8+8+8,&t.buf[4],1);//´ÎÊý
 793   2                      break;
 794   2                      
 795   2              default:
 796   2                              ////////////////µçÄÜÁ¿ÌØÊâ´¦Àí/////////////////////////////
 797   2                              if(comm_data.di1_di0.B08[0]==0x00)
 798   2                              {
 799   3                                      comm_data.len = LEN_EC_UNIT;   // ÐÞ¸Ä»ñÈ¡³¤¶È//
 800   3                              }
 801   2                              ///////////////////////////////////////////////////////////////////
 802   2      
 803   2                              if((comm_data.Info.u16&CM_ALL) == CM_BILL)
 804   2                              {
 805   3                                      mem_read(&data_buff[0],api_get_bill_record_addr((INT16U)comm_data.addr), comm_data.len,  mem_type );
 806   3                              }
 807   2                              else if((comm_data.Info.u16&CM_ALL) == CM_EBIL)//ÊÂ¼þ¼ÇÂ¼ÀàÊý¾Ý
 808   2                      {
 809   3              mem_read(&data_buff[0], comm_data.addr,     (comm_data.len>>1),  mem_type );
*** WARNING C214 IN LINE 809 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: 'Argument': conversion: pointer to non-pointer
 810   3              mem_read(&data_buff[6], comm_data.addr+60,  (comm_data.len>>1),  mem_type );
*** WARNING C214 IN LINE 810 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: 'Argument': conversion: pointer to non-pointer
 811   3                  }
 812   2                              
 813   2                              else 
 814   2                              {
 815   3                                      if(mem_type==MEM_RAM)
 816   3                                      {
 817   4                                              Lib_Copy_Str_TwoArry(&data_buff[0], ptr_adr, comm_data.len);
 818   4                                      }
 819   3                                      else
 820   3                                      {
 821   4                                              mem_read(&data_buff[0],(INT16U)comm_data.addr,comm_data.len,mem_type );
 822   4                                      }
 823   3                              }
 824   2                              ////////////////µçÄÜÁ¿ÌØÊâ´¦Àí/////////////////////////////
 825   2                              if(comm_data.di1_di0.B08[0]==0x00)
 826   2                              {
 827   3                                      Lib_Copy_Str_TwoArry(&data_buff[10], &data_buff[0], LEN_EC_UNIT);
 828   3                                      api_get_energy_LCD(&data_buff[10], 0x62, &data_buff[0]) ;
 829   3                                      comm_data.len=4;
 830   3                              }
 831   2                              ///////////////////////////////////////////////////////////////////
 832   2      
 833   2                              ////////////////×î´óÐèÁ¿ÌØÊâ´¦Àí/////////////////////////////
 834   2                              if(comm_data.di1_di0.B08[0]==0x01)
 835   2                              {  
 836   3                                      Lib_Copy_Str_TwoArry(&long_tmp.B08[0], &data_buff[0], 4);
 837   3                                      Lib_long_bcd4(&data_buff[0],long_tmp.u32);
 838   3                              }
 839   2                              
 840   2                              
 841   2                              
 842   2                              
 843   2                              
 844   2                              ///////////////////////////////////////////////////////////////////                
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 17  

 845   2                              if(comm_data.len_asc == 5)
 846   2                              {
 847   3                                      *(sptr+2) = Lib_BtoA(data_buff[0]&0x0f);
 848   3                                      Lib_BCD_AscA(sptr+3, &data_buff[1], 2);   
 849   3                              }
 850   2                              else
 851   2                              {
 852   3                                      Lib_BCD_AscA(sptr+2, &data_buff[0], comm_data.len); 
 853   3                              }
 854   2                  break;      
 855   2          }
 856   1      
 857   1          // ³É¹¦ºóÊý¾Ý×éÖ¡ //
 858   1          gs_uart_iec_app_var[g_ch_comm].len= (comm_data.len_asc+5);
 859   1          *(sptr+0) = STX;
 860   1          *(sptr+1) = '(';
 861   1          *(sptr+2+comm_data.len_asc) = ')';
 862   1          *(sptr+gs_uart_iec_app_var[g_ch_comm].len-2) =ETX;
 863   1          *(sptr+gs_uart_iec_app_var[g_ch_comm].len-1) = Get_Bcc_Chk(sptr, 1, gs_uart_iec_app_var[g_ch_comm].len
             --2);
 864   1              
 865   1          return(TRUE); 
 866   1      }
 867          
 868          
 869          //-------------------------------------------------------------------------------//
 870          //  Function:      INT8U IEC_Cmd_Write_Deal(INT8U* sptr,INT8U len)
 871          //  Description:   iec Í¨Ñ¶Ð´Ö¸Áî´¦Àí³ÌÐò
 872          //  Parameters:   lenÎªÉèÖÃÊý¾ÝµÄÊµ¼Ê³¤¶È
 873          //  Returns:        ÎÞ                          
 874          //  Others:         
 875          //-------------------------------------------------------------------------------//
 876          INT8U IEC_Cmd_Write_Deal(INT8U* sptr,INT8U len)
 877          {
 878   1      // INT8U tmp_8u_01[16];
 879   1       INT8U  mem_type;
 880   1       INT8U  data_buff[70];
 881   1       INT8U  sectemp;
 882   1       INT8U i,MeterID_LenTmp; //±íºÅ  ÓÐÐ§³¤¶È asc
 883   1       INT8U  *ptr_adr;
 884   1       
 885   1          if((gs_uart_iec_app_var[g_ch_comm].iec_status &(COMM_REQUIST_OK_IEC+COMM_INFO_OK_IEC+COMM_MIMA_OK_IEC)
             -) != 0x07)   return(FALSE);
 886   1          //get comm DI1 DI0
 887   1          Lib_Asc_BCDA(&comm_data.di1_di0.B08[0], sptr+4,8);
 888   1          //get other comm fram data 
 889   1          if(get_IEC_comm_var( comm_data.di1_di0.u32) == 0 )   return(FALSE);
 890   1      
 891   1          if( ( comm_data.Info.u16& EN_W) == 0 )  return(FALSE);
 892   1          //  »ñÈ¡Êý¾ÝµÄ´æ´¢ÀàÐÍ //
 893   1          mem_type = (comm_data.Info.B08[0]>>3)&0x07;         
 894   1          sectemp = SecurityCK();                                     //È¨ÏÞÅÐ¶Ï
 895   1          if(sectemp == mmover)   return(FALSE);
 896   1      
 897   1          //Êý¾ÝÓòÇåÁã²¢¼ì²é½ÓÊÕµÄÊý¾Ý³¤¶ÈºÏ·¨ÐÔ //
 898   1          Lib_Set_String(&data_buff[0], 0x00, comm_data.len); 
 899   1          if(comm_data.di1_di0.u32== 0x04000401) //³ýÉèÖÃ±íºÅÍâ.¶¼ÐèÒª¶Ô±ÈÊý¾Ý³¤¶È
 900   1          {
 901   2              if((len > comm_data.len_asc+16)||(len < 16))
 902   2              return(FALSE);
 903   2          }
 904   1          else
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 18  

 905   1          {
 906   2              if(len != (comm_data.len_asc+16))          
 907   2              return(FALSE);
 908   2          }
 909   1      
 910   1          ptr_adr = comm_data.addr;
 911   1      
 912   1          // ¸ù¾ÝÉèÖÃÊý¾ÝµÄIDÏîÄ¿×ö·ÖÖ§´¦Àí //
 913   1          switch(comm_data.di1_di0.u32)
 914   1          {
 915   2      
 916   2              case 0x04000100://ÈÕÆÚ¼°ÐÇÆÚ(ÆäÖÐ0´ú±íÐÇÆÚÌì)YYMMDDWWhhmmss  
 917   2                  Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);   //AtoB(INT8U Asc)
 918   2                  gs_CurDateTime.Year= data_buff[0];
 919   2                  gs_CurDateTime.Month= data_buff[1];
 920   2                  gs_CurDateTime.Day= data_buff[2];
 921   2                  gs_CurDateTime.Week= data_buff[3];
 922   2                  gs_CurDateTime.Hour= data_buff[4];
 923   2                  gs_CurDateTime.Minute= data_buff[5];
 924   2                  gs_CurDateTime.Second= data_buff[6];
 925   2                  EA=0;
 926   2                  Set_RTCTime(&gs_CurDateTime);
 927   2                  EA=1;
 928   2                  mem_db_write(ADR_METER_VAR_RTC, &gs_CurDateTime.Week, 7, MEM_E2P1);
 929   2                              CLRWDT();  
 930   2                                          api_deal_even_class_recode(ID_CLASS_I_setRtc,START);
 931   2                  api_init_md_data_ram();
 932   2                      #if (TARIFF_MAX_NUM>0)
 933   2                  api_update_triffNo_pre_minute();
 934   2                      #endif
 935   2                  break;
 936   2                              
 937   2      
 938   2                  //±íºÅÌØÊâ´¦Àí
 939   2                  case 0x04000401://±íµØÖ· ±íºÅ 16¸ö×Ö½Ú ×ÔÊÊÓ¦,ÈçÉèÆæÊý£¬ÔòÇ°²¹0
 940   2                      MeterID_LenTmp = (len-16);      //ÓÐÐ§±íºÅ  ³¤¶È
 941   2                      if(((len-16)%2)!=0)     //ÆæÊýÔòÇ°Ãæ²¹Ò»¸ö0
 942   2                      {
 943   3                              for(i=(len-16);i>0;i--)
 944   3                              {
 945   4                                      *(sptr+13+i) = *(sptr+13+i-1) ; //ÏòºóÅ²1Î»
 946   4                              }
 947   3                              *(sptr+13)= '0';                                        //¸ßÎ»²¹0
 948   3                              MeterID_LenTmp = (len-16) +1;
 949   3                      }
 950   2                                      comm_data.len_asc = MeterID_LenTmp;
 951   2                                      Lib_Set_String(&data_buff[0], 0xFF, 16);
 952   2                                      Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);   //AtoB(INT8U Asc)                  
 953   2                                      mem_db_write((INT16U)comm_data.addr, &data_buff[0], comm_data.len, mem_type);           //Ð´ÈëÓ¦¸ÃÊÇ16×Ö½Ú£¬¶ø²
             -»ÊÇÉèÖÃµÄ³¤¶È
 954   2                      break;
 955   2      
 956   2                              
 957   2                      case 0x04000B01://½áËãÈÕDDHH 4
 958   2                      Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);   //AtoB(INT8U Asc)
 959   2                      if((data_buff[0]<0x01)||(data_buff[0]>0x28)||(data_buff[1]>0x23))               //´íÎóÅÐ¶Ï
 960   2                      {
 961   3                          return(FALSE);
 962   3                      }
 963   2                      mem_db_write((INT16U)comm_data.addr, &data_buff[0], comm_data.len, mem_type);
 964   2                      break;
 965   2      //              case 0x04800003://À­Õ¢ºÏÕ¢²Ù×÷//)
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 19  

 966   2      //                              Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);       //AtoB(INT8U Asc)
 967   2      //                              if(Drv_relay_COMM_CMD_operating(&data_buff[0])==FALSE)  
 968   2      ////                            {
 969   2      //                                      return(FALSE);
 970   2      //                              }
 971   2      //                              break;  
 972   2      
 973   2                      case 0x04000103://ÐèÁ¿²ÎÊý PERIOD : SLID   4  //ÐÞ¸ÄºóÐèÁ¿ÖØÐÂ¼ÆËã //
 974   2                      Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);   //AtoB(INT8U Asc)
 975   2                      if(((data_buff[0]%data_buff[1]) !=0)||(data_buff[0]>30)||(data_buff[0]==0)||(data_buff[1]=
             -=0))                //´íÎóÅÐ¶Ï//
 976   2                      {
 977   3                          return(FALSE);
 978   3                      }
 979   2                      mem_db_write((INT16U)comm_data.addr, &data_buff[0], comm_data.len, mem_type);
 980   2      //                              CLRWDT();
 981   2                      api_init_md_data_ram();
 982   2                                      CLRWDT();
 983   2                      break;
 984   2      
 985   2      
 986   2      ///////////Îó²îÐ£±í//////////////////
 987   2                      case 0x0000FEB0: 
 988   2                      case 0x0000FEB1:
 989   2                      case 0x0000FEB2:
 990   2                      case 0x0000FEB3:
 991   2                      case 0x0000FEB4:
 992   2                      case 0x0000FEB5:
 993   2                              Measure_Electric_Err_Gain(sptr);//±ØÐëÏÈÐ£×¼Îó²î£¬ÑÓÊ±1ÃëÒÔÉÏÐ£×¼µç²ÎÁ¿²Å×¼//   
 994   2                      break;
 995   2                      //Ð£±í³õÊ¼»¯(²ÎÊýÇåÁã)
 996   2                      case 0x80800803:                
 997   2                              if((*(sptr+13)=='3')&&(*(sptr+14)=='3')&&(*(sptr+15)=='3'))  
 998   2                              {
 999   3                                      if((*(sptr+16)=='3'))                                   // clear all
1000   3                                      {
1001   4                                              gs_adj_emu_param.w1gain=0;
1002   4                                              gs_adj_emu_param.p1cal=0;
1003   4                                              gs_adj_emu_param.watt1os=0;
1004   4                                              gs_adj_emu_param.irms1os=0;
1005   4                                              gs_adj_emu_param.w2gain=0;
1006   4                                              gs_adj_emu_param.p2cal=0;
1007   4                                              gs_adj_emu_param.watt2os=0;
1008   4                                              gs_adj_emu_param.irms2os=0;
1009   4                                              gs_adj_emu_param.urmsos=0;
1010   4                                              CLRWDT();
1011   4                                      }
1012   3                                      if((*(sptr+16)=='2'))                                   // ÇåµÚ¶þÂ·½»±í²ÎÊý
1013   3                                      {
1014   4                                              gs_adj_emu_param.w1gain=0;
1015   4                                              gs_adj_emu_param.p1cal=0;
1016   4                                              gs_adj_emu_param.watt1os=0;
1017   4                                              gs_adj_emu_param.irms1os=0;
1018   4                                              gs_adj_emu_param.urmsos=0;
1019   4                                              CLRWDT();
1020   4                                      }
1021   3                                      Save_EMU_AdjParam();
1022   3                                      Check_EMU_AdjParam();//  »Ö¸´Ä¬ÈÏÊý¾Ý//
1023   3                              }
1024   2                              else
1025   2                              {
1026   3                                      return FALSE;
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 20  

1027   3                              }
1028   2                              break;  
1029   2      
1030   2                      case 0x0000FEBB://¼ÆÁ¿±¶Æµ10±¶»ò //     
1031   2                              if((*(sptr+13)=='0')&&(*(sptr+14)=='0')&&(*(sptr+15)=='1')&&(*(sptr+16)=='6')) 
1032   2                              {
1033   3                                      //±¶Æµ10±¶£¬³£ÊýÎª10000 //
1034   3                                      data_buff[0] = 0x3C;     // ´ú±í±¶Æµ10±¶ //
1035   3                                      mem_db_write(ADR_METER_PARAM1_CONST_FAST_FLG, &data_buff[0], 1, MEM_E2P1);
1036   3                                      Check_EMU_AdjParam();//  »Ö¸´Ä¬ÈÏÊý¾Ý//
1037   3                              }
1038   2                              else if((*(sptr+13)=='0')&&(*(sptr+14)=='1')&&(*(sptr+15)=='B')&&(*(sptr+16)=='8')) 
1039   2                              {
1040   3                                      //±¶Æµ»Ö¸´£¬³£ÊýÎª1000 //
1041   3                                       data_buff[0] = 0;         // ´ú±í±¶Æµ10±¶ //
1042   3                                      mem_db_write(ADR_METER_PARAM1_CONST_FAST_FLG, &data_buff[0], 1, MEM_E2P1);
1043   3                                      Check_EMU_AdjParam();//  »Ö¸´Ä¬ÈÏÊý¾Ý//
1044   3                              }
1045   2                              else
1046   2                              {
1047   3                                      return FALSE;
1048   3                              }
1049   2                              break;
1050   2                              
1051   2                      case 0x08020200://NN=FF£¬Çå³ýËùÓÐÍ¨µÀ£»//
1052   2                              if((*(sptr+13)=='F')&&(*(sptr+14)=='F'))        //YYY
1053   2                              {
1054   3      //                              api_clr_even_by_comm(); 
1055   3                                      IsClrEvent = 1;
1056   3                                      CLRWDT();
1057   3                              }
1058   2                              else
1059   2                              {
1060   3                                      return(FALSE);
1061   3                              }
1062   2                              break;
1063   2                      
1064   2                              case 0x08020100://Ö»Çåµ±Ç°ÐèÁ¿ÇåÁã//
1065   2                                      Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);   //AtoB(INT8U Asc)
1066   2                                      if((data_buff[0]!=0))  return(FALSE);
1067   2                                      CLRWDT();
1068   2                                      api_clr_current_MD_data();
1069   2                                      api_deal_even_class_recode(ID_CLASS_I_resetMD,START);
1070   2                              CLRWDT();
1071   2                              break;
1072   2      
1073   2                  case 0x08020300:
1074   2                              // Asc_BCDA( &data_buff[0],(sptr+13), 1*2);
1075   2                  // Ò»¸öÍ¨µÀ¸ººÉ¼ÇÂ¼Ö¸Õë¡¢¼ÇÂ¼¸öÊý 
1076   2                  if((*(sptr+13)=='0')&&(*(sptr+14)=='0'))    //YYY
1077   2                              {
1078   3                                      LoadProRst();
1079   3                                      CLRWDT();
1080   3                              }
1081   2                              else
1082   2                              {
1083   3                                      return(FALSE);
1084   3                              }
1085   2                              break;
1086   2                              
1087   2                              
1088   2                      case 0x08020400://µçÁ¿ÇåÁã(µç±í×ÜÇå(µçÁ¿+ÐèÁ¿)) //
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 21  

1089   2                              Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);   //AtoB(INT8U Asc)
1090   2                              if((data_buff[0]!=0)||(data_buff[1]!=0)||(data_buff[2]!=0)||(data_buff[3]!=0))  return(FALSE);
1091   2                              CLRWDT();
1092   2                              clr_flag = 1;
1093   2                              break;
1094   2      
1095   2                      case 0x08020500:// ¹¤³§Ä£Ê½//   
1096   2                              Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);       //AtoB(INT8U Asc)
1097   2                              gs_sys_globaL_var.meter_factory_status = data_buff[0] ; //¸üÐÂ×´Ì¬×Ö
1098   2                              mem_db_write((INT16U)comm_data.addr, &data_buff[0], comm_data.len, mem_type);
1099   2                              break;
1100   2                              
1101   2                      case 0xEE000118://EEPROM±êÖ¾//
1102   2                              Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);       //AtoB(INT8U Asc)
1103   2                              CLRWDT();
1104   2                              mem_db_write((INT16U)comm_data.addr, &data_buff[0], comm_data.len, mem_type);
1105   2                              CLRWDT();
1106   2                              while(1)
1107   2                              {
1108   3                                      NOP();                  // ¸´Î»£¬µÈ´ýÊý¾Ý¼ì²é»Ø¸´Êý¾Ý£¬10Ãë×óÓÒ //
1109   3                              }       
1110   2                              CLRWDT();
1111   2                              break;
1112   2                              
1113   2                       //Ð£±í²ÎÊýÍâËùÓÐÊý¾ÝÇåÁã//
1114   2                      case 0x0000FEFF://NN=FF£¬Çå³ýËùÓÐÍ¨µÀ£»//
1115   2                               if((*(sptr+13)=='5')&&(*(sptr+14)=='5')&&(*(sptr+15)=='5')&&(*(sptr+16)=='5'))  
1116   2                              {
1117   3                                      mem_db_clr(0);   //Êý¾ÝÇøÐ£ÑéºÍÈ«²¿ÇåÁã //
1118   3                                      //2019-01-24  cxy
1119   3                                      api_clr_freeze_energy();//Çå³ý¶³½áÊý¾Ý
*** WARNING C206 IN LINE 1119 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: 'api_clr_freeze_energy': missing function-proto
             -type
1120   3                                      IsReset = 1;
1121   3      //                while(1)
1122   3      //                {
1123   3      //                    NOP();          // ¸´Î»£¬µÈ´ýÊý¾Ý¼ì²é»Ø¸´Êý¾Ý£¬10Ãë×óÓÒ //
1124   3      //                }     
1125   3                                      CLRWDT();
1126   3                              }
1127   2                              else if((*(sptr+13)=='3')&&(*(sptr+14)=='3')&&(*(sptr+15)=='3')&&(*(sptr+16)=='3'))  
1128   2                               {
1129   3                                       mem_db_clr(0xA5);   //°üÀ¨Ð£×¼²ÎÊýÈ«²¿ÇåÁã //
1130   3      //                               while(1)
1131   3      //                               {
1132   3      //                                       NOP();                  // ¸´Î»£¬µÈ´ýÊý¾Ý¼ì²é»Ø¸´Êý¾Ý£¬10Ãë×óÓÒ //
1133   3      //                               }
1134   3                                       IsReset = 1;    
1135   3                                       CLRWDT();
1136   3                               }
1137   2                              else
1138   2                              {
1139   3                                      return(FALSE);
1140   3                              }
1141   2                              break;
1142   2      
1143   2                default:
1144   2                       Lib_Asc_BCDA(&data_buff[0], (sptr+13), comm_data.len_asc);   //AtoB(INT8U Asc)
1145   2                          
1146   2                       if(mem_type == MEM_RAM)
1147   2                       {
1148   3                             mem_write((INT16U)comm_data.addr,&data_buff[0], comm_data.len, mem_type);
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 22  

1149   3                       }
1150   2                       else
1151   2                       {
1152   3                             mem_db_write((INT16U)comm_data.addr, &data_buff[0], comm_data.len, mem_type);
1153   3                       }
1154   2                                       
1155   2                              break;  
1156   2                         
1157   2              }
1158   1                      
1159   1      // Í¨Ñ¶¹ýºó ÏµÍ³¸üÐÂ
1160   1          #if (TARIFF_MAX_NUM>1)
1161   1              if(((comm_data.di1_di0.u32 >= 0x04000801)&&(comm_data.di1_di0.u32 <= 0x04000807))
1162   1                      ||((comm_data.di1_di0.u32 >= 0x04010000)&&(comm_data.di1_di0.u32 <= 0x04010008)))
1163   1              {
1164   2              
1165   2                      api_update_triffNo_pre_minute();
1166   2              }
1167   1          #endif
1168   1      
1169   1      // ÓÐ¹¦×éºÏ·½Ê½×Ö¸üÐÂ´¦Àí//
1170   1              if((comm_data.di1_di0.u32 == 0x04000601))
1171   1              {
1172   2            mem_read(&gs_sys_globaL_var.fac_energy[0], ADR_METER_PARAM1_FAC_ENERGY, 2, MEM_E2P1);   
1173   2              }
1174   1      
1175   1              if((comm_data.di1_di0.u32 == 0x04000602))
1176   1              {
1177   2            mem_read(&gs_sys_globaL_var.Rac_energy[0], ADR_METER_PARAM1_REC_ENERGY, 2, MEM_E2P1);    
1178   2              }
1179   1      /////////////////ÉèÖÃÏÔÊ¾²ÎÊýºóÐèÒª¸üÐÂ///////
1180   1              if((comm_data.di1_di0.u32 == 0x04000302)||(comm_data.di1_di0.u32 == 0x04000303)||(comm_data.di1_di0.u32 =
             -= 0x04040100))
1181   1              {
1182   2                      mem_read(&gs_dis_param.auto_sec, ADR_BLOCK21_DIS_PARAM_E2P, LEN_BLOCK21_DIS_PARAM_E2P, MEM_E2P1);
1183   2              }
1184   1      
1185   1              if(comm_data.di1_di0.u32 == 0x04000B02) // ¸üÐÂRAMÇøµÄ½áËã·½Ê½
1186   1              {
1187   2                      mem_read(&Bill_Data, ADR_BLOCK20_METER_PARAM1_E2P+ST_MB_OFFSET(E2P_METER_PARAM1_MAP,BILL_FLAG), 1, MEM_E
             -2P1);
1188   2              }
1189   1      //      CLRWDT();  //2019-04-11Ôö¼Ó¿´ÃÅ¹··ÀÖ¹¸´Î»       
1190   1          // Êý¾ÝÉèÖÃ³É¹¦ºóµÄ×éÖ¡²Ù×÷ //
1191   1      //      gs_uart_iec_app_var[g_ch_comm].tx_ready_10ms  += 4;
1192   1          api_deal_even_class_recode(ID_CLASS_I_PROG,START);   //Éú³É±à³ÌÊÂ¼þ¼ÇÂ¼ //
1193   1      //      IsProg = 1;
1194   1          gs_uart_iec_app_var[g_ch_comm].len= 1;
1195   1          Get_ACK_Answer(sptr);
1196   1      //      gs_uart_iec_app_var[g_ch_comm].delay_10ms = 0;   
1197   1          return(TRUE); 
1198   1      }
1199          
1200          
1201          //-------------------------------------------------------------------------------//
1202          //  Function:     INT8U IEC_Cmd_Break_Deal(INT8U* sptr,INT8U len)
1203          //  Description:   iec Í¨Ñ¶ÖÕÖ¹Ö¸Áî´¦Àí³ÌÐò
1204          //  Parameters:   
1205          //  Returns:        ÎÞ                          
1206          //  Others:         
1207          //-------------------------------------------------------------------------------//
1208          INT8U IEC_Cmd_Break_Deal(INT8U* sptr)
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 23  

1209          {
1210   1      
1211   1             gs_uart_iec_app_var[g_ch_comm].iec_status |= COMM_BREAK_OK_IEC;
1212   1               gs_uart_iec_app_var[g_ch_comm].len= 1;
1213   1             Get_ACK_Answer(sptr);     
1214   1             return(TRUE);  
1215   1      }
1216          
1217          /*****************************************************************************
1218          ** Function name    :api_init_md_data_ram
1219          **
1220          ** Description         :³õÊ¼»¯µ±Ç°ÐèÁ¿¼ÆËãRAMÇøÊý¾Ý£¬³ÌÐò¸´Î»³õÊ¼»¯µ÷ÓÃ        
1221          **
1222          ** Parameters         :NONE          
1223          **
1224          ** Returned value   :NONE
1225          **
1226          **----------------------------------------------------------------------------
1227          ** V01.01  MJ  2016-04-23
1228          ******************************************************************************/
1229          void lnk_tx_comm_ready( uint8 ch,uint8 start_index)
1230          {
1231   1          uint16 u16_badu;
1232   1          //comm_IEC_Tx_Ready();   
1233   1          switch(gs_uart_iec_app_var[ch].baud_rate)
1234   1          {
1235   2              case CBaud_3:
1236   2                  u16_badu =300;
1237   2              break;
1238   2              case CBaud_6:
1239   2                  u16_badu =600;
1240   2              break;
1241   2              case CBaud_12:
1242   2                  u16_badu =1200;
1243   2              break;
1244   2              case CBaud_24:
1245   2                  u16_badu =2400;
1246   2              break;
1247   2              case CBaud_48:
1248   2                  u16_badu =4800;
1249   2              break;
1250   2              case CBaud_96:
1251   2                  u16_badu =9600;
1252   2              break;
1253   2      
1254   2              default:
1255   2                  u16_badu =300;
1256   2              break;
1257   2          }
1258   1      
1259   1          P_IEC_BUFF = &gs_uart_drv_var[ch].buff[0] ;
1260   1         // Tx_UART_frist(&P_IEC_BUFF[0], (gs_uart_iec_app_var[ch].len+start_index),u16_badu,ch); // Êý¾Ý·¢ËÍ //
             -     
1261   1          Tx_UART_frist(&P_IEC_BUFF[start_index], (gs_uart_iec_app_var[ch].len),u16_badu,ch);        // Êý¾Ý·¢ËÍ
             - //     
1262   1      }
1263          
1264          
1265          /*****************************************************************************
1266          ** Function name    :api_init_md_data_ram
1267          **
1268          ** Description         :³õÊ¼»¯µ±Ç°ÐèÁ¿¼ÆËãRAMÇøÊý¾Ý£¬³ÌÐò¸´Î»³õÊ¼»¯µ÷ÓÃ        
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 24  

1269          **
1270          ** Parameters         :NONE          
1271          **
1272          ** Returned value   :NONE
1273          **
1274          **----------------------------------------------------------------------------
1275          ** V01.01  MJ  2016-04-23
1276          ******************************************************************************/
1277          void api_handl_COMM_FRAME_ERROR( uint8 ch)
1278          {
1279   1          if(ch==UART_CH0_IR)           
1280   1          {
1281   2              Lib_Clr_String(&gs_uart_iec_app_var[ch].len, sizeof(UART_COMM_APP_VAR));   
1282   2              Init_UART4_hard(BPS300);  //reset_uart(UART_RESET_ALL); 
1283   2              Init_UART_soft(ch); 
1284   2                          Lib_Set_String( &LPReadPara.Original_Ptr, 0, 5) ;           
*** WARNING C182 IN LINE 1284 OF ..\C_SOURCE\S4_APIUSER\API_USER_COMM.C: pointer to different objects
1285   2          }
1286   1          
1287   1          if(ch==CH_RF)
1288   1          {
1289   2           Lib_Clr_String(&gs_uart_iec_app_var[ch].len, sizeof(UART_COMM_APP_VAR));   
1290   2           Init_UART_soft(ch); 
1291   2               SX127x_init();
1292   2           Rx_mode(); 
1293   2          }
1294   1          
1295   1          return;
1296   1      }
1297          
1298          //-------------------------------------------------------------------------------//
1299          //  Function:      void init_comm_link(INT8U mode)         
1300          //  Description:   ³õÊ¼»¯´®¿ÚÁ´Â·²ã±äÁ¿Êý¾Ý
1301          //  Parameters:   mode: Í¨Ñ¶Í¨µÀÐòºÅ  
1302          //  Returns:        ÎÞ                          
1303          //  Others:         
1304          //-------------------------------------------------------------------------------//
1305          void process_iec62056_21 (INT8U ch)
1306          {
1307   1       INT8U buff_size;
1308   1       INT8U start_index;
1309   1       INT8U meterID_len;
1310   1      
1311   1       INT8U tmp_8u_01[16];
1312   1       INT8U tmp_8u_02[32];
1313   1      // int i;
1314   1      // INT16U  u16_badu;
1315   1      
1316   1          
1317   1          if(ch > UART_CH_INDEX_MAX)  return ;
1318   1          
1319   1          if(gs_uart_iec_app_var[ch].tx_delay_flg ==TRUE ) 
1320   1          {
1321   2              return ;    //·¢ËÍµÈ´ý×´Ì¬Ê±ÍË³ö //
1322   2          }
1323   1      
1324   1          buff_size = Get_UART_rx_buff(&P_IEC_BUFF,ch);
1325   1          if(buff_size==0)   return;    // Ã¿¸öÑ­»·»ñÈ¡Ò»´Î½ÓÊÕÊý¾Ý³¤¶È£¬=0£¬ÍË³ö //
1326   1      
1327   1      /////////////////////////////////////////////////////////////////////////
1328   1          if((gs_uart_iec_app_var[ch].iec_status & COMM_INFO_OK_IEC) !=0)
1329   1          {
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 25  

1330   2              CLRWDT();
1331   2              CLRWDT();
1332   2          }
1333   1      ////////////////////////////////////////////////////////////////////////
1334   1      
1335   1          // Ç°µ¼×Ö½Ú´¦Àí //
1336   1          for(start_index=0;start_index<5;start_index++)
1337   1          {
1338   2              if((P_IEC_BUFF[start_index]=='/')||(P_IEC_BUFF[start_index]==ACKCOM)||(P_IEC_BUFF[start_index]==SO
             -H))  break;
1339   2          }
1340   1      
1341   1          if(start_index>3)
1342   1          {
1343   2              //½ÓÊÕµÄÊý¾ÝÖ¡´íÎó£¬²¹³ä´®¿Ú¸´Î»²Ù×÷      //
1344   2              api_handl_COMM_FRAME_ERROR(ch);
1345   2              return;
1346   2          }
1347   1      
1348   1          gs_uart_iec_app_var[ch].tx_delay_flg =FALSE;   // ÓÐÊý¾Ý½ÓÊÕÊ±Çå³ý·¢ËÍÑÓÊ±±êÊ¶ //
1349   1          gs_uart_iec_app_var[ch].delay_10ms = 0;   // ÓÐÊý¾Ý´¦ÀíÊ±Çå³ýÑÓÊ±¼ÆÊýÆ÷ //
1350   1          gs_uart_iec_app_var[ch].err_flg = 0;
1351   1          g_ch_comm = ch;
1352   1          
1353   1          if(((buff_size >2) &&((P_IEC_BUFF[buff_size-2]) == CR ||(P_IEC_BUFF[buff_size-2]) == ETX )) )
1354   1          {
1355   2              buff_size =buff_size-start_index;
1356   2              // Êý¾ÝÖ¡´¦Àí //
1357   2              switch(P_IEC_BUFF[start_index])
1358   2              {
1359   3                  case IEC_COMM_REQUEST:      
1360   3                      if((gs_uart_iec_app_var[ch].iec_status & COMM_INFO_OK_IEC) !=0)
1361   3                      {
1362   4                          api_handl_COMM_FRAME_ERROR(ch);
1363   4                          return;
1364   4                      }
1365   3                      mem_read (&tmp_8u_01[0],ADR_METER_PARAM1_METER_ID, 16,MEM_E2P1);
1366   3                      meterID_len = get_meter_id_asclen(&tmp_8u_01[0], 16);   //»ñÈ¡±íºÅÓÐÐ§asc³¤¶È
1367   3                      Lib_BCD_AscA(&tmp_8u_02[0], &tmp_8u_01[0], 16);
1368   3                      if(IEC_Comm_Request_Cmd_Judge(&P_IEC_BUFF[start_index], buff_size, &tmp_8u_02[0],meterID_l
             -en)==TRUE)
1369   3                      {
1370   4                          if(ch==UART_CH0_IR)   // TTL//
1371   4                         {
1372   5                               Get_IEC_Comm_Request_Cmd_Answer(&P_IEC_BUFF[start_index], Meter_INFO_LENTH,(uint8
             -*)&meter_info_IR[0]);//start_index
1373   5                          }
1374   4                           if(ch==CH_RF)  // RF//
1375   4                         {
1376   5                               Get_IEC_Comm_Request_Cmd_Answer(&P_IEC_BUFF[start_index], Meter_INFO_LENTH,(uint8
             -*)&meter_info[0]);
1377   5                          }           
1378   4                          gs_uart_iec_app_var[ch].len = Meter_INFO_LENTH+3;
1379   4                          gs_uart_iec_app_var[ch].iec_status |= COMM_INFO_OK_IEC;    // ÎÕÊÖÃüÁî³É¹¦±êÊ¶ //
1380   4                      }
1381   3                      else
1382   3                      {
1383   4                          //¿¼ÂÇµ½¿ª·ÅÊ½Í¨Ñ¶£¬Ê§°ÜÊ±²»·µ»ØÊý¾Ý //
1384   4                          api_handl_COMM_FRAME_ERROR(ch);
1385   4                          return;
1386   4                      }
1387   3                  break;
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 26  

1388   3      
1389   3                  case IEC_COMM_ACKNOWLEDGEMENT:
1390   3                      if((gs_uart_iec_app_var[ch].iec_status & COMM_INFO_OK_IEC) ==0)
1391   3                      {
1392   4                          api_handl_COMM_FRAME_ERROR(ch);
1393   4                          return;
1394   4                      }
1395   3                      if(IEC_Comm_Acknowledgement_Cmd_Judge(&P_IEC_BUFF[start_index],buff_size)==TRUE)
1396   3                      {
1397   4                          gs_uart_iec_app_var[ch].baud_rate = P_IEC_BUFF[start_index+2];      //                
             -                     //²¨ÌØÂÊ¸³Öµ  //
1398   4                          Get_IEC_Comm_Operand_Answer(&P_IEC_BUFF[start_index], MIMA_INFO_LENTH,(uint8*)&mima_in
             -fo[0]); //   // »ñÈ¡Êý¾Ý×éÖ¡ //
1399   4                          gs_uart_iec_app_var[ch].len = (MIMA_INFO_LENTH+6);
1400   4                          gs_uart_iec_app_var[ch].iec_status |= COMM_REQUIST_OK_IEC;  // ¸ø³öÇëÇóÃüÁî³É¹¦±êÊ¶ //
1401   4                      }
1402   3                      else
1403   3                      {
1404   4                          gs_uart_iec_app_var[ch].iec_status &= ~COMM_REQUIST_OK_IEC;  // clr ÇëÇóÃüÁî³É¹¦±êÊ¶ /
             -/
1405   4                          Get_Error_Answer(&P_IEC_BUFF[start_index]);//
1406   4                          gs_uart_iec_app_var[ch].len = 1;
1407   4                      }
1408   3      
1409   3                  break;
1410   3      
1411   3                  case IEC_COMM_COMMAND:
1412   3                      if((gs_uart_iec_app_var[ch].iec_status & COMM_REQUIST_OK_IEC) ==0)
1413   3                      {
1414   4                          api_handl_COMM_FRAME_ERROR(ch);
1415   4                          return;
1416   4                      } 
1417   3              //                      i = IEC_Comm_Command_Cmd_Judge(&P_IEC_BUFF[start_index],buff_size);             
1418   3                      if(IEC_Comm_Command_Cmd_Judge(&P_IEC_BUFF[start_index],buff_size) !=TRUE)//
1419   3                      {
1420   4                           // ÃüÁî³ö´í
1421   4                              // Êý¾Ý½âÎöÊ§°Ü //
1422   4                          Get_Error_Answer(&P_IEC_BUFF[start_index]);
1423   4                          gs_uart_iec_app_var[ch].len = 1;                       
1424   4                      }
1425   3                  break;
1426   3      
1427   3                  default:
1428   3                      gs_uart_iec_app_var[ch].err_flg |= FRAME_ERROR;   //Ö¡´íÎó£¬ÐèÒª¸´Î»  //        
1429   3                  break;
1430   3              }
1431   2      
1432   2          }
1433   1          else
1434   1          {
1435   2              gs_uart_iec_app_var[ch].err_flg |= FRAME_ERROR;   //Ö¡´íÎó£¬ÐèÒª¸´Î»  //        
1436   2          }
1437   1      
1438   1          if((gs_uart_iec_app_var[ch].err_flg & FRAME_ERROR) )
1439   1          {
1440   2              //½ÓÊÕµÄÊý¾ÝÖ¡´íÎó£¬²¹³ä´®¿Ú¸´Î»²Ù×÷      //
1441   2              api_handl_COMM_FRAME_ERROR(ch);
1442   2              return;
1443   2          }
1444   1          else
1445   1          {
1446   2              gs_uart_iec_app_var[ch].tx_delay_flg =TRUE;
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 27  

1447   2              gs_uart_iec_app_var[ch].tx_ready_10ms = 0;   // ÓÐÊý¾Ý´¦ÀíÊ±Çå³ýÑÓÊ±¼ÆÊýÆ÷ //
1448   2              if(gs_uart_iec_app_var[ch].iec_status ==(COMM_INFO_OK_IEC+COMM_REQUIST_OK_IEC))
1449   2              {
1450   3                  gs_uart_iec_app_var[ch].tx_ready_10ms  += 4;   // ÇÐ»»²¨ÌØÂÊÊ±ÑÓÊ±Ôö¼Ó10ms //
1451   3              }
1452   2              gs_uart_iec_app_var[ch].start_index = start_index;
1453   2          }
1454   1      }
1455          
1456          
1457          /*****************************************************************************
1458          ** Function name    :api_init_md_data_ram
1459          **
1460          ** Description         :³õÊ¼»¯µ±Ç°ÐèÁ¿¼ÆËãRAMÇøÊý¾Ý£¬³ÌÐò¸´Î»³õÊ¼»¯µ÷ÓÃ        
1461          **
1462          ** Parameters         :NONE          
1463          **
1464          ** Returned value   :NONE
1465          **
1466          **----------------------------------------------------------------------------
1467          ** V01.01  MJ  2016-04-23
1468          ******************************************************************************/
1469          void api_handl_COMM_pre_10ms(uint8 ch)
1470          {
1471   1      
1472   1              process_iec62056_21(ch);    
1473   1      
1474   1          if(gs_uart_iec_app_var[ch].delay_10ms >COMM_DELAY_3500MS)
1475   1          {   
1476   2              //³¬Ê±ÍË³öÎÕÊÖ£¬ÖØÐÂ½øÈë¿ÕÏÐµÈ´ý×´Ì¬ //
1477   2              api_handl_COMM_FRAME_ERROR(ch);    
1478   2          }
1479   1      
1480   1          if((gs_uart_iec_app_var[ch].tx_ready_10ms ==0)&&(gs_uart_iec_app_var[ch].tx_delay_flg ==TRUE))
1481   1          {   
1482   2              //Êý¾Ý×¼±¸·¢ËÍ   //
1483   2              gs_uart_iec_app_var[ch].tx_delay_flg =FALSE;
1484   2              lnk_tx_comm_ready(ch,gs_uart_iec_app_var[ch].start_index);     
1485   2          }
1486   1      
1487   1              if(clr_flag == 1)
1488   1              {
1489   2                      clr_flag = 0;
1490   2                      CLRWDT();
1491   2                      api_clr_current_energy_data();
1492   2                      CLRWDT();
1493   2                      api_clr_current_MD_data();
1494   2                      CLRWDT();
1495   2                      #if (BILL_MAX_NUM>0)
1496   2                      api_clr_bill_data();
1497   2                      #endif
1498   2                      gs_uart_iec_app_var[g_ch_comm].delay_10ms = 0; // 
1499   2                      LoadProRst();
1500   2                      CLRWDT();
1501   2                      api_clr_even_by_comm(); 
1502   2                      CLRWDT();
1503   2                      //2019-01-24  cxy
1504   2                      api_clr_freeze_energy();//Çå³ý¶³½áÊý¾Ý
1505   2                      CLRWDT();
1506   2                      api_chg_LCDDisplay_adj_item(DIS_DATA_CLR);   // Òº¾§ÏÔÊ¾ //
1507   2              }
1508   1                      
C51 COMPILER V9.01   API_USER_COMM                                                         04/16/2019 21:42:11 PAGE 28  

1509   1              if(IsClrEvent == 1)
1510   1              {
1511   2                      IsClrEvent = 0;
1512   2                      api_clr_even_by_comm();
1513   2              }
1514   1              if(IsReset == 1)
1515   1              {
1516   2                      while(1)
1517   2                      {
1518   3                              NOP();
1519   3                      }
1520   2              }
1521   1      //      if(IsProg == 1)
1522   1      //      {
1523   1      //              IsProg = 0;
1524   1      //              api_deal_even_class_recode(ID_CLASS_I_PROG,START);
1525   1      //      }
1526   1      
1527   1      }
1528          ///////////////////////////////////////////////////////////////////
1529          //  RF Í¨Ñ¶²¿·Ö
1530          ///////////////////////////////////////////////////////////////////
1531          //-------------------------------------------------------------------------------//
1532          //  Function:      void uart_comm_deal(void)    ´®¿ÚÍ¨Ñ¶´¦Àíº¯Êý        
1533          //  Description:   ÊµÏÖ´®¿Ú¹¦ÄÜµÄ¹ÜÀíºÍ²Ù×÷
1534          //  Parameters:   ÎÞ  
1535          //  Returns:        ÎÞ                          
1536          //  Others:         
1537          //-------------------------------------------------------------------------------//
1538          void RF_comm_deal(void)
1539          {  
1540   1          // RF Í¨µÀÊÇ·ñ½ÓÊÕµ½Êý¾Ý //
1541   1          if(LSD4RF_READ_DIO0() ==0) return;
1542   1          Lib_Delay_Nop(20);
1543   1          if(LSD4RF_READ_DIO0() ==0) return;   
1544   1          
1545   1          // ½ÓÊÕµ½Êý¾ÝºóµÄ´¦Àí //
1546   1              LSD_RF_RxPacket(&gs_uart_drv_var[CH_RF].buff[0]);
1547   1          CLRWDT();   // Çå¿´ÃÅ¹·//
1548   1          gs_uart_iec_app_var[CH_RF].delay_10ms = 0;   // ÓÐÊý¾Ý´¦ÀíÊ±Çå³ýÑÓÊ±¼ÆÊýÆ÷ //
1549   1          gs_uart_drv_var[CH_RF].rx_over_ticks =5;
1550   1              ////////////////////////
1551   1              gs_uart_drv_var[CH_RF].buff_index = G_LoRaConfig.PayloadLength;
1552   1           ///////////////////////////////
1553   1      }
1554          /***************************************************************
1555          *    END
1556          ****************************************************************/
1557          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   8329    ----
   CONSTANT SIZE    =   2035    ----
   XDATA SIZE       =     79     326
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  9 WARNING(S),  0 ERROR(S)
